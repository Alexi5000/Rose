var e=Object.defineProperty,t=(t,r,n)=>((t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n)(t,"symbol"!=typeof r?r+"":r,n);import{r,R as n,j as s,u as i,E as o,B as a,a as l,H as c,b as u,V as d,c as m,C as h,P as f,d as p}from"./r3f-D-aVanHc.js";import{m as y,c as g,h as x,Q as v,X as w,s as b,Y as S,z as j,Z as E,_ as k,u as C,d as R,v as T,t as N,$ as M,a0 as A,a1 as O}from"./three-SCLi_tbI.js";import{g as P,m as L,A as I,L as _}from"./animations-B_8wJt7L.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const U={uniforms:{time:{value:0},lightPosition:{value:new g(0,10,5)},baseColor:{value:new y("#4d9fff")},emissiveColor:{value:new y("#5dadff")},translucency:{value:.9},subsurfaceStrength:{value:.6},fresnelPower:{value:2.5},glowIntensity:{value:.5},refractionStrength:{value:.1}},vertexShader:"\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying vec3 vViewPosition;\n    varying vec2 vUv;\n    \n    void main() {\n      vUv = uv;\n      vNormal = normalize(normalMatrix * normal);\n      vPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n      \n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      vViewPosition = -mvPosition.xyz;\n      \n      gl_Position = projectionMatrix * mvPosition;\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform vec3 lightPosition;\n    uniform vec3 baseColor;\n    uniform vec3 emissiveColor;\n    uniform float translucency;\n    uniform float subsurfaceStrength;\n    uniform float fresnelPower;\n    uniform float glowIntensity;\n    uniform float refractionStrength;\n    \n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying vec3 vViewPosition;\n    varying vec2 vUv;\n    \n    // Simple noise function for surface detail\n    float noise(vec2 st) {\n      return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n    }\n    \n    void main() {\n      // Normalize vectors\n      vec3 normal = normalize(vNormal);\n      vec3 viewDir = normalize(vViewPosition);\n      vec3 lightDir = normalize(lightPosition - vPosition);\n      \n      // Fresnel effect for edge glow\n      float fresnel = pow(1.0 - max(0.0, dot(normal, viewDir)), fresnelPower);\n      \n      // Subsurface scattering approximation\n      // Light passing through the ice\n      float subsurface = max(0.0, dot(-lightDir, normal));\n      subsurface = pow(subsurface, 2.0) * subsurfaceStrength;\n      \n      // Add surface detail using noise\n      float surfaceNoise = noise(vUv * 10.0 + time * 0.1) * 0.1;\n      \n      // Combine base color with subsurface and fresnel\n      vec3 iceColor = baseColor;\n      iceColor += subsurface * vec3(0.3, 0.6, 1.0); // Blue subsurface tint\n      iceColor += fresnel * vec3(0.5, 0.8, 1.0) * glowIntensity; // Edge glow\n      \n      // Add emissive glow\n      vec3 emissive = emissiveColor * 0.2;\n      \n      // Final color\n      vec3 finalColor = iceColor + emissive + surfaceNoise;\n      \n      // Calculate opacity with fresnel for translucency\n      float alpha = mix(translucency, 1.0, fresnel * 0.5);\n      \n      gl_FragColor = vec4(finalColor, alpha);\n    }\n  "},D="#0a1e3d",z="#1e4d8b",F="#4d9fff",B="#ff8c42",q=768,H=1024,G=1440,W={mobile:{position:[0,2,14],fov:60},tablet:{position:[0,2,12],fov:55},desktop:{position:[0,2,12],fov:50},ultrawide:{position:[0,2,12],fov:50}},V={mobile:{shadows:!1,postProcessing:!1,particleCount:200,waterSubdivision:32},tablet:{shadows:!0,postProcessing:!0,particleCount:500,waterSubdivision:64},desktop:{shadows:!0,postProcessing:!0,particleCount:1e3,waterSubdivision:128}},Y={high:{maxSize:2048,anisotropy:16,generateMipmaps:!0,minFilter:w,magFilter:x},medium:{maxSize:1024,anisotropy:8,generateMipmaps:!0,minFilter:w,magFilter:x},low:{maxSize:512,anisotropy:4,generateMipmaps:!0,minFilter:v,magFilter:x}},K=()=>{const[e,t]=r.useState("desktop"),[n,s]=r.useState(16/9);r.useEffect(()=>{const e=()=>{const e=window.innerWidth,r=window.innerHeight;s(e/r),t(e<q?"mobile":e<H?"tablet":e<G?"desktop":"ultrawide")};let r;e();const n=()=>{clearTimeout(r),r=window.setTimeout(e,100)};return window.addEventListener("resize",n),()=>{clearTimeout(r),window.removeEventListener("resize",n)}},[]);const i="ultrawide"===e?V.desktop:V[e],o=(a="tablet"===e,"mobile"===e?Y.low:a?Y.medium:Y.high);var a;return{viewport:e,cameraConfig:W[e],quality:i,aspectRatio:n,isMobile:"mobile"===e,isTablet:"tablet"===e,isDesktop:"desktop"===e||"ultrawide"===e,isPortrait:n<1,isLandscape:n>=1,enablePostProcessing:i.postProcessing,enableShadows:i.shadows,particleCount:i.particleCount,waterSubdivision:i.waterSubdivision,textureQuality:o}},$="#0a1e3d",J="#4d9fff",Q="#ff6b9d",X={ice:{color:J,emissive:$,emissiveIntensity:.25,metalness:.05,roughness:.25},rose:{color:"#16182a",emissive:J,emissiveIntensity:.15,roughness:.95,metalness:.05},water:{color:"#0d2847",emissive:$,emissiveIntensity:.05,metalness:.95,roughness:.08}},Z={sky:{colors:[{stop:0,color:$},{stop:.35,color:"#1e4d8b"},{stop:.65,color:Q},{stop:1,color:"#ff8c42"}]}},ee={intensity:.9,luminanceThreshold:.25,luminanceSmoothing:.95,radius:.85},te={brightness:.08,contrast:1.15,saturation:1.25},re={offset:.35,darkness:.45},ne={color:Q,near:25,far:90},se={color1:"#5da8ff",color2:"#a855ff",color3:"#52ffb8",baseIntensity:.65,maxIntensity:1.3},ie=e=>{e.frustumCulled=!0,e.traverse(e=>{e instanceof b&&(e.frustumCulled=!0,e.geometry&&(e.geometry.computeBoundingSphere(),e.geometry.computeBoundingBox()))})},oe=e=>{e&&(e.traverse(e=>{e instanceof b&&(e.geometry&&e.geometry.dispose(),e.material&&ae(e.material)),e instanceof S&&e.dispose&&e.dispose()}),e.parent&&e.parent.remove(e))},ae=e=>{(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(t=>{const r=e[t];r&&r instanceof j&&r.dispose()}),e.dispose()})},le=()=>{const e=r.useRef(null),t=r.useRef(null),n=r.useRef(null),o=r.useRef([]),a=r.useRef(null),l=r.useRef(null),{isMobile:c,isTablet:u}=K(),d=r.useMemo(()=>{const e=c?20:u?35:50,t=[];for(let r=0;r<e;r++){const n=r/e*20-10,s=5+2*Math.random(),i=2*Math.random()-5,o=.3+.7*Math.random(),a=.5+1.5*Math.random(),l=.2*Math.random()-.1,c=.3*Math.random()-.15,u=.2*Math.random()-.1;t.push({position:[n,s,i],rotation:[l,c,u],scale:[o,a,o]})}return t},[c,u]);r.useMemo(()=>{if(!e.current)return;const t=new E;d.forEach((r,n)=>{t.position.set(...r.position),t.rotation.set(...r.rotation),t.scale.set(...r.scale),t.updateMatrix(),e.current.setMatrixAt(n,t.matrix)}),e.current.instanceMatrix.needsUpdate=!0},[d]),i(t=>{const r=t.clock.elapsedTime;if(c||(n.current&&(n.current.uniforms.time.value=r),o.current.forEach(e=>{e&&(e.uniforms.time.value=r)})),e.current&&!c){const t=new E;d.forEach((n,s)=>{const i=.002*Math.sin(.5*r+.1*s),o=.002*Math.cos(.3*r+.15*s);t.position.set(n.position[0]+i,n.position[1],n.position[2]+o),t.rotation.set(...n.rotation),t.scale.set(...n.scale),t.updateMatrix(),e.current.setMatrixAt(s,t.matrix)}),e.current.instanceMatrix.needsUpdate=!0}});const m=c?6:8,h=r.useMemo(()=>(e=>(e.computeBoundingSphere(),e.computeBoundingBox(),e.attributes.normal||e.computeVertexNormals(),e))(new k(.1,1,m)),[m]);return r.useEffect(()=>{const r=e.current,n=t.current,s=h;return r&&ie(r),n&&ie(n),()=>{r&&oe(r),n&&oe(n),s&&s.dispose()}},[h]),s.jsxs("group",{name:"ice-cave-environment",children:[s.jsx("instancedMesh",{ref:e,args:[h,void 0,d.length],castShadow:!c,receiveShadow:!c,children:c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.8}):s.jsx("shaderMaterial",{ref:n,uniforms:U.uniforms,vertexShader:U.vertexShader,fragmentShader:U.fragmentShader,transparent:!0,side:C})}),s.jsxs("group",{ref:t,name:"cave-walls",children:[s.jsxs("mesh",{position:[-8,2,-3],rotation:[0,.3,0],castShadow:!c,receiveShadow:!c,children:[s.jsx("cylinderGeometry",{args:[3,3,8,c?8:16,1,!0,0,.5*Math.PI]}),c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.7,side:C}):s.jsx("shaderMaterial",{ref:e=>{e&&(o.current[0]=e)},uniforms:{...U.uniforms,translucency:{value:.7}},vertexShader:U.vertexShader,fragmentShader:U.fragmentShader,transparent:!0,side:C})]}),s.jsxs("mesh",{position:[8,2,-3],rotation:[0,-.3,0],castShadow:!c,receiveShadow:!c,children:[s.jsx("cylinderGeometry",{args:[3,3,8,c?8:16,1,!0,.5*Math.PI,.5*Math.PI]}),c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.7,side:C}):s.jsx("shaderMaterial",{ref:e=>{e&&(o.current[1]=e)},uniforms:{...U.uniforms,translucency:{value:.7}},vertexShader:U.vertexShader,fragmentShader:U.fragmentShader,transparent:!0,side:C})]}),s.jsxs("mesh",{position:[0,6,-4],rotation:[.1*Math.PI,0,0],receiveShadow:!c,children:[s.jsx("planeGeometry",{args:[20,4,c?16:32,c?8:16]}),c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.6,side:C}):s.jsx("shaderMaterial",{ref:e=>{e&&(o.current[2]=e)},uniforms:{...U.uniforms,translucency:{value:.6}},vertexShader:U.vertexShader,fragmentShader:U.fragmentShader,transparent:!0,side:C})]})]}),!c&&s.jsxs(s.Fragment,{children:[s.jsx(ce,{ref:a,count:u?15:25}),s.jsx(ue,{ref:l,count:u?8:12})]})]})},ce=n.forwardRef(({count:e},t)=>{const n=r.useMemo(()=>{const t=[];for(let r=0;r<e;r++){const n=r/e*Math.PI*2,s=3+4*Math.random(),i=Math.cos(n)*s+2*(Math.random()-.5),o=Math.sin(n)*s+2*(Math.random()-.5),a=.05,l=Math.random()*Math.PI*2,c=Math.random()*Math.PI*2,u=Math.random()*Math.PI*2,d=.05+.1*Math.random();t.push({position:[i,a,o],rotation:[l,c,u],scale:d})}return t},[e]);return r.useMemo(()=>{if(!t||"function"==typeof t||!t.current)return;const e=new E;n.forEach((r,n)=>{e.position.set(...r.position),e.rotation.set(...r.rotation),e.scale.setScalar(r.scale),e.updateMatrix(),t.current.setMatrixAt(n,e.matrix)}),t.current.instanceMatrix.needsUpdate=!0},[n,t]),s.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,e],children:[s.jsx("octahedronGeometry",{args:[1,0]}),s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:.5*X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.7})]})});ce.displayName="IceCrystals";const ue=n.forwardRef(({count:e},t)=>{const n=r.useMemo(()=>{const t=[];for(let r=0;r<e;r++){const e=3*(Math.random()-.5)-5,r=2*(Math.random()-.5)-1,n=.1,s=Math.random()*Math.PI*.3,i=Math.random()*Math.PI*2,o=Math.random()*Math.PI*.3,a=.15+.25*Math.random(),l=a*(.8+.4*Math.random()),c=a*(.6+.4*Math.random()),u=a*(.8+.4*Math.random());t.push({position:[e,n,r],rotation:[s,i,o],scale:[l,c,u]})}return t},[e]);return r.useMemo(()=>{if(!t||"function"==typeof t||!t.current)return;const e=new E;n.forEach((r,n)=>{e.position.set(...r.position),e.rotation.set(...r.rotation),e.scale.set(...r.scale),e.updateMatrix(),t.current.setMatrixAt(n,e.matrix)}),t.current.instanceMatrix.needsUpdate=!0},[n,t]),s.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,e],receiveShadow:!0,castShadow:!0,children:[s.jsx("dodecahedronGeometry",{args:[1,0]}),s.jsx("meshStandardMaterial",{color:"#3a4a5a",roughness:.9,metalness:.1})]})});ue.displayName="Rocks";const de={totalDuration:3.5,camera:{startZ:15,endZ:8,duration:3.5,ease:"power2.inOut",delay:0},rose:{startScale:0,endScale:1,duration:2.2,ease:"back.out(1.4)",delay:1},water:{startStrength:0,endStrength:.5,duration:2.5,ease:"power2.out",delay:1.2},aurora:{startIntensity:0,endIntensity:.65,duration:3.2,ease:"power1.inOut",delay:.8}},me={amplitude:.02,frequency:.5},he={amplitude:.05,frequency:.3},fe={amplitude:.02,frequency:.4},pe={minSpeed:.008,maxSpeed:.018,driftAmplitude:.004,resetHeight:12,minHeight:-1},ye={amplitudeMultiplier:1.8,transitionDuration:.25,ease:"power2.out"},ge={baseIntensity:.15,maxBoost:.6},xe={maxPulse:.08},ve=({audioAmplitude:e=0,animationScale:t=1,reducedMotion:n=!1})=>{const o=r.useRef(null),a=r.useRef(null),{isMobile:l}=K(),c=n?.3:1,u=l?8:16;return i(r=>{if(!o.current)return;const n=r.clock.elapsedTime,s=1+Math.sin(n*me.frequency*Math.PI*2)*me.amplitude*c,i=e*xe.maxPulse;o.current.scale.y=(s+i)*t,o.current.scale.x=(1+.5*i)*t,o.current.scale.z=(1+.5*i)*t;const a=Math.sin(n*he.frequency*Math.PI*2)*he.amplitude*c;o.current.position.y=.5+a;const l=Math.sin(n*fe.frequency*Math.PI*2)*fe.amplitude*c;o.current.rotation.z=l;const u=ge.baseIntensity+e*ge.maxBoost;o.current.traverse(e=>{if(e instanceof b&&e.material){const t=e.material;void 0!==t.emissiveIntensity&&(t.emissiveIntensity=u)}})}),s.jsxs("group",{ref:o,position:[0,.5,0],children:[s.jsxs("mesh",{ref:a,position:[0,0,0],castShadow:!l,children:[s.jsx("sphereGeometry",{args:[.3,u,u,0,2*Math.PI,0,.6*Math.PI]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[0,.4,0],castShadow:!l,children:[s.jsx("sphereGeometry",{args:[.15,u,u]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[.15,-.3,.1],rotation:[0,0,-.3],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.08,.08,.4,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[-.15,-.3,.1],rotation:[0,0,.3],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.08,.08,.4,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[.25,-.05,.15],rotation:[.5,0,.8],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.06,.06,.35,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[-.25,-.05,.15],rotation:[.5,0,-.8],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.06,.06,.35,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[0,0,0],children:[s.jsx("sphereGeometry",{args:[.6,u,u]}),s.jsx("meshBasicMaterial",{color:X.rose.emissive,transparent:!0,opacity:.06+.12*e})]})]})},we={uniforms:{time:{value:0},rippleCenter:{value:new R(.5,.5)},rippleStrength:{value:.5},skyColorTop:{value:new y("#0a1e3d")},skyColorHorizon:{value:new y("#7db9ff")},waterColorDeep:{value:new y("#2a6fbb")},waterColorShallow:{value:new y("#4d9fff")}},vertexShader:"\n    uniform float time;\n    uniform vec2 rippleCenter;\n    uniform float rippleStrength;\n    \n    varying vec2 vUv;\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying float vElevation;\n    varying float vDistanceFromCenter;\n    \n    void main() {\n      vUv = uv;\n      vNormal = normal;\n      \n      // Calculate distance from ripple center (Rose's position)\n      vec2 centeredUv = uv - rippleCenter;\n      float dist = length(centeredUv);\n      vDistanceFromCenter = dist;\n      \n      // Create concentric ripples emanating from Rose's position\n      // Multiple frequencies for natural wave interference\n      float ripple1 = sin(dist * 20.0 - time * 2.0) * rippleStrength;\n      float ripple2 = sin(dist * 15.0 - time * 1.5) * rippleStrength * 0.5;\n      float ripple3 = sin(dist * 10.0 - time * 1.0) * rippleStrength * 0.3;\n      \n      // Smooth distance-based fade using exponential decay\n      // Ripples fade naturally as they move away from Rose\n      float fade = exp(-dist * 2.5);\n      float smoothFade = smoothstep(0.0, 0.1, fade) * fade;\n      \n      // Combine ripples with smooth fade\n      float totalRipple = (ripple1 + ripple2 + ripple3) * smoothFade;\n      \n      // Add subtle ambient wave motion for realism\n      float baseWave = sin(uv.x * 5.0 + time * 0.5) * 0.02;\n      baseWave += sin(uv.y * 3.0 + time * 0.3) * 0.02;\n      \n      // Displace vertices to create 3D ripple effect\n      vec3 newPosition = position;\n      newPosition.z += totalRipple * 0.15 + baseWave;\n      \n      vElevation = totalRipple * 0.15 + baseWave;\n      vPosition = newPosition;\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform vec3 skyColorTop;\n    uniform vec3 skyColorHorizon;\n    uniform vec3 waterColorDeep;\n    uniform vec3 waterColorShallow;\n    \n    varying vec2 vUv;\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying float vElevation;\n    varying float vDistanceFromCenter;\n    \n    void main() {\n      // Calculate view direction for Fresnel effect\n      vec3 viewDirection = normalize(cameraPosition - vPosition);\n      \n      // Fresnel effect - more reflection at grazing angles\n      float fresnel = pow(1.0 - dot(viewDirection, vec3(0.0, 0.0, 1.0)), 2.0);\n      \n      // Sky reflection gradient based on UV\n      vec3 skyReflection = mix(skyColorHorizon, skyColorTop, vUv.y);\n      \n      // Water color based on depth (elevation) and distance from center\n      float depthFactor = smoothstep(-0.1, 0.1, vElevation);\n      vec3 waterColor = mix(waterColorDeep, waterColorShallow, depthFactor);\n      \n      // Enhance color near ripple center (Rose's position)\n      float centerGlow = exp(-vDistanceFromCenter * 3.0) * 0.2;\n      waterColor = mix(waterColor, waterColorShallow, centerGlow);\n      \n      // Mix water color and sky reflection based on Fresnel\n      vec3 finalColor = mix(waterColor, skyReflection, fresnel * 0.6);\n      \n      // Add subtle shimmer effect\n      float shimmer = sin(vUv.x * 50.0 + time * 2.0) * sin(vUv.y * 50.0 + time * 1.5);\n      shimmer = shimmer * 0.05 + 0.95;\n      finalColor *= shimmer;\n      \n      // Add foam/highlights at wave peaks\n      float foam = smoothstep(0.08, 0.12, vElevation);\n      finalColor = mix(finalColor, vec3(1.0), foam * 0.3);\n      \n      // Slight transparency for realism\n      float alpha = 0.95 + fresnel * 0.05;\n      \n      gl_FragColor = vec4(finalColor, alpha);\n    }\n  "},be=({rippleStrength:e=.5,rosePosition:t=[0,0],audioAmplitude:n=0})=>{const o=r.useRef(null),{viewport:a}=K(),l=r.useRef({value:e}),c=V[a]||V.desktop,u=r.useMemo(()=>new T({uniforms:{...we.uniforms,skyColorTop:{value:new y(D)},skyColorHorizon:{value:new y(B)},waterColorDeep:{value:new y(D)},waterColorShallow:{value:new y(F)}},vertexShader:we.vertexShader,fragmentShader:we.fragmentShader,transparent:!0,side:C}),[]);return r.useEffect(()=>{const t=e*(1+n*ye.amplitudeMultiplier);P.to(l.current,{value:t,duration:ye.transitionDuration,ease:ye.ease})},[e,n]),i(e=>{if(o.current&&o.current.material instanceof T){const r=o.current.material;r.uniforms.time.value=e.clock.elapsedTime,r.uniforms.rippleStrength.value=l.current.value;const n=(t[0]+10)/20,s=(t[1]+10)/20;r.uniforms.rippleCenter.value.set(n,s)}}),s.jsxs("mesh",{ref:o,rotation:[-Math.PI/2,0,0],position:[0,0,0],receiveShadow:!0,children:[s.jsx("planeGeometry",{args:[20,20,c.waterSubdivision,c.waterSubdivision]}),s.jsx("primitive",{object:u,attach:"material"})]})},Se="#ff8c42",je="#ffa564",Ee="#ffc188",ke="#e8d4c8",Ce={AMBIENT_INTENSITY:.4,AMBIENT_COLOR:"#1e4d8b",IGLOO_LIGHT_INTENSITY:2.5,IGLOO_LIGHT_COLOR:Se,IGLOO_LIGHT_DISTANCE:15,IGLOO_LIGHT_DECAY:2,AURORA_LIGHT_INTENSITY:1.2,AURORA_LIGHT_COLOR:"#4d9fff",WATER_LIGHT_INTENSITY:.8,WATER_LIGHT_COLOR:"#4d9fff",KEY_LIGHT_INTENSITY:1.5,KEY_LIGHT_COLOR:"#c8e4ff",FILL_LIGHT_INTENSITY:.6,FILL_LIGHT_COLOR:"#4d9fff"},Re=-6,Te=.5,Ne=-2,Me=1.2,Ae=.8,Oe=0,Pe=1.5,Le=({audioAmplitude:e=0})=>{const t=r.useRef(null),n=r.useRef(null),{isMobile:o}=K(),a=Ce.IGLOO_LIGHT_INTENSITY;i(t=>{if(n.current){const r=t.clock.elapsedTime,s=1+.05*Math.sin(2*r)+.03*(Math.random()-.5),i=1+.3*e;n.current.intensity=a*s*i}});const l=[Re,Te,Ne],c=Me,u=o?8:16;return s.jsxs("group",{ref:t,position:l,scale:c,children:[s.jsxs("mesh",{castShadow:!o,receiveShadow:!o,children:[s.jsx("sphereGeometry",{args:[1,u,u,0,2*Math.PI,0,Math.PI/2]}),s.jsx("meshStandardMaterial",{color:ke,emissive:Se,emissiveIntensity:Pe,roughness:Ae,metalness:Oe})]}),s.jsxs("mesh",{position:[.7,.2,0],rotation:[0,0,Math.PI/2],castShadow:!o,children:[s.jsx("cylinderGeometry",{args:[.3,.3,.6,u/2]}),s.jsx("meshStandardMaterial",{color:ke,emissive:Ee,emissiveIntensity:.6*Pe,roughness:Ae,metalness:Oe})]}),s.jsx("pointLight",{ref:n,position:[0,.4,0],color:Ce.IGLOO_LIGHT_COLOR,intensity:a,distance:Ce.IGLOO_LIGHT_DISTANCE,decay:Ce.IGLOO_LIGHT_DECAY,castShadow:!1}),s.jsx("pointLight",{position:[.7,.2,0],color:je,intensity:1,distance:5,decay:2,castShadow:!1})]})},Ie={vertexShader:"\n    varying vec3 vWorldPosition;\n    \n    void main() {\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vWorldPosition = worldPosition.xyz;\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform vec3 topColor;\n    uniform vec3 midColor;\n    uniform vec3 horizonColor;\n    uniform vec3 bottomColor;\n    \n    varying vec3 vWorldPosition;\n    \n    void main() {\n      // Normalize Y position for gradient (-1 to 1)\n      float h = normalize(vWorldPosition).y;\n      \n      vec3 color;\n      \n      // Create smooth gradient with multiple color stops\n      // Using smoothstep for natural color blending (Requirement 9.3)\n      if (h > 0.4) {\n        // Top section: deep blue to sky blue\n        float t = smoothstep(0.4, 1.0, h);\n        color = mix(midColor, topColor, t);\n      } else if (h > 0.0) {\n        // Middle section: sky blue to warm pink\n        float t = smoothstep(0.0, 0.4, h);\n        color = mix(horizonColor, midColor, t);\n      } else {\n        // Bottom section: warm pink to warm orange\n        float t = smoothstep(-0.2, 0.0, h);\n        color = mix(bottomColor, horizonColor, t);\n      }\n      \n      gl_FragColor = vec4(color, 1.0);\n    }\n  "},_e=()=>{const e=r.useMemo(()=>new T({uniforms:{topColor:{value:new y(Z.sky.colors[0].color)},midColor:{value:new y(Z.sky.colors[1].color)},horizonColor:{value:new y(Z.sky.colors[2].color)},bottomColor:{value:new y(Z.sky.colors[3].color)}},vertexShader:Ie.vertexShader,fragmentShader:Ie.fragmentShader,side:N,depthWrite:!1}),[]),t=r.useMemo(()=>new M({color:X.water.color,emissive:X.water.emissive,emissiveIntensity:X.water.emissiveIntensity,metalness:X.water.metalness,roughness:X.water.roughness,envMapIntensity:1.5}),[]),n=r.useMemo(()=>new y(ne.color),[]);return s.jsxs("group",{children:[s.jsx("mesh",{material:e,renderOrder:-1,children:s.jsx("sphereGeometry",{args:[500,32,32]})}),s.jsx("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.5,-50],material:t,receiveShadow:!0,children:s.jsx("planeGeometry",{args:[1e3,1e3,1,1]})}),s.jsx("fog",{attach:"fog",args:[n,ne.near,ne.far]})]})},Ue={uniforms:{time:{value:0},intensity:{value:.6},color1:{value:new y("#4d9fff")},color2:{value:new y("#9d4dff")},color3:{value:new y("#4dffaa")}},vertexShader:"\n    varying vec2 vUv;\n    varying vec3 vPosition;\n    \n    void main() {\n      vUv = uv;\n      vPosition = position;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform float intensity;\n    uniform vec3 color1; // Blue\n    uniform vec3 color2; // Purple\n    uniform vec3 color3; // Green\n    \n    varying vec2 vUv;\n    varying vec3 vPosition;\n    \n    \n  vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n  vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n  vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }\n  vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n  float snoise(vec3 v) {\n    const vec2 C = vec2(1.0/6.0, 1.0/3.0);\n    const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n    vec3 i  = floor(v + dot(v, C.yyy));\n    vec3 x0 = v - i + dot(i, C.xxx);\n\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min(g.xyz, l.zxy);\n    vec3 i2 = max(g.xyz, l.zxy);\n\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy;\n    vec3 x3 = x0 - D.yyy;\n\n    i = mod289(i);\n    vec4 p = permute(permute(permute(\n              i.z + vec4(0.0, i1.z, i2.z, 1.0))\n            + i.y + vec4(0.0, i1.y, i2.y, 1.0))\n            + i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\n    float n_ = 0.142857142857;\n    vec3 ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);\n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_);\n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n\n    vec4 b0 = vec4(x.xy, y.xy);\n    vec4 b1 = vec4(x.zw, y.zw);\n\n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n\n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;\n\n    vec3 p0 = vec3(a0.xy, h.x);\n    vec3 p1 = vec3(a0.zw, h.y);\n    vec3 p2 = vec3(a1.xy, h.z);\n    vec3 p3 = vec3(a1.zw, h.w);\n\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));\n  }\n\n    \n    void main() {\n      // Create flowing noise patterns with multiple octaves\n      vec3 noiseCoord1 = vec3(vUv * 2.0, time * 0.1);\n      vec3 noiseCoord2 = vec3(vUv * 3.0, time * 0.15);\n      vec3 noiseCoord3 = vec3(vUv * 1.5, time * 0.08);\n      \n      float noise1 = snoise(noiseCoord1);\n      float noise2 = snoise(noiseCoord2);\n      float noise3 = snoise(noiseCoord3);\n      \n      // Combine noise layers for complex aurora pattern\n      float combinedNoise = noise1 * 0.5 + noise2 * 0.3 + noise3 * 0.2;\n      \n      // Create wave-like flowing motion\n      float wave = sin(vUv.x * 3.0 + time * 0.2) * 0.3;\n      wave += sin(vUv.y * 2.0 - time * 0.15) * 0.2;\n      \n      // Combine noise and waves\n      float aurora = combinedNoise + wave;\n      \n      // Apply smoothstep for ethereal edges\n      aurora = smoothstep(0.2, 0.8, aurora);\n      \n      // Create vertical gradient (stronger at top)\n      float verticalGradient = smoothstep(0.0, 0.5, vUv.y);\n      aurora *= verticalGradient;\n      \n      // Mix colors based on noise patterns\n      vec3 auroraColor = mix(color1, color2, noise1 * 0.5 + 0.5);\n      auroraColor = mix(auroraColor, color3, noise2 * 0.3 + 0.3);\n      \n      // Add subtle shimmer\n      float shimmer = sin(vUv.x * 20.0 + time * 2.0) * sin(vUv.y * 15.0 + time * 1.5);\n      shimmer = shimmer * 0.1 + 0.9;\n      auroraColor *= shimmer;\n      \n      // Apply intensity and create transparency\n      float alpha = aurora * intensity * 0.7;\n      \n      // Fade edges for seamless blending\n      float edgeFade = smoothstep(0.0, 0.1, vUv.x) * smoothstep(1.0, 0.9, vUv.x);\n      alpha *= edgeFade;\n      \n      gl_FragColor = vec4(auroraColor, alpha);\n    }\n  "},De=({audioAmplitude:e=0,baseIntensity:t=se.baseIntensity,reducedMotion:n=!1})=>{const o=r.useRef(null),{isMobile:a}=K(),l=n?.3:1,c=r.useMemo(()=>{const e=new T({uniforms:O.clone(Ue.uniforms),vertexShader:Ue.vertexShader,fragmentShader:Ue.fragmentShader,transparent:!0,side:C,depthWrite:!1,blending:A});return e.uniforms.color1.value=new y(se.color1),e.uniforms.color2.value=new y(se.color2),e.uniforms.color3.value=new y(se.color3),e},[]);r.useEffect(()=>{if(!c)return;const r=t+e*(se.maxIntensity-se.baseIntensity);P.to(c.uniforms.intensity,{value:r,duration:.3,ease:"power2.out"})},[e,t,c]),i(e=>{c&&(c.uniforms.time.value=e.clock.elapsedTime*l)}),r.useEffect(()=>()=>{c.dispose()},[c]);const u=a?32:64,d=a?16:32;return s.jsxs("mesh",{ref:o,position:[0,8,-15],rotation:[-Math.PI/6,0,0],children:[s.jsx("planeGeometry",{args:[30,12,u,d]}),s.jsx("primitive",{object:c,attach:"material"})]})},ze=({voiceState:e="idle",audioAmplitude:t=0})=>{const n=r.useRef(null),o=r.useRef(null),a=r.useRef(null),{quality:l}=K(),c=l.shadows,u={ambient:Ce.AMBIENT_INTENSITY,key:Ce.KEY_LIGHT_INTENSITY,rim:Ce.AURORA_LIGHT_INTENSITY,fill:Ce.FILL_LIGHT_INTENSITY};return i(()=>{if(!n.current||!o.current||!a.current)return;let r=1,s=0;switch(e){case"listening":r=1.1,o.current.intensity=1.2*u.rim;break;case"speaking":r=1.15,s=.2;const e=1+.15*t;n.current.intensity=u.key*r*e,a.current.intensity=u.fill*(1+s)*e;break;case"processing":r=1.05;break;default:return n.current.intensity=u.key,o.current.intensity=u.rim,void(a.current.intensity=u.fill)}"speaking"!==e&&(n.current.intensity=u.key*r,a.current.intensity=u.fill*(1+s))}),s.jsxs(s.Fragment,{children:[s.jsx("ambientLight",{color:Ce.AMBIENT_COLOR,intensity:u.ambient}),s.jsx("directionalLight",{ref:n,position:[5,10,5],color:Ce.KEY_LIGHT_COLOR,intensity:u.key,castShadow:c,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10,"shadow-bias":-1e-4,"shadow-normalBias":.02,"shadow-radius":4}),s.jsx("directionalLight",{ref:o,position:[0,15,-10],color:Ce.AURORA_LIGHT_COLOR,intensity:u.rim}),s.jsx("pointLight",{ref:a,position:[-8,5,3],color:Ce.FILL_LIGHT_COLOR,intensity:u.fill,distance:30,decay:2})]})},Fe=({reducedMotion:e=!1})=>{const t=r.useRef(null),{quality:n}=K(),o=n.particleCount,a=e?Math.floor(.5*o):o,l=r.useMemo(()=>{const e=[],{minSpeed:t,maxSpeed:r,driftAmplitude:n,resetHeight:s}=pe;for(let i=0;i<a;i++)e.push({position:new g(20*(Math.random()-.5),Math.random()*s,20*(Math.random()-.5)),velocity:new g(0,0,0),speed:t+Math.random()*(r-t),size:.02+.05*Math.random(),drift:(Math.random()-.5)*n});return e},[a]),c=r.useMemo(()=>new E,[]);return r.useEffect(()=>()=>{t.current&&oe(t.current)},[]),i(e=>{if(!t.current)return;const r=e.camera,{resetHeight:n,minHeight:s}=pe;l.forEach((e,i)=>{e.position.y-=e.speed,e.position.x+=e.drift,e.position.y<s&&(e.position.y=n,e.position.x=20*(Math.random()-.5),e.position.z=20*(Math.random()-.5));const o=r.position.distanceTo(e.position),a=Math.max(0,1-o/15);c.position.copy(e.position),c.scale.setScalar(e.size*a),c.updateMatrix(),t.current.setMatrixAt(i,c.matrix)}),t.current.instanceMatrix.needsUpdate=!0}),s.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,a],children:[s.jsx("sphereGeometry",{args:[1,8,8]}),s.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.6,blending:A,depthWrite:!1})]})},Be=({enabled:e=!0})=>{const{enablePostProcessing:t}=K();return t&&e?s.jsxs(o,{children:[s.jsx(a,{intensity:ee.intensity,luminanceThreshold:ee.luminanceThreshold,luminanceSmoothing:ee.luminanceSmoothing,mipmapBlur:!0,radius:ee.radius}),s.jsx(l,{brightness:te.brightness,contrast:te.contrast-1}),s.jsx(c,{saturation:te.saturation-1,hue:0,blendFunction:u.NORMAL}),s.jsx(d,{offset:re.offset,darkness:re.darkness,eskil:!1,blendFunction:u.NORMAL})]}):null},qe=(e={})=>{const{enabled:t=!0,duration:n=de.totalDuration,onComplete:s}=e,i=r.useRef(null),o=r.useRef(!1),[a,l]=r.useState(de.camera.startZ),[c,u]=r.useState(de.rose.startScale),[d,m]=r.useState(de.water.startStrength),[h,f]=r.useState(de.aurora.startIntensity);r.useEffect(()=>{if(!t||o.current)return;const e=P.timeline({defaults:{ease:de.camera.ease},onComplete:()=>{s&&s()}});return e.to({z:de.camera.startZ},{z:de.camera.endZ,duration:de.camera.duration,ease:de.camera.ease,onUpdate:function(){l(this.targets()[0].z)}},de.camera.delay),e.to({scale:de.rose.startScale},{scale:de.rose.endScale,duration:de.rose.duration,ease:de.rose.ease,onUpdate:function(){u(this.targets()[0].scale)}},de.rose.delay),e.to({strength:de.water.startStrength},{strength:de.water.endStrength,duration:de.water.duration,ease:de.water.ease,onUpdate:function(){m(this.targets()[0].strength)}},de.water.delay),e.to({intensity:de.aurora.startIntensity},{intensity:de.aurora.endIntensity,duration:de.aurora.duration,ease:de.aurora.ease,onUpdate:function(){f(this.targets()[0].intensity)}},de.aurora.delay),i.current=e,o.current=!0,()=>{i.current&&(i.current.kill(),i.current=null)}},[t,n,s]);return{cameraZ:a,roseScale:c,waterRippleStrength:d,auroraIntensity:h,timeline:i.current,play:()=>{i.current&&i.current.play()},pause:()=>{i.current&&i.current.pause()},restart:()=>{i.current&&(o.current=!1,i.current.restart())},reverse:()=>{i.current&&i.current.reverse()},skip:()=>{i.current&&i.current.progress(1)},isAnimating:i.current?.isActive()??!1,hasPlayed:o.current}},He=({audioAmplitude:e,voiceState:t,enableEntryAnimation:n,reducedMotion:o,cameraConfig:a,isMobile:l})=>{const{qualityLevel:c,isPerformanceGood:u}=((e={})=>{const{targetFPS:t=60,enableAdaptiveQuality:n=!0,logInterval:s=5e3,onPerformanceChange:o}=e,{gl:a}=m(),[l,c]=r.useState({fps:60,frameTime:16.67,drawCalls:0,triangles:0,geometries:0,textures:0,programs:0}),[u,d]=r.useState("high"),[h,f]=r.useState(!0),p=r.useRef([]),y=r.useRef(0),g=r.useRef(0),x=r.useCallback(e=>{if(0===e.length)return 60;const t=e.reduce((e,t)=>e+t,0)/e.length;return Math.round(1e3/t)},[]),v=r.useCallback(()=>{const e=a.info;return{drawCalls:e.render.calls,triangles:e.render.triangles,geometries:e.memory.geometries,textures:e.memory.textures,programs:e.programs?.length||0,memory:{geometries:e.memory.geometries,textures:e.memory.textures}}},[a]),w=r.useCallback(e=>e>=.8*t?"high":e>=.5*t?"medium":"low",[t]);return i((e,r)=>{const i=performance.now(),a=1e3*r;if(p.current.push(a),p.current.length>60&&p.current.shift(),s>0&&i-y.current>=s){const e=x(p.current),r=p.current.reduce((e,t)=>e+t,0)/p.current.length,s=v(),a={fps:e,frameTime:r,drawCalls:s.drawCalls||0,triangles:s.triangles||0,geometries:s.geometries||0,textures:s.textures||0,programs:s.programs||0,memory:s.memory};if(c(a),f(e>=.8*t),n){const t=w(e);t!==u&&d(t)}o?.(a),y.current=i}g.current=i}),r.useEffect(()=>()=>{a.info.reset()},[a]),{metrics:l,qualityLevel:u,isPerformanceGood:h,targetFPS:t}})({targetFPS:l?30:60,enableAdaptiveQuality:!0,logInterval:5e3,onPerformanceChange:e=>{}}),{cameraZ:d,roseScale:h,waterRippleStrength:p,auroraIntensity:y,isAnimating:g}=qe({enabled:n,duration:3,onComplete:()=>{}}),x=g?d:a.position[2];return s.jsxs(s.Fragment,{children:[s.jsx(f,{makeDefault:!0,position:[a.position[0],a.position[1],x],fov:a.fov,near:.1,far:1e3}),s.jsxs(r.Suspense,{fallback:null,children:[s.jsx(ze,{voiceState:t,audioAmplitude:e}),s.jsx(le,{}),s.jsx(ve,{audioAmplitude:e,animationScale:h,reducedMotion:o}),s.jsx(be,{audioAmplitude:e,rosePosition:[0,0],rippleStrength:p}),s.jsx(Le,{audioAmplitude:e}),s.jsx(_e,{}),s.jsx(De,{audioAmplitude:e,baseIntensity:y,reducedMotion:o}),s.jsx(Fe,{reducedMotion:o}),s.jsx(Be,{enabled:!o&&"low"!==c})]})]})},Ge=({audioAmplitude:e=0,voiceState:t="idle",enableEntryAnimation:r=!0,reducedMotion:n=!1})=>{const{cameraConfig:i,isMobile:o}=K();return s.jsx(h,{gl:{antialias:!0,alpha:!1,powerPreference:"high-performance"},dpr:o?[1,1.5]:[1,2],shadows:!0,style:{touchAction:"none"},frameloop:"always",children:s.jsx(He,{audioAmplitude:e,voiceState:t,enableEntryAnimation:r,reducedMotion:n,cameraConfig:i,isMobile:o})})},We=()=>s.jsx(L.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1.5,ease:"easeOut",delay:.5},className:"absolute top-8 sm:top-12 left-1/2 -translate-x-1/2 z-10 pointer-events-none px-4",children:s.jsxs("h1",{className:"text-white text-center select-none",children:[s.jsx("div",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light tracking-[0.25em] sm:tracking-[0.3em] mb-1 sm:mb-2 drop-shadow-lg",children:"ROSE"}),s.jsx("div",{className:"text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl font-light tracking-[0.15em] sm:tracking-[0.2em] opacity-90 drop-shadow-md",children:"THE HEALER SHAMAN"})]})}),Ve=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ye=(...e)=>e.filter((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),Ke=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var $e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=r.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:i="",children:o,iconNode:a,...l},c)=>r.createElement("svg",{ref:c,...$e,width:t,height:t,stroke:e,strokeWidth:s?24*Number(n)/Number(t):n,className:Ye("lucide",i),...!o&&!Ke(l)&&{"aria-hidden":"true"},...l},[...a.map(([e,t])=>r.createElement(e,t)),...Array.isArray(o)?o:[o]])),Qe=(e,t)=>{const n=r.forwardRef(({className:n,...s},i)=>{return r.createElement(Je,{ref:i,iconNode:t,className:Ye(`lucide-${o=Ve(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...s});var o});return n.displayName=Ve(e),n},Xe=Qe("accessibility",[["circle",{cx:"16",cy:"4",r:"1",key:"1grugj"}],["path",{d:"m18 19 1-7-6 1",key:"r0i19z"}],["path",{d:"m5 8 3-3 5.5 3-2.36 3.5",key:"9ptxx2"}],["path",{d:"M4.24 14.5a5 5 0 0 0 6.88 6",key:"10kmtu"}],["path",{d:"M13.76 17.5a5 5 0 0 0-6.88-6",key:"2qq6rc"}]]),Ze=Qe("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]),et=Qe("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),tt=Qe("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]),rt=Qe("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),nt=Qe("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),st=Qe("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),it=Qe("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ot=Qe("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),at=Qe("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),lt=Qe("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ct=Qe("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ut={idle:{scale:1,boxShadow:"0 0 20px rgba(77, 159, 255, 0.4)",transition:{duration:.3,ease:"easeOut"}},listening:{scale:1.1,boxShadow:"0 0 40px rgba(77, 159, 255, 0.8)",transition:{duration:.3,ease:"easeOut"}},processing:{scale:1.05,boxShadow:"0 0 30px rgba(157, 77, 255, 0.6)",transition:{duration:.3,ease:"easeInOut"}},speaking:{scale:[1,1.05,1],boxShadow:"0 0 30px rgba(255, 140, 66, 0.6)",transition:{repeat:1/0,duration:1,ease:"easeInOut"}}},dt={scale:1.05,transition:{duration:.2,ease:"easeOut"}},mt={scale:.95,transition:{duration:.1,ease:"easeIn"}},ht=({voiceState:e,onToggle:t,disabled:r=!1,audioAmplitude:n=0,isActive:i})=>{const o="speaking"===e?1+.1*n:1;return s.jsxs("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 z-10",children:["listening"===e&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{className:"absolute inset-0 rounded-full border-2 border-blue-400/50",initial:{scale:1,opacity:.8},animate:{scale:2,opacity:0},transition:{duration:1.5,repeat:1/0,ease:"easeOut"},style:{width:"80px",height:"80px",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),s.jsx(L.div,{className:"absolute inset-0 rounded-full border-2 border-blue-400/30",initial:{scale:1,opacity:.6},animate:{scale:2.5,opacity:0},transition:{duration:2,repeat:1/0,ease:"easeOut",delay:.5},style:{width:"80px",height:"80px",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})]}),"idle"===e&&s.jsx(L.div,{className:"absolute inset-0 rounded-full bg-blue-400/20 blur-xl",animate:{opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{width:"100px",height:"100px",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),s.jsxs(L.button,{className:"relative focus:outline-none focus-visible:ring-4 focus-visible:ring-blue-400/70 rounded-full touch-none select-none",variants:ut,animate:e,style:{scale:o,WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none"},whileHover:r?void 0:dt,whileTap:r?void 0:mt,onClick:()=>{r||(((e=10)=>{"vibrate"in navigator&&navigator.vibrate(e)})(15),t())},disabled:r,"aria-label":(()=>{switch(e){case"listening":return"Listening for your voice. Tap to mute.";case"processing":return"Processing your message...";case"speaking":return"Rose is responding...";default:return"Tap to activate Rose and start talking"}})(),"aria-pressed":i,role:"button",tabIndex:0,children:[s.jsx(L.div,{className:"w-20 h-20 rounded-full bg-white/10 backdrop-blur-md\r\n                     border-2 border-white/30 flex items-center justify-center",animate:{borderColor:"listening"===e?"rgba(77, 159, 255, 0.6)":"speaking"===e?"rgba(255, 140, 66, 0.6)":"rgba(255, 255, 255, 0.3)",backgroundColor:"listening"===e?"rgba(77, 159, 255, 0.15)":"speaking"===e?"rgba(255, 140, 66, 0.15)":"rgba(255, 255, 255, 0.1)"},transition:{duration:.3,ease:"easeInOut"},children:(()=>{switch(e){case"processing":return s.jsx(et,{className:"w-8 h-8 text-white animate-spin"});case"speaking":case"listening":return s.jsx(rt,{className:"w-8 h-8 text-white"});default:return s.jsx(tt,{className:"w-8 h-8 text-white/80"})}})()}),s.jsxs("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:["processing"===e&&"Processing your message...","speaking"===e&&"Rose is responding..."]})]})]})},ft=({isLoading:e,progress:t=0,currentAsset:r,phase:n})=>{const i=((e,t)=>{if(!e)return"critical"===t?"ðŸŽ¨":"secondary"===t?"ðŸŽ­":"effects"===t?"âœ¨":"ðŸ“¦";const r=e.split(".").pop()?.toLowerCase();return"css"===r?"ðŸŽ¨":"glb"===r||"gltf"===r||"jpg"===r||"png"===r||"webp"===r?"ðŸŽ­":"mp3"===r||"wav"===r||"ogg"===r?"ðŸŽµ":"ðŸ“¦"})(r,n),o=(e=>"critical"===e?"Loading essential elements":"secondary"===e?"Loading environmental details":"effects"===e?"Preparing visual effects":"complete"===e?"Ready":"Entering the sanctuary")(n),a=(l=r)?(l.split("/").pop()||"").split(".")[0].replace(/[-_]/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"";var l;return s.jsx(I,{children:e&&s.jsx(L.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:1,ease:"easeInOut"},className:"fixed inset-0 z-50 flex items-center justify-center",style:{background:`linear-gradient(to bottom, ${D} 0%, ${z} 100%)`},children:s.jsxs("div",{className:"text-center px-4 max-w-md",children:[s.jsx(L.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},className:"flex justify-center mb-6",children:s.jsx(et,{className:"w-12 h-12 text-white/60 animate-spin"})}),s.jsx(L.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.8},className:"text-white/60 text-sm tracking-wide mb-2",children:o}),a&&s.jsxs(L.p,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.3},className:"text-white/40 text-xs tracking-wide mb-6 flex items-center justify-center gap-2",children:[s.jsx("span",{className:"text-base",children:i}),s.jsx("span",{children:a})]},r),s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.8},className:"w-64 h-1 bg-white/10 rounded-full overflow-hidden mx-auto",children:s.jsx(L.div,{className:"h-full bg-white/40 rounded-full",initial:{width:"0%"},animate:{width:`${t}%`},transition:{duration:.3,ease:"easeOut"}})}),t>0&&s.jsxs(L.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7,duration:.5},className:"text-white/40 text-xs mt-3 tracking-wider",children:[Math.round(t),"%"]})]})})})},pt=({ambientVolume:e,onAmbientVolumeChange:t,reducedMotion:n,onReducedMotionChange:i})=>{const[o,a]=r.useState(!1),[l,c]=r.useState(!1),u=0===e;return s.jsxs("div",{className:"absolute top-6 right-6 z-10",onKeyDown:e=>{"Escape"===e.key&&o&&(e.preventDefault(),a(!1))},children:[s.jsx(L.button,{className:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-md\r\n                   border border-white/20 flex items-center justify-center\r\n                   focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\r\n                   transition-all duration-300",animate:{opacity:o||l?1:.3},whileHover:{scale:1.05,opacity:1},whileTap:{scale:.95},onClick:()=>a(!o),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),"aria-label":o?"Close settings":"Open settings","aria-expanded":o,"aria-controls":"settings-panel",children:o?s.jsx(ct,{className:"w-5 h-5 text-white/80"}):s.jsx(it,{className:"w-5 h-5 text-white/80"})}),s.jsx(I,{children:o&&s.jsxs(L.div,{id:"settings-panel",initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2,ease:"easeOut"},className:"absolute top-14 right-0 w-72 bg-white/10 backdrop-blur-md\r\n                       border border-white/20 rounded-lg p-4 shadow-xl",role:"region","aria-label":"Settings panel",children:[s.jsx("h3",{className:"text-white text-sm font-light tracking-wide mb-4",children:"Settings"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("label",{htmlFor:"ambient-volume",className:"text-white/80 text-xs tracking-wide",children:"Ambient Audio"}),s.jsx("button",{onClick:()=>{t(u?.5:0)},className:"p-1 rounded hover:bg-white/10 transition-colors\r\n                           focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50","aria-label":u?"Unmute ambient audio":"Mute ambient audio",tabIndex:0,children:u?s.jsx(lt,{className:"w-4 h-4 text-white/60"}):s.jsx(at,{className:"w-4 h-4 text-white/80"})})]}),s.jsx("input",{id:"ambient-volume",type:"range",min:"0",max:"1",step:"0.01",value:e,onChange:e=>t(parseFloat(e.target.value)),className:"w-full h-1 bg-white/20 rounded-lg appearance-none cursor-pointer\r\n                         [&::-webkit-slider-thumb]:appearance-none\r\n                         [&::-webkit-slider-thumb]:w-3\r\n                         [&::-webkit-slider-thumb]:h-3\r\n                         [&::-webkit-slider-thumb]:rounded-full\r\n                         [&::-webkit-slider-thumb]:bg-white\r\n                         [&::-webkit-slider-thumb]:cursor-pointer\r\n                         [&::-moz-range-thumb]:w-3\r\n                         [&::-moz-range-thumb]:h-3\r\n                         [&::-moz-range-thumb]:rounded-full\r\n                         [&::-moz-range-thumb]:bg-white\r\n                         [&::-moz-range-thumb]:border-0\r\n                         [&::-moz-range-thumb]:cursor-pointer","aria-label":"Ambient audio volume"}),s.jsxs("div",{className:"flex justify-between text-white/40 text-xs mt-1",children:[s.jsx("span",{children:"0%"}),s.jsxs("span",{children:[Math.round(100*e),"%"]}),s.jsx("span",{children:"100%"})]})]}),s.jsxs("div",{className:"border-t border-white/10 pt-4",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(Xe,{className:"w-4 h-4 text-white/60 mr-2"}),s.jsx("h4",{className:"text-white/80 text-xs tracking-wide",children:"Accessibility"})]}),s.jsxs("label",{className:"flex items-center justify-between cursor-pointer group",children:[s.jsx("span",{className:"text-white/70 text-xs",children:"Reduce Motion"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"checkbox",checked:n,onChange:e=>i(e.target.checked),className:"sr-only peer","aria-label":"Enable reduced motion"}),s.jsx("div",{className:"w-10 h-5 bg-white/20 rounded-full peer\r\n                               peer-checked:bg-blue-400/50\r\n                               peer-focus:ring-2 peer-focus:ring-white/40\r\n                               transition-colors duration-200"}),s.jsx("div",{className:"absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full\r\n                               peer-checked:translate-x-5\r\n                               transition-transform duration-200"})]})]}),s.jsx("p",{className:"text-white/40 text-xs mt-1 ml-0",children:"Simplifies animations for better accessibility"})]}),s.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:s.jsxs("p",{className:"text-white/40 text-xs leading-relaxed",children:["Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"Space"})," or"," ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"Enter"})," to activate voice interaction."," ","Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"?"})," for more keyboard shortcuts."]})})]})})]})},yt=()=>{const[e,t]=r.useState(!1);return r.useEffect(()=>{const r=r=>{"?"!==r.key||e?"Escape"===r.key&&e&&(r.preventDefault(),t(!1)):(r.preventDefault(),t(!0))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[e]),s.jsxs(s.Fragment,{children:[s.jsx(L.button,{className:"absolute bottom-6 right-6 z-10 w-10 h-10 rounded-full \r\n                   bg-white/10 backdrop-blur-md border border-white/20 \r\n                   flex items-center justify-center\r\n                   focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\r\n                   transition-all duration-300",whileHover:{scale:1.05,opacity:1},whileTap:{scale:.95},onClick:()=>t(!e),"aria-label":"Show keyboard shortcuts",title:"Keyboard shortcuts (?)",children:s.jsx(Ze,{className:"w-5 h-5 text-white/80"})}),s.jsx(I,{children:e&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:()=>t(!1)}),s.jsxs(L.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50\r\n                         w-full max-w-md bg-white/10 backdrop-blur-md\r\n                         border border-white/20 rounded-lg p-6 shadow-2xl",role:"dialog","aria-labelledby":"keyboard-help-title","aria-modal":"true",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{id:"keyboard-help-title",className:"text-white text-lg font-light tracking-wide flex items-center gap-2",children:[s.jsx(Ze,{className:"w-5 h-5"}),"Keyboard Shortcuts"]}),s.jsx("button",{onClick:()=>t(!1),className:"p-1 rounded hover:bg-white/10 transition-colors\r\n                           focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50","aria-label":"Close keyboard shortcuts",children:s.jsx(ct,{className:"w-5 h-5 text-white/80"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-white/90 text-sm font-medium mb-2",children:"Voice Interaction"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Start recording"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Space"}),s.jsx("span",{className:"text-white/50",children:"or"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Enter"})]})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Stop recording"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Release key"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Cancel recording"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Escape"})]})]})]}),s.jsxs("div",{className:"border-t border-white/10 pt-4",children:[s.jsx("h3",{className:"text-white/90 text-sm font-medium mb-2",children:"Navigation"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Move between elements"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Tab"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Move backwards"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Shift + Tab"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Activate button"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Enter"})]})]})]}),s.jsxs("div",{className:"border-t border-white/10 pt-4",children:[s.jsx("h3",{className:"text-white/90 text-sm font-medium mb-2",children:"Help"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Show this help"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"?"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Close dialogs"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Escape"})]})]})]})]}),s.jsx("div",{className:"mt-6 pt-4 border-t border-white/10",children:s.jsxs("p",{className:"text-white/50 text-xs leading-relaxed",children:["All interactive elements can be accessed using keyboard navigation. Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"Tab"})," to move between elements."]})})]})]})})]})},gt=({capabilities:e,onRetry:t})=>{const r=(e=>e.supported?e.maxTextureSize&&e.maxTextureSize<2048?"Your graphics hardware does not meet the minimum requirements for this experience":"An unknown error occurred while initializing 3D graphics":e.error||"WebGL is not supported in your browser")(e),n=(()=>{const e=navigator.userAgent.toLowerCase(),t=[],r=e.includes("chrome")&&!e.includes("edge"),n=e.includes("firefox"),s=e.includes("safari")&&!e.includes("chrome"),i=e.includes("edge")||e.includes("edg/");return e.includes("trident")||e.includes("msie")?(t.push("Internet Explorer is not supported. Please use a modern browser."),t.push("Recommended browsers: Chrome, Firefox, Safari, or Edge")):s?(t.push("Make sure you are using Safari 15 or later"),t.push("Check that hardware acceleration is enabled in Safari preferences")):n?(t.push("Make sure you are using Firefox 90 or later"),t.push("Check that WebGL is enabled in about:config (webgl.disabled should be false)")):r||i?(t.push("Make sure you are using the latest version of your browser"),t.push("Check that hardware acceleration is enabled in browser settings"),t.push("Try visiting chrome://gpu to see if WebGL is blocked")):(t.push("Please use a modern browser such as Chrome, Firefox, Safari, or Edge"),t.push("Make sure your browser is up to date")),t.push("Update your graphics drivers to the latest version"),t.push("Try disabling browser extensions that might block WebGL"),t})();return s.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#0a1e3d] to-[#1e4d8b] flex items-center justify-center z-50 p-4",children:s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"max-w-2xl w-full",children:[s.jsxs("div",{className:"bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-8 shadow-2xl",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("div",{className:"w-20 h-20 rounded-full bg-orange-500/20 flex items-center justify-center",children:s.jsx(ot,{className:"w-10 h-10 text-orange-400"})})}),s.jsx("h1",{className:"text-3xl font-light text-white text-center mb-4 tracking-wide",children:"3D Experience Unavailable"}),s.jsx("p",{className:"text-white/80 text-center mb-8 text-lg",children:r}),null!==e.version&&s.jsxs("details",{className:"mb-6 bg-white/5 rounded-lg p-4",children:[s.jsx("summary",{className:"text-white/60 text-sm cursor-pointer hover:text-white/80 transition-colors",children:"Technical Details"}),s.jsxs("div",{className:"mt-4 space-y-2 text-sm text-white/60 font-mono",children:[s.jsxs("div",{children:["WebGL Version: ",e.version||"Not supported"]}),e.renderer&&s.jsxs("div",{children:["Renderer: ",e.renderer]}),e.vendor&&s.jsxs("div",{children:["Vendor: ",e.vendor]}),e.maxTextureSize&&s.jsxs("div",{children:["Max Texture Size: ",e.maxTextureSize,"px"]})]})]}),s.jsxs("div",{className:"bg-white/5 rounded-lg p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(nt,{className:"w-5 h-5 text-blue-400"}),s.jsx("h2",{className:"text-white font-medium",children:"What can I do?"})]}),s.jsx("ul",{className:"space-y-3 text-white/70 text-sm",children:n.map((e,t)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-400 mt-1",children:"â€¢"}),s.jsx("span",{children:e})]},t))})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[t&&s.jsxs(L.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:t,className:"flex items-center justify-center gap-2 px-6 py-3 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-white transition-colors",children:[s.jsx(st,{className:"w-4 h-4"}),s.jsx("span",{children:"Try Again"})]}),s.jsxs(L.a,{whileHover:{scale:1.05},whileTap:{scale:.95},href:"https://get.webgl.org/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white transition-colors",children:[s.jsx(nt,{className:"w-4 h-4"}),s.jsx("span",{children:"Learn More About WebGL"})]})]}),s.jsx("div",{className:"mt-8 pt-6 border-t border-white/10",children:s.jsxs("p",{className:"text-white/50 text-sm text-center",children:["You can still access Rose through our"," ",s.jsx("a",{href:"/text",className:"text-blue-400 hover:text-blue-300 underline transition-colors",children:"text-only interface"})]})})]}),s.jsx("div",{className:"mt-6 text-center",children:s.jsx("p",{className:"text-white/40 text-xs",children:"Rose the Healer Shaman requires WebGL for the immersive 3D experience"})})]})})},xt=({children:e,enabled:t=!1})=>(((e={})=>{const{duration:t=1.2,easing:n=e=>Math.min(1,1.001-Math.pow(2,-10*e)),enabled:s=!0}=e,i=r.useRef(null),o=r.useRef(null);r.useEffect(()=>{if(!s)return;const e=new _({duration:t,easing:n});i.current=e;const r=t=>{e.raf(t),o.current=requestAnimationFrame(r)};return o.current=requestAnimationFrame(r),()=>{null!==o.current&&cancelAnimationFrame(o.current),i.current&&(i.current.destroy(),i.current=null)}},[t,n,s]),i.current})({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),enabled:t}),s.jsx(s.Fragment,{children:e})),vt={mimeType:{preferred:"audio/webm",fallbacks:["audio/mp4","audio/ogg"]},audioConstraints:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,latency:.01},timeslice:100,maxRecordingDuration:6e4,minRecordingDuration:300,minAudioSizeBytes:1e3,retryAttempts:2,retryDelay:1e3,errorResetDelay:3e3},wt={fftSize:512,smoothingTimeConstant:.85,minDecibels:-85,maxDecibels:-15,noiseGate:.02},bt=1e3,St=Object.freeze({unitMs:bt,voiceBurstWindowMs:3500,silenceHangoverMs:1200,minUtteranceMs:700,maxUtteranceMs:45e3,sessionActiveWindowMs:3e5,sessionInactivityGraceMs:15e3,playbackAutoplayRetryMs:2e3}),jt=Object.freeze({analyserFftSize:2048,rmsActivationThreshold:.015,rmsDeactivationThreshold:.007,consecutiveActivationFrames:4,consecutiveDeactivationFrames:6}),Et=(Object.freeze({prefixActivate:"ðŸš€ Voice session activated",prefixMute:"ðŸ›‘ Voice session muted",prefixUtteranceStart:"ðŸŽ¤ Capturing utterance",prefixUtteranceDiscard:"ðŸ—‘ï¸ Ignored utterance",prefixUtteranceQueue:"ðŸ“¬ Queued utterance",prefixProcessing:"ðŸ§  Processing utterance",prefixSpeaking:"ðŸ—£ï¸ Playing response",prefixRecovery:"ðŸ” Playback recovery"}),Object.freeze({sessionMissing:"ðŸ†˜ Session unavailable. Please refresh.",streamUnavailable:"ðŸŽ™ï¸ Microphone unavailable. Check permissions.",activationFailed:"âš ï¸ Could not start voice session. Please retry."})),kt=Object.freeze({bitsPerSample:16,monoChannels:1}),Ct=Object.freeze({readinessTimeoutMs:15e3,stallRetryLimit:2}),Rt=Object.freeze({rateLimitCooldownMs:1e4}),Tt="ðŸ”Œ No internet connection. Please check your network and try again.",Nt="ðŸ”Œ Cannot connect to Rose. Please ensure the server is running.",Mt="â±ï¸ Request timed out. The server is taking too long to respond. Please try again.",At="âŒ Server error occurred. Please try again in a moment.",Ot="ðŸŽ¤ Microphone access denied. Please allow microphone access in your browser settings.",Pt="ðŸŽ¤ No microphone found. Please connect a microphone and try again.",Lt="ðŸŽ¤ I couldn't hear that clearly. Could you try again?",It="ðŸŽ¤ Audio file is too large. Please record a shorter message.",_t="ðŸ”Š Failed to play audio response. Please check your speakers.",Ut="ðŸ”Š Network error loading audio. Please check your connection and try again.",Dt="ðŸ”Š Unable to decode audio. The audio file may be corrupted.",zt="ðŸ”Š Your browser doesn't support this audio format. Please try a different browser.",Ft="â±ï¸ Audio took too long to load. Please check your connection and try again.",Bt="ðŸ”Š Tap here to enable audio playback. Your browser blocked autoplay.",qt="ðŸ”Š Audio playback stalled. Retrying...",Ht="â±ï¸ Your session has expired. Please refresh the page.",Gt={TOO_MANY_REQUESTS:"â±ï¸ Too many requests. Please wait a moment and try again.",QUOTA_EXCEEDED:"â±ï¸ Usage quota exceeded. Please try again later.",RATE_LIMITED:"â±ï¸ You're sending requests too quickly. Please slow down."},Wt="ðŸ¥ Health check failed. The server may be down.",Vt="âŒ An unexpected error occurred. Please try again.",Yt={[Tt]:{category:"connection",severity:"error",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Nt]:{category:"connection",severity:"critical",isTransient:!1,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Mt]:{category:"connection",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Ot]:{category:"microphone",severity:"error",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!1},[Pt]:{category:"microphone",severity:"error",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!1},[Lt]:{category:"voice_processing",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[It]:{category:"voice_processing",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[_t]:{category:"playback",severity:"error",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Ht]:{category:"session",severity:"error",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!0},[Gt.TOO_MANY_REQUESTS]:{category:"rate_limit",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},"âŒ Failed to load critical assets. Please refresh the page.":{category:"asset",severity:"critical",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!0}};
/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function Kt(e){const t=function(e){return Yt[e]||{category:"generic",severity:"error",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1}}(e);return t.isTransient}function $t(e,t){return function(){return e.apply(t,arguments)}}const{toString:Jt}=Object.prototype,{getPrototypeOf:Qt}=Object,{iterator:Xt,toStringTag:Zt}=Symbol,er=(e=>t=>{const r=Jt.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),tr=e=>(e=e.toLowerCase(),t=>er(t)===e),rr=e=>t=>typeof t===e,{isArray:nr}=Array,sr=rr("undefined");function ir(e){return null!==e&&!sr(e)&&null!==e.constructor&&!sr(e.constructor)&&lr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const or=tr("ArrayBuffer");const ar=rr("string"),lr=rr("function"),cr=rr("number"),ur=e=>null!==e&&"object"==typeof e,dr=e=>{if("object"!==er(e))return!1;const t=Qt(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Zt in e||Xt in e)},mr=tr("Date"),hr=tr("File"),fr=tr("Blob"),pr=tr("FileList"),yr=tr("URLSearchParams"),[gr,xr,vr,wr]=["ReadableStream","Request","Response","Headers"].map(tr);function br(e,t,{allOwnKeys:r=!1}={}){if(null==e)return;let n,s;if("object"!=typeof e&&(e=[e]),nr(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{if(ir(e))return;const s=r?Object.getOwnPropertyNames(e):Object.keys(e),i=s.length;let o;for(n=0;n<i;n++)o=s[n],t.call(null,e[o],o,e)}}function Sr(e,t){if(ir(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n,s=r.length;for(;s-- >0;)if(n=r[s],t===n.toLowerCase())return n;return null}const jr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Er=e=>!sr(e)&&e!==jr;const kr=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&Qt(Uint8Array)),Cr=tr("HTMLFormElement"),Rr=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Tr=tr("RegExp"),Nr=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};br(r,(r,s)=>{let i;!1!==(i=t(r,s,e))&&(n[s]=i||r)}),Object.defineProperties(e,n)};const Mr=tr("AsyncFunction"),Ar=(Or="function"==typeof setImmediate,Pr=lr(jr.postMessage),Or?setImmediate:Pr?(Lr=`axios@${Math.random()}`,Ir=[],jr.addEventListener("message",({source:e,data:t})=>{e===jr&&t===Lr&&Ir.length&&Ir.shift()()},!1),e=>{Ir.push(e),jr.postMessage(Lr,"*")}):e=>setTimeout(e));var Or,Pr,Lr,Ir;const _r="undefined"!=typeof queueMicrotask?queueMicrotask.bind(jr):"undefined"!=typeof process&&process.nextTick||Ar,Ur={isArray:nr,isArrayBuffer:or,isBuffer:ir,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||lr(e.append)&&("formdata"===(t=er(e))||"object"===t&&lr(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&or(e.buffer),t},isString:ar,isNumber:cr,isBoolean:e=>!0===e||!1===e,isObject:ur,isPlainObject:dr,isEmptyObject:e=>{if(!ur(e)||ir(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(t){return!1}},isReadableStream:gr,isRequest:xr,isResponse:vr,isHeaders:wr,isUndefined:sr,isDate:mr,isFile:hr,isBlob:fr,isRegExp:Tr,isFunction:lr,isStream:e=>ur(e)&&lr(e.pipe),isURLSearchParams:yr,isTypedArray:kr,isFileList:pr,forEach:br,merge:function e(){const{caseless:t,skipUndefined:r}=Er(this)&&this||{},n={},s=(s,i)=>{const o=t&&Sr(n,i)||i;dr(n[o])&&dr(s)?n[o]=e(n[o],s):dr(s)?n[o]=e({},s):nr(s)?n[o]=s.slice():r&&sr(s)||(n[o]=s)};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&br(arguments[i],s);return n},extend:(e,t,r,{allOwnKeys:n}={})=>(br(t,(t,n)=>{r&&lr(t)?e[n]=$t(t,r):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let s,i,o;const a={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)o=s[i],n&&!n(o,e,t)||a[o]||(t[o]=e[o],a[o]=!0);e=!1!==r&&Qt(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:er,kindOfTest:tr,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(nr(e))return e;let t=e.length;if(!cr(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Xt]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:Cr,hasOwnProperty:Rr,hasOwnProp:Rr,reduceDescriptors:Nr,freezeMethods:e=>{Nr(e,(t,r)=>{if(lr(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];lr(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach(e=>{r[e]=!0})};return nr(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Sr,global:jr,isContextDefined:Er,isSpecCompliantForm:function(e){return!!(e&&lr(e.append)&&"FormData"===e[Zt]&&e[Xt])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(ur(e)){if(t.indexOf(e)>=0)return;if(ir(e))return e;if(!("toJSON"in e)){t[n]=e;const s=nr(e)?[]:{};return br(e,(e,t)=>{const i=r(e,n+1);!sr(i)&&(s[t]=i)}),t[n]=void 0,s}}return e};return r(e,0)},isAsyncFn:Mr,isThenable:e=>e&&(ur(e)||lr(e))&&lr(e.then)&&lr(e.catch),setImmediate:Ar,asap:_r,isIterable:e=>null!=e&&lr(e[Xt])};function Dr(e,t,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}Ur.inherits(Dr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ur.toJSONObject(this.config),code:this.code,status:this.status}}});const zr=Dr.prototype,Fr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Fr[e]={value:e}}),Object.defineProperties(Dr,Fr),Object.defineProperty(zr,"isAxiosError",{value:!0}),Dr.from=(e,t,r,n,s,i)=>{const o=Object.create(zr);Ur.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const a=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return Dr.call(o,a,l,r,n,s),e&&null==o.cause&&Object.defineProperty(o,"cause",{value:e,configurable:!0}),o.name=e&&e.name||"Error",i&&Object.assign(o,i),o};function Br(e){return Ur.isPlainObject(e)||Ur.isArray(e)}function qr(e){return Ur.endsWith(e,"[]")?e.slice(0,-2):e}function Hr(e,t,r){return e?e.concat(t).map(function(e,t){return e=qr(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}const Gr=Ur.toFlatObject(Ur,{},null,function(e){return/^is[A-Z]/.test(e)});function Wr(e,t,r){if(!Ur.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=Ur.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Ur.isUndefined(t[e])})).metaTokens,s=r.visitor||c,i=r.dots,o=r.indexes,a=(r.Blob||"undefined"!=typeof Blob&&Blob)&&Ur.isSpecCompliantForm(t);if(!Ur.isFunction(s))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Ur.isDate(e))return e.toISOString();if(Ur.isBoolean(e))return e.toString();if(!a&&Ur.isBlob(e))throw new Dr("Blob is not supported. Use a Buffer instead.");return Ur.isArrayBuffer(e)||Ur.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,s){let a=e;if(e&&!s&&"object"==typeof e)if(Ur.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(Ur.isArray(e)&&function(e){return Ur.isArray(e)&&!e.some(Br)}(e)||(Ur.isFileList(e)||Ur.endsWith(r,"[]"))&&(a=Ur.toArray(e)))return r=qr(r),a.forEach(function(e,n){!Ur.isUndefined(e)&&null!==e&&t.append(!0===o?Hr([r],n,i):null===o?r:r+"[]",l(e))}),!1;return!!Br(e)||(t.append(Hr(s,r,i),l(e)),!1)}const u=[],d=Object.assign(Gr,{defaultVisitor:c,convertValue:l,isVisitable:Br});if(!Ur.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!Ur.isUndefined(r)){if(-1!==u.indexOf(r))throw Error("Circular reference detected in "+n.join("."));u.push(r),Ur.forEach(r,function(r,i){!0===(!(Ur.isUndefined(r)||null===r)&&s.call(t,r,Ur.isString(i)?i.trim():i,n,d))&&e(r,n?n.concat(i):[i])}),u.pop()}}(e),t}function Vr(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Yr(e,t){this._pairs=[],e&&Wr(e,this,t)}const Kr=Yr.prototype;function $r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Jr(e,t,r){if(!t)return e;const n=r&&r.encode||$r;Ur.isFunction(r)&&(r={serialize:r});const s=r&&r.serialize;let i;if(i=s?s(t,r):Ur.isURLSearchParams(t)?t.toString():new Yr(t,r).toString(n),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}Kr.append=function(e,t){this._pairs.push([e,t])},Kr.toString=function(e){const t=e?function(t){return e.call(this,t,Vr)}:Vr;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class Qr{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ur.forEach(this.handlers,function(t){null!==t&&e(t)})}}const Xr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Zr={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Yr,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},en="undefined"!=typeof window&&"undefined"!=typeof document,tn="object"==typeof navigator&&navigator||void 0,rn=en&&(!tn||["ReactNative","NativeScript","NS"].indexOf(tn.product)<0),nn="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,sn=en&&window.location.href||"http://localhost",on={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:en,hasStandardBrowserEnv:rn,hasStandardBrowserWebWorkerEnv:nn,navigator:tn,origin:sn},Symbol.toStringTag,{value:"Module"})),...Zr};function an(e){function t(e,r,n,s){let i=e[s++];if("__proto__"===i)return!0;const o=Number.isFinite(+i),a=s>=e.length;if(i=!i&&Ur.isArray(n)?n.length:i,a)return Ur.hasOwnProp(n,i)?n[i]=[n[i],r]:n[i]=r,!o;n[i]&&Ur.isObject(n[i])||(n[i]=[]);return t(e,r,n[i],s)&&Ur.isArray(n[i])&&(n[i]=function(e){const t={},r=Object.keys(e);let n;const s=r.length;let i;for(n=0;n<s;n++)i=r[n],t[i]=e[i];return t}(n[i])),!o}if(Ur.isFormData(e)&&Ur.isFunction(e.entries)){const r={};return Ur.forEachEntry(e,(e,n)=>{t(function(e){return Ur.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,r,0)}),r}return null}const ln={transitional:Xr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,s=Ur.isObject(e);s&&Ur.isHTMLForm(e)&&(e=new FormData(e));if(Ur.isFormData(e))return n?JSON.stringify(an(e)):e;if(Ur.isArrayBuffer(e)||Ur.isBuffer(e)||Ur.isStream(e)||Ur.isFile(e)||Ur.isBlob(e)||Ur.isReadableStream(e))return e;if(Ur.isArrayBufferView(e))return e.buffer;if(Ur.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Wr(e,new on.classes.URLSearchParams,{visitor:function(e,t,r,n){return on.isNode&&Ur.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((i=Ur.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Wr(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||n?(t.setContentType("application/json",!1),function(e,t,r){if(Ur.isString(e))try{return(t||JSON.parse)(e),Ur.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ln.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Ur.isResponse(e)||Ur.isReadableStream(e))return e;if(e&&Ur.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(s){if(r){if("SyntaxError"===s.name)throw Dr.from(s,Dr.ERR_BAD_RESPONSE,this,null,this.response);throw s}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:on.classes.FormData,Blob:on.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ur.forEach(["delete","get","head","post","put","patch"],e=>{ln.headers[e]={}});const cn=Ur.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),un=Symbol("internals");function dn(e){return e&&String(e).trim().toLowerCase()}function mn(e){return!1===e||null==e?e:Ur.isArray(e)?e.map(mn):String(e)}function hn(e,t,r,n,s){return Ur.isFunction(n)?n.call(this,t,r):(s&&(t=r),Ur.isString(t)?Ur.isString(n)?-1!==t.indexOf(n):Ur.isRegExp(n)?n.test(t):void 0:void 0)}let fn=class{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function s(e,t,r){const s=dn(t);if(!s)throw new Error("header name must be a non-empty string");const i=Ur.findKey(n,s);(!i||void 0===n[i]||!0===r||void 0===r&&!1!==n[i])&&(n[i||t]=mn(e))}const i=(e,t)=>Ur.forEach(e,(e,r)=>s(e,r,t));if(Ur.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(Ur.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let r,n,s;return e&&e.split("\n").forEach(function(e){s=e.indexOf(":"),r=e.substring(0,s).trim().toLowerCase(),n=e.substring(s+1).trim(),!r||t[r]&&cn[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t})(e),t);else if(Ur.isObject(e)&&Ur.isIterable(e)){let r,n,s={};for(const t of e){if(!Ur.isArray(t))throw TypeError("Object iterator must return a key-value pair");s[n=t[0]]=(r=s[n])?Ur.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}i(s,t)}else null!=e&&s(t,e,r);return this}get(e,t){if(e=dn(e)){const r=Ur.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(Ur.isFunction(t))return t.call(this,e,r);if(Ur.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=dn(e)){const r=Ur.findKey(this,e);return!(!r||void 0===this[r]||t&&!hn(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function s(e){if(e=dn(e)){const s=Ur.findKey(r,e);!s||t&&!hn(0,r[s],s,t)||(delete r[s],n=!0)}}return Ur.isArray(e)?e.forEach(s):s(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const s=t[r];e&&!hn(0,this[s],s,e,!0)||(delete this[s],n=!0)}return n}normalize(e){const t=this,r={};return Ur.forEach(this,(n,s)=>{const i=Ur.findKey(r,s);if(i)return t[i]=mn(n),void delete t[s];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}(s):String(s).trim();o!==s&&delete t[s],t[o]=mn(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Ur.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&Ur.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(e=>r.set(e)),r}static accessor(e){const t=(this[un]=this[un]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=dn(e);t[n]||(!function(e,t){const r=Ur.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,s){return this[n].call(this,t,e,r,s)},configurable:!0})})}(r,e),t[n]=!0)}return Ur.isArray(e)?e.forEach(n):n(e),this}};function pn(e,t){const r=this||ln,n=t||r,s=fn.from(n.headers);let i=n.data;return Ur.forEach(e,function(e){i=e.call(r,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function yn(e){return!(!e||!e.__CANCEL__)}function gn(e,t,r){Dr.call(this,null==e?"canceled":e,Dr.ERR_CANCELED,t,r),this.name="CanceledError"}function xn(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Dr("Request failed with status code "+r.status,[Dr.ERR_BAD_REQUEST,Dr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}fn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ur.reduceDescriptors(fn.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}}),Ur.freezeMethods(fn),Ur.inherits(gn,Dr,{__CANCEL__:!0});const vn=(e,t,r=3)=>{let n=0;const s=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let s,i=0,o=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=n[o];s||(s=l),r[i]=a,n[i]=l;let u=o,d=0;for(;u!==i;)d+=r[u++],u%=e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),l-s<t)return;const m=c&&l-c;return m?Math.round(1e3*d/m):void 0}}(50,250);return function(e,t){let r,n,s=0,i=1e3/t;const o=(t,i=Date.now())=>{s=i,r=null,n&&(clearTimeout(n),n=null),e(...t)};return[(...e)=>{const t=Date.now(),a=t-s;a>=i?o(e,t):(r=e,n||(n=setTimeout(()=>{n=null,o(r)},i-a)))},()=>r&&o(r)]}(r=>{const i=r.loaded,o=r.lengthComputable?r.total:void 0,a=i-n,l=s(a);n=i;e({loaded:i,total:o,progress:o?i/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&i<=o?(o-i)/l:void 0,event:r,lengthComputable:null!=o,[t?"download":"upload"]:!0})},r)},wn=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},bn=e=>(...t)=>Ur.asap(()=>e(...t)),Sn=on.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,on.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(on.origin),on.navigator&&/(msie|trident)/i.test(on.navigator.userAgent)):()=>!0,jn=on.hasStandardBrowserEnv?{write(e,t,r,n,s,i){const o=[e+"="+encodeURIComponent(t)];Ur.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),Ur.isString(n)&&o.push("path="+n),Ur.isString(s)&&o.push("domain="+s),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function En(e,t,r){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const kn=e=>e instanceof fn?{...e}:e;function Cn(e,t){t=t||{};const r={};function n(e,t,r,n){return Ur.isPlainObject(e)&&Ur.isPlainObject(t)?Ur.merge.call({caseless:n},e,t):Ur.isPlainObject(t)?Ur.merge({},t):Ur.isArray(t)?t.slice():t}function s(e,t,r,s){return Ur.isUndefined(t)?Ur.isUndefined(e)?void 0:n(void 0,e,0,s):n(e,t,0,s)}function i(e,t){if(!Ur.isUndefined(t))return n(void 0,t)}function o(e,t){return Ur.isUndefined(t)?Ur.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,s,i){return i in t?n(r,s):i in e?n(void 0,r):void 0}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t,r)=>s(kn(e),kn(t),0,!0)};return Ur.forEach(Object.keys({...e,...t}),function(n){const i=l[n]||s,o=i(e[n],t[n],n);Ur.isUndefined(o)&&i!==a||(r[n]=o)}),r}const Rn=e=>{const t=Cn({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:a}=t;if(t.headers=o=fn.from(o),t.url=Jr(En(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),Ur.isFormData(r))if(on.hasStandardBrowserEnv||on.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(Ur.isFunction(r.getHeaders)){const e=r.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,r])=>{t.includes(e.toLowerCase())&&o.set(e,r)})}if(on.hasStandardBrowserEnv&&(n&&Ur.isFunction(n)&&(n=n(t)),n||!1!==n&&Sn(t.url))){const e=s&&i&&jn.read(i);e&&o.set(s,e)}return t},Tn="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,r){const n=Rn(e);let s=n.data;const i=fn.from(n.headers).normalize();let o,a,l,c,u,{responseType:d,onUploadProgress:m,onDownloadProgress:h}=n;function f(){c&&c(),u&&u(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let p=new XMLHttpRequest;function y(){if(!p)return;const n=fn.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());xn(function(e){t(e),f()},function(e){r(e),f()},{data:d&&"text"!==d&&"json"!==d?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:n,config:e,request:p}),p=null}p.open(n.method.toUpperCase(),n.url,!0),p.timeout=n.timeout,"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(y)},p.onabort=function(){p&&(r(new Dr("Request aborted",Dr.ECONNABORTED,e,p)),p=null)},p.onerror=function(t){const n=new Dr(t&&t.message?t.message:"Network Error",Dr.ERR_NETWORK,e,p);n.event=t||null,r(n),p=null},p.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const s=n.transitional||Xr;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new Dr(t,s.clarifyTimeoutError?Dr.ETIMEDOUT:Dr.ECONNABORTED,e,p)),p=null},void 0===s&&i.setContentType(null),"setRequestHeader"in p&&Ur.forEach(i.toJSON(),function(e,t){p.setRequestHeader(t,e)}),Ur.isUndefined(n.withCredentials)||(p.withCredentials=!!n.withCredentials),d&&"json"!==d&&(p.responseType=n.responseType),h&&([l,u]=vn(h,!0),p.addEventListener("progress",l)),m&&p.upload&&([a,c]=vn(m),p.upload.addEventListener("progress",a),p.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{p&&(r(!t||t.type?new gn(null,e,p):t),p.abort(),p=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);g&&-1===on.protocols.indexOf(g)?r(new Dr("Unsupported protocol "+g+":",Dr.ERR_BAD_REQUEST,e)):p.send(s||null)})},Nn=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const s=function(e){if(!r){r=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Dr?t:new gn(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,s(new Dr(`timeout ${t} of ms exceeded`,Dr.ETIMEDOUT))},t);const o=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(s):e.removeEventListener("abort",s)}),e=null)};e.forEach(e=>e.addEventListener("abort",s));const{signal:a}=n;return a.unsubscribe=()=>Ur.asap(o),a}},Mn=function*(e,t){let r=e.byteLength;if(r<t)return void(yield e);let n,s=0;for(;s<r;)n=s+t,yield e.slice(s,n),s=n},An=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},On=(e,t,r,n)=>{const s=async function*(e,t){for await(const r of An(e))yield*Mn(r,t)}(e,t);let i,o=0,a=e=>{i||(i=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await s.next();if(t)return a(),void e.close();let i=n.byteLength;if(r){let e=o+=i;r(e)}e.enqueue(new Uint8Array(n))}catch(t){throw a(t),t}},cancel:e=>(a(e),s.return())},{highWaterMark:2})},{isFunction:Pn}=Ur,Ln=(({Request:e,Response:t})=>({Request:e,Response:t}))(Ur.global),{ReadableStream:In,TextEncoder:_n}=Ur.global,Un=(e,...t)=>{try{return!!e(...t)}catch(r){return!1}},Dn=e=>{e=Ur.merge.call({skipUndefined:!0},Ln,e);const{fetch:t,Request:r,Response:n}=e,s=t?Pn(t):"function"==typeof fetch,i=Pn(r),o=Pn(n);if(!s)return!1;const a=s&&Pn(In),l=s&&("function"==typeof _n?(e=>t=>e.encode(t))(new _n):async e=>new Uint8Array(await new r(e).arrayBuffer())),c=i&&a&&Un(()=>{let e=!1;const t=new r(on.origin,{body:new In,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),u=o&&a&&Un(()=>Ur.isReadableStream(new n("").body)),d={stream:u&&(e=>e.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!d[e]&&(d[e]=(t,r)=>{let n=t&&t[e];if(n)return n.call(t);throw new Dr(`Response type '${e}' is not supported`,Dr.ERR_NOT_SUPPORT,r)})});const m=async(e,t)=>{const n=Ur.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(Ur.isBlob(e))return e.size;if(Ur.isSpecCompliantForm(e)){const t=new r(on.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Ur.isArrayBufferView(e)||Ur.isArrayBuffer(e)?e.byteLength:(Ur.isURLSearchParams(e)&&(e+=""),Ur.isString(e)?(await l(e)).byteLength:void 0)})(t):n};return async e=>{let{url:s,method:o,data:a,signal:l,cancelToken:h,timeout:f,onDownloadProgress:p,onUploadProgress:y,responseType:g,headers:x,withCredentials:v="same-origin",fetchOptions:w}=Rn(e),b=t||fetch;g=g?(g+"").toLowerCase():"text";let S=Nn([l,h&&h.toAbortSignal()],f),j=null;const E=S&&S.unsubscribe&&(()=>{S.unsubscribe()});let k;try{if(y&&c&&"get"!==o&&"head"!==o&&0!==(k=await m(x,a))){let e,t=new r(s,{method:"POST",body:a,duplex:"half"});if(Ur.isFormData(a)&&(e=t.headers.get("content-type"))&&x.setContentType(e),t.body){const[e,r]=wn(k,vn(bn(y)));a=On(t.body,65536,e,r)}}Ur.isString(v)||(v=v?"include":"omit");const t=i&&"credentials"in r.prototype,l={...w,signal:S,method:o.toUpperCase(),headers:x.normalize().toJSON(),body:a,duplex:"half",credentials:t?v:void 0};j=i&&new r(s,l);let h=await(i?b(j,w):b(s,l));const f=u&&("stream"===g||"response"===g);if(u&&(p||f&&E)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=h[t]});const t=Ur.toFiniteNumber(h.headers.get("content-length")),[r,s]=p&&wn(t,vn(bn(p),!0))||[];h=new n(On(h.body,65536,r,()=>{s&&s(),E&&E()}),e)}g=g||"text";let C=await d[Ur.findKey(d,g)||"text"](h,e);return!f&&E&&E(),await new Promise((t,r)=>{xn(t,r,{data:C,headers:fn.from(h.headers),status:h.status,statusText:h.statusText,config:e,request:j})})}catch(C){if(E&&E(),C&&"TypeError"===C.name&&/Load failed|fetch/i.test(C.message))throw Object.assign(new Dr("Network Error",Dr.ERR_NETWORK,e,j),{cause:C.cause||C});throw Dr.from(C,C&&C.code,e,j)}}},zn=new Map,Fn=e=>{let t=e?e.env:{};const{fetch:r,Request:n,Response:s}=t,i=[n,s,r];let o,a,l=i.length,c=zn;for(;l--;)o=i[l],a=c.get(o),void 0===a&&c.set(o,a=l?new Map:Dn(t)),c=a;return a};Fn();const Bn={http:null,xhr:Tn,fetch:{get:Fn}};Ur.forEach(Bn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(r){}Object.defineProperty(e,"adapterName",{value:t})}});const qn=e=>`- ${e}`,Hn=e=>Ur.isFunction(e)||null===e||!1===e,Gn=(e,t)=>{e=Ur.isArray(e)?e:[e];const{length:r}=e;let n,s;const i={};for(let o=0;o<r;o++){let r;if(n=e[o],s=n,!Hn(n)&&(s=Bn[(r=String(n)).toLowerCase()],void 0===s))throw new Dr(`Unknown adapter '${r}'`);if(s&&(Ur.isFunction(s)||(s=s.get(t))))break;i[r||"#"+o]=s}if(!s){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Dr("There is no suitable adapter to dispatch the request "+(r?e.length>1?"since :\n"+e.map(qn).join("\n"):" "+qn(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s};function Wn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new gn(null,e)}function Vn(e){Wn(e),e.headers=fn.from(e.headers),e.data=pn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Gn(e.adapter||ln.adapter,e)(e).then(function(t){return Wn(e),t.data=pn.call(e,e.transformResponse,t),t.headers=fn.from(t.headers),t},function(t){return yn(t)||(Wn(e),t&&t.response&&(t.response.data=pn.call(e,e.transformResponse,t.response),t.response.headers=fn.from(t.response.headers))),Promise.reject(t)})}const Yn="1.12.2",Kn={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Kn[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const $n={};Kn.transitional=function(e,t,r){return(n,s,i)=>{if(!1===e)throw new Dr(function(e,t){return"[Axios v"+Yn+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}(s," has been removed"+(t?" in "+t:"")),Dr.ERR_DEPRECATED);return t&&!$n[s]&&($n[s]=!0),!e||e(n,s,i)}},Kn.spelling=function(e){return(e,t)=>!0};const Jn={assertOptions:function(e,t,r){if("object"!=typeof e)throw new Dr("options must be an object",Dr.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const i=n[s],o=t[i];if(o){const t=e[i],r=void 0===t||o(t,i,e);if(!0!==r)throw new Dr("option "+i+" must be "+r,Dr.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new Dr("Unknown option "+i,Dr.ERR_BAD_OPTION)}},validators:Kn},Qn=Jn.validators;let Xn=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Qr,response:new Qr}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(n){}}throw r}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Cn(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:s}=t;void 0!==r&&Jn.assertOptions(r,{silentJSONParsing:Qn.transitional(Qn.boolean),forcedJSONParsing:Qn.transitional(Qn.boolean),clarifyTimeoutError:Qn.transitional(Qn.boolean)},!1),null!=n&&(Ur.isFunction(n)?t.paramsSerializer={serialize:n}:Jn.assertOptions(n,{encode:Qn.function,serialize:Qn.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Jn.assertOptions(t,{baseUrl:Qn.spelling("baseURL"),withXsrfToken:Qn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=s&&Ur.merge(s.common,s[t.method]);s&&Ur.forEach(["delete","get","head","post","put","patch","common"],e=>{delete s[e]}),t.headers=fn.concat(i,s);const o=[];let a=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let u,d=0;if(!a){const e=[Vn.bind(this),void 0];for(e.unshift(...o),e.push(...l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=o.length;let m=t;for(;d<u;){const e=o[d++],t=o[d++];try{m=e(m)}catch(h){t.call(this,h);break}}try{c=Vn.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return Jr(En((e=Cn(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ur.forEach(["delete","get","head","options"],function(e){Xn.prototype[e]=function(t,r){return this.request(Cn(r||{},{method:e,url:t,data:(r||{}).data}))}}),Ur.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,s){return this.request(Cn(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}Xn.prototype[e]=t(),Xn.prototype[e+"Form"]=t(!0)});const Zn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Zn).forEach(([e,t])=>{Zn[t]=e});const es=function e(t){const r=new Xn(t),n=$t(Xn.prototype.request,r);return Ur.extend(n,Xn.prototype,r,{allOwnKeys:!0}),Ur.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(Cn(t,r))},n}(ln);es.Axios=Xn,es.CanceledError=gn,es.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,s){r.reason||(r.reason=new gn(e,n,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},es.isCancel=yn,es.VERSION=Yn,es.toFormData=Wr,es.AxiosError=Dr,es.Cancel=es.CanceledError,es.all=function(e){return Promise.all(e)},es.spread=function(e){return function(t){return e.apply(null,t)}},es.isAxiosError=function(e){return Ur.isObject(e)&&!0===e.isAxiosError},es.mergeConfig=Cn,es.AxiosHeaders=fn,es.formToJSON=e=>an(Ur.isHTMLForm(e)?new FormData(e):e),es.getAdapter=Gn,es.HttpStatusCode=Zn,es.default=es;const{Axios:ts,AxiosError:rs,CanceledError:ns,isCancel:ss,CancelToken:is,VERSION:os,all:as,Cancel:ls,isAxiosError:cs,spread:us,toFormData:ds,AxiosHeaders:ms,HttpStatusCode:hs,formToJSON:fs,getAdapter:ps,mergeConfig:ys}=es;const gs=new class{constructor(){t(this,"client");this.client=es.create({baseURL:"/api/v1",timeout:6e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>navigator.onLine?e:Promise.reject(new Error(Tt)),e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>{e.config,e.config?.method?.toUpperCase(),e.response,e.response,e.message,e.response,e.config?.data instanceof FormData||e.config;if(e.message===Tt)throw new Error(Tt);if("ECONNABORTED"===e.code)throw new Error(Mt);if(e.response){const t=e.response.status,r=e.response.data;if(401===t||403===t)throw new Error(Ht);if(413===t)throw new Error(It);if(429===t)throw new Error(Gt.TOO_MANY_REQUESTS);if(t>=500)throw new Error(At);const n=r.detail||r.message||At;throw new Error(n)}throw e.request?new Error(Nt):new Error(Vt)})}async startSession(){return(await this.client.post("/session/start")).data}async processVoice(e,t){const r=new FormData;r.append("audio",e,"recording.webm"),r.append("session_id",t);return(await this.client.post("/voice/process",r,{headers:{"Content-Type":"multipart/form-data"}})).data}async checkHealth(){return(await this.client.get("/health")).data}},xs="/api/v1";let vs,ws="/api/v1";try{const e=new URL(xs);vs=e.origin,ws=e.pathname||"/"}catch{ws=xs}ws.startsWith("/")||(ws=`/${ws}`);const bs=e=>e?e.length>1&&e.endsWith("/")?e.slice(0,-1):e:"/";ws=bs(ws);const Ss=Object.values(Gt),js=({sessionId:e,onError:t,onResponseText:n,onAutoplayBlocked:s,onStateChange:i})=>{const[o,a]=r.useState(null),[l,c]=r.useState(""),u=r.useRef(null),d=r.useRef(0),m=r.useRef(null),h=r.useRef(0),f=r.useRef(!1),p=r.useCallback(e=>{i?.(e),"idle"===e&&a(null)},[i]),y=r.useCallback(()=>{if(u.current){const e=u.current;e.oncanplaythrough=null,e.oncanplay=null,e.onplay=null,e.onended=null,e.onerror=null,e.onstalled=null,e.onsuspend=null,e.pause(),e.src="",e.load(),u.current=null}m.current&&(URL.revokeObjectURL(m.current),m.current=null)},[]),g=r.useCallback(async e=>new Promise(async(r,n)=>{try{const o=++d.current;y();const l=new Audio;if(l.preload="auto","undefined"!=typeof window)try{const t=new URL(e.src,window.location.origin);t.protocol.startsWith("http")&&t.hostname!==window.location.hostname&&(l.crossOrigin="anonymous")}catch{e.src.startsWith("http")&&!e.src.includes(window.location.hostname)&&(l.crossOrigin="anonymous")}u.current=l,m.current=e.revokeOnCleanup?e.src:null;let c=0,h=null;const f=()=>o===d.current,g=()=>new Promise((e,t)=>{let r=!1;l.oncanplaythrough=()=>{f()&&(h&&clearTimeout(h),e())},l.oncanplay=()=>{f()},h=setTimeout(()=>{f()&&(r=!0,l.readyState>=HTMLMediaElement.HAVE_FUTURE_DATA?e():t(new Error(Ft)))},Ct.readinessTimeoutMs)});l.onstalled=()=>{f()&&(c<Ct.stallRetryLimit?(c+=1,a(qt),l.load()):(a(Ut),p("idle"),y(),t&&t(Ut),n(new Error(Ut))))},l.onsuspend=l.onstalled,l.onplay=()=>{f()&&p("speaking")},l.onended=()=>{f()&&(p("idle"),y(),r())},l.onerror=()=>{if(!f())return;const e=l.error;let r=_t;if(e)switch(e.code){case MediaError.MEDIA_ERR_NETWORK:r=Ut;break;case MediaError.MEDIA_ERR_DECODE:r=Dt;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:r=zt;break;case MediaError.MEDIA_ERR_ABORTED:return}a(r),p("idle"),y(),t&&t(r),n(new Error(r))};const x=g();l.src=e.src,l.load(),await x;try{await l.play()}catch(i){if(!f())return;if(i instanceof Error&&"NotAllowedError"===i.name)return a(Bt),p("idle"),s&&s(),t&&t(Bt),void n(new Error(Bt));throw i}}catch(o){const e=o instanceof Error?o.message:_t;a(e),p("idle"),y(),t&&t(e),n(o)}}),[y,s,t,p]),x=r.useCallback(async e=>{const t=(e=>{if(!e)return e;if(/^https?:\/\//i.test(e)||e.startsWith("blob:"))return e;const t=e.startsWith("/")?e:`/${e}`;if(vs)return`${vs}${t}`;const r=bs(ws);return"/"===r||t.startsWith(r)?t:`${r}${t}`})(e);if("undefined"==typeof window)return{src:t,revokeOnCleanup:!1};let r=!1;try{r=new URL(t,window.location.origin).origin!==window.location.origin}catch{r=!1}if(!r)return{src:t,revokeOnCleanup:!1};try{const e=await fetch(t,{credentials:"include"});if(!e.ok)throw new Error(`Audio fetch failed with status ${e.status}`);const r=await e.blob();return{src:URL.createObjectURL(r),revokeOnCleanup:!0}}catch(n){return{src:t,revokeOnCleanup:!1}}},[]),v=r.useCallback(async r=>{if(!e){const e=Et.sessionMissing;throw a(e),t&&t(e),new Error(e)}const s=Date.now(),i=h.current;var o;if(i&&s<i)f.current||(a(Gt.TOO_MANY_REQUESTS),t&&t(Gt.TOO_MANY_REQUESTS),f.current=!0);else if(i&&s>=i&&(h.current=0,f.current=!1),!(r.size<vt.minAudioSizeBytes))try{p("processing");const t=await gs.processVoice(r,e);c(t.text),n&&n(t.text);const s=await x(t.audio_url);await g(s)}catch(l){const e=l instanceof Error?l.message:Lt;a(e),p("idle"),t&&t(e),o=e,Ss.includes(o)&&(h.current=Date.now()+Rt.rateLimitCooldownMs,f.current=!1)}},[x,e,t,n,g,p]),w=r.useCallback(async()=>{if(u.current)try{await u.current.play(),a(null),p("speaking")}catch(e){const r=_t;a(r),t&&t(r)}},[t,p]),b=r.useCallback(()=>{y(),p("idle")},[y,p]);return r.useEffect(()=>()=>{y()},[y]),{processAudioBlob:v,stopAudio:b,retryPlayback:w,audioElement:u.current,error:o,responseText:l}},Es=({sessionId:e,onError:t,onResponseText:n,onAutoplayBlocked:s})=>{const[i,o]=r.useState("idle"),[a,l]=r.useState(""),[c,u]=r.useState(null),[d,m]=r.useState("muted"),h=r.useRef(null),f=r.useRef(null),p=r.useRef(null),y=r.useRef(null),g=r.useRef(null),x=r.useRef(null),v=r.useRef(null),w=r.useRef(null),b=r.useRef([]),S=r.useRef(0),j=r.useRef(Promise.resolve()),E=r.useRef(!1),k=r.useRef(0),C=r.useRef(0),R=r.useRef("muted"),T=r.useRef(!1),N=r.useRef(async()=>{}),M=r.useCallback(e=>{u(e),t?.(e)},[t]),A=r.useCallback(()=>{u(null)},[]),O=r.useCallback(()=>{null!==g.current&&(cancelAnimationFrame(g.current),g.current=null)},[]),P=r.useCallback(()=>{v.current&&(clearTimeout(v.current),v.current=null)},[]),L=r.useCallback(()=>{x.current&&(clearTimeout(x.current),x.current=null),P()},[P]),I=r.useCallback(()=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{(0,N.current)()},St.sessionActiveWindowMs)},[]),_=r.useCallback(()=>{P(),v.current=setTimeout(()=>{(0,N.current)()},St.sessionInactivityGraceMs)},[P]),U=r.useCallback(()=>{k.current=0,C.current=0},[]),D=r.useCallback(async()=>{if(O(),L(),w.current){const e=w.current;"inactive"!==e.state&&(E.current=!0,e.stop()),w.current=null}h.current&&(h.current.getTracks().forEach(e=>e.stop()),h.current=null),f.current&&(await f.current.close(),f.current=null),p.current=null,y.current=null,b.current=[],T.current=!1},[O,L]),z=r.useCallback(async()=>{if(!h.current||!w.current)try{const e=await navigator.mediaDevices.getUserMedia({audio:vt.audioConstraints});h.current=e;const t=new AudioContext;f.current=t;const r=t.createMediaStreamSource(e),n=t.createAnalyser();n.fftSize=jt.analyserFftSize,n.smoothingTimeConstant=.85,p.current=n;const s=new ArrayBuffer(n.fftSize*Float32Array.BYTES_PER_ELEMENT);y.current=new Float32Array(s),r.connect(n);const i=(()=>{const{preferred:e,fallbacks:t}=vt.mimeType,r=[e,...t];for(const n of r)if(MediaRecorder.isTypeSupported(n))return n;return e})(),a=new MediaRecorder(e,{mimeType:i,bitsPerSecond:vt.audioConstraints.sampleRate*kt.bitsPerSample});w.current=a,a.ondataavailable=e=>{e.data.size>0&&b.current.push(e.data)},a.onstop=()=>{const e=b.current,t=S.current;if(b.current=[],T.current=!1,E.current)return void(E.current=!1);if(performance.now()-t<St.minUtteranceMs)return void("active"===R.current&&_());const r=new Blob(e,{type:a.mimeType});r.size<vt.minAudioSizeBytes?"active"===R.current&&_():j.current=j.current.then(()=>V.processAudioBlob(r)).catch(e=>{const t=e instanceof Error?e.message:Lt;M(t)}).finally(()=>{"active"===R.current&&(o("listening"),_())})}}catch(e){throw M(Et.streamUnavailable),await D(),e}},[M,_,D]),F=r.useCallback(()=>{const e=w.current;e&&"inactive"===e.state&&(P(),b.current=[],S.current=performance.now(),T.current=!0,e.start())},[P]),B=r.useCallback(()=>{const e=w.current;e&&"recording"===e.state&&e.stop()},[]),q=r.useCallback(()=>{const e=p.current,t=y.current;if(!e||!t)return;e.getFloatTimeDomainData(t);const r=(e=>{if(0===e.length)return 0;let t=0;for(let r=0;r<e.length;r+=1){const n=e[r];t+=n*n}return Math.sqrt(t/e.length)})(t);r>=jt.rmsActivationThreshold?(k.current+=1,C.current=0):r<=jt.rmsDeactivationThreshold?(C.current+=1,k.current=0):(k.current=Math.max(k.current-1,0),C.current=Math.max(C.current-1,0));const n=!T.current&&k.current>=jt.consecutiveActivationFrames,s=T.current&&C.current>=jt.consecutiveDeactivationFrames;if(n?(U(),F(),o("listening")):s&&(U(),B()),T.current){performance.now()-S.current>St.maxUtteranceMs&&B()}g.current=requestAnimationFrame(q)},[F,B,U,_]),H=r.useCallback(()=>{O(),g.current=requestAnimationFrame(q)},[q,O]),G=r.useCallback(e=>{"active"===R.current?o("idle"===e?"listening":e):o(e)},[]),W=r.useCallback(e=>{M(e),"active"===R.current?o("listening"):o("idle")},[M]),V=js({sessionId:e,onError:W,onResponseText:e=>{l(e),n?.(e)},onAutoplayBlocked:s,onStateChange:G}),Y=r.useCallback(async()=>{if("active"!==R.current)if(e)try{await z(),I(),_(),H(),A(),o("listening"),m("active"),R.current="active"}catch(t){M(Et.activationFailed)}else M(Et.sessionMissing)},[A,z,M,I,_,H,e]),K=r.useCallback(async()=>{"muted"!==R.current&&(R.current="muted",m("muted"),L(),O(),U(),await D(),V.stopAudio(),o("idle"))},[V,U,O,L,D]),$=r.useCallback(async()=>{"active"===R.current?await K():await Y()},[Y,K]);return r.useEffect(()=>{N.current=K},[K]),r.useEffect(()=>()=>{R.current="muted",K()},[K]),r.useMemo(()=>({voiceState:i,error:c,responseText:a,isSessionActive:"active"===d,toggleSession:$,muteSession:K,activateSession:Y,retryPlayback:V.retryPlayback,stopAudio:V.stopAudio,audioElement:V.audioElement}),[Y,c,K,V,d,$,i,a])},ks="ðŸŽ¨",Cs="ðŸŽ­",Rs="ðŸŽ­",Ts="ðŸŽµ",Ns="ðŸ“¦",Ms=[],As=[],Os=e=>{const t=e.split(".").pop()?.toLowerCase();return"css"===t?ks:"glb"===t||"gltf"===t?Cs:"jpg"===t||"png"===t||"webp"===t?Rs:"mp3"===t||"wav"===t||"ogg"===t?Ts:Ns},Ps=()=>{const[e,t]=r.useState(!0),[n,s]=r.useState(null),[i,o]=r.useState(0),a=()=>{t(!0),setTimeout(()=>{try{const e=(()=>{const e=document.createElement("canvas");let t=null,r=null;try{t=e.getContext("webgl2"),t&&(r=2)}catch(o){}if(!t)try{t=e.getContext("webgl")||e.getContext("experimental-webgl"),t&&(r=1)}catch(o){}if(!t||!r)return{supported:!1,version:null,renderer:null,vendor:null,maxTextureSize:null,error:"WebGL is not supported in your browser"};let n=null,s=null,i=null;try{const e=t.getExtension("WEBGL_debug_renderer_info");e&&(n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),s=t.getParameter(e.UNMASKED_VENDOR_WEBGL)),i=t.getParameter(t.MAX_TEXTURE_SIZE)}catch(o){}try{t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}catch(o){return{supported:!1,version:null,renderer:n,vendor:s,maxTextureSize:i,error:"WebGL context is not functional"}}return{supported:!0,version:r,renderer:n,vendor:s,maxTextureSize:i,error:null}})();s(e)}catch(e){s({supported:!1,version:null,renderer:null,vendor:null,maxTextureSize:null,error:"An error occurred while detecting WebGL support"})}finally{t(!1)}},100)};r.useEffect(()=>{a()},[i]);const l=!!n&&(e=>!(!e.supported||!e.version||e.maxTextureSize&&e.maxTextureSize<2048))(n);return{isSupported:l,isChecking:e,capabilities:n,retry:()=>{o(e=>e+1)}}};function Ls(){const[e,t]=r.useState(!1),[n,i]=r.useState(""),[o,a]=r.useState(null),l=r.useRef(null),{isHealthy:c,error:u,version:d,isLoading:m}=(()=>{const[e,t]=r.useState(null),[n,s]=r.useState(null),[i,o]=r.useState(null),[a,l]=r.useState(!0);return r.useEffect(()=>{(async()=>{try{l(!0);const e=await gs.checkHealth();t(!0),o(e.version||null),s(null)}catch(e){const r=e instanceof Error?e.message:Wt;s(r),t(!1),o(null)}finally{l(!1)}})()},[]),{isHealthy:e,error:n,version:i,isLoading:a}})(),{isSupported:h,isChecking:f,capabilities:p,retry:y}=Ps(),{isLoading:g,progress:x,error:v}=((e={})=>{const{enabled:t=!0,onProgress:n,onComplete:s,onError:i}=e,[o,a]=r.useState({loaded:0,total:0,percentage:0,phase:"critical",failedAssets:[],criticalAssetsFailed:!1}),[l,c]=r.useState(!0),[u,d]=r.useState(null),[m,h]=r.useState([]),f=r.useRef(n),p=r.useRef(s),y=r.useRef(i);r.useEffect(()=>{f.current=n},[n]),r.useEffect(()=>{p.current=s},[s]),r.useEffect(()=>{y.current=i},[i]);const g=Ms.length+As.length,x=r.useCallback((e,t,r,n,s)=>{const i=g>0?Math.round(e/g*100):0,o={loaded:e,total:g,percentage:i,phase:t,currentAsset:r,failedAssets:n,criticalAssetsFailed:s};a(o),f.current?.(o)},[g,n]);return r.useEffect(()=>{if(!t)return void c(!1);let e=0,r=!1;return(async()=>{try{const n=[];let s=!1;x(e,"critical","Loading essential scene elements...",n,s);for(const i of Ms){if(r)return;try{Os(i),e++,x(e,"critical",i,n,s),await new Promise(e=>setTimeout(e,100))}catch(t){n.push(i),s=!0,h(e=>[...e,i])}}if(s)throw new Error(`Critical assets failed to load: ${n.join(", ")}`);if(r)return;x(e,"secondary","Loading environmental details...",n,s);for(const i of As){if(r)return;try{Os(i),e++,x(e,"secondary",i,n,s),await new Promise(e=>setTimeout(e,100))}catch(t){n.push(i),h(e=>[...e,i])}}if(n.length,r)return;if(x(e,"effects","Preparing visual effects...",n,s),await new Promise(e=>setTimeout(e,200)),r)return;n.length,x(g,"complete","Ready",n,s),c(!1),p.current?.()}catch(t){if(!r){const e=t instanceof Error?t:new Error("Asset loading failed");d(e),c(!1),y.current?.(e)}}})(),()=>{r=!0}},[t,x,g]),{isLoading:l,progress:o,error:u,failedAssets:m}})({enabled:h,onProgress:e=>{},onComplete:()=>{},onError:e=>{a("Failed to load scene assets. Please refresh the page.")}});r.useEffect(()=>{u&&a(u)},[u,d]),r.useEffect(()=>{if(l.current&&(clearTimeout(l.current),l.current=null),o){const e=Kt(o)?5e3:null;null!==e&&(l.current=setTimeout(()=>{a(null),l.current=null},e))}return()=>{l.current&&(clearTimeout(l.current),l.current=null)}},[o]),r.useEffect(()=>{if(!1===c)return;if(null===c)return;(async()=>{try{const e=localStorage.getItem("rose_session_id");if(e)return void i(e);const t=await gs.startSession();i(t.session_id),localStorage.setItem("rose_session_id",t.session_id)}catch(e){a("Failed to connect to Rose. Please refresh the page.")}})()},[c]);const{voiceState:w,error:b,isSessionActive:S,toggleSession:j,muteSession:E,audioElement:k}=Es({sessionId:n,onError:e=>a(e)}),{amplitude:C}=((e,t={})=>{const{fftSize:n=wt.fftSize,smoothingTimeConstant:s=wt.smoothingTimeConstant,minDecibels:i=wt.minDecibels,maxDecibels:o=wt.maxDecibels,enabled:a=!0}=t,[l,c]=r.useState({amplitude:0,frequency:0,frequencyData:new Uint8Array(0),waveformData:new Uint8Array(0)}),u=r.useRef(null),d=r.useRef(null),m=r.useRef(null),h=r.useRef(null),f=r.useRef(!1),p=r.useCallback(()=>{if(e&&a&&!f.current)try{const t=new(window.AudioContext||window.webkitAudioContext);u.current=t;const r=t.createAnalyser();r.fftSize=n,r.smoothingTimeConstant=s,r.minDecibels=i,r.maxDecibels=o,d.current=r;const a=t.createMediaElementSource(e);m.current=a,a.connect(r),r.connect(t.destination),f.current=!0,g()}catch(t){}},[e,a,n,s,i,o]),y=r.useCallback(()=>{if(!d.current||!a)return;const e=d.current,t=e.frequencyBinCount,r=new Uint8Array(t),n=new Uint8Array(t);e.getByteFrequencyData(r),e.getByteTimeDomainData(n);let s=r.reduce((e,t)=>e+t,0)/t/255;s<wt.noiseGate&&(s=0);let i=0,o=0;for(let a=0;a<t;a++)r[a]>i&&(i=r[a],o=a);const l=(u.current?.sampleRate||44100)/2;c({amplitude:s,frequency:o/t*l,frequencyData:r,waveformData:n}),h.current=requestAnimationFrame(y)},[a]),g=r.useCallback(()=>{h.current&&cancelAnimationFrame(h.current),h.current=requestAnimationFrame(y)},[y]),x=r.useCallback(()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)},[]);return r.useEffect(()=>{if(e&&a&&!f.current){const t=()=>{p()};if(!(e.readyState>=2))return e.addEventListener("canplay",t),()=>{e.removeEventListener("canplay",t)};p()}},[e,a,p]),r.useEffect(()=>()=>{x(),u.current&&(u.current.close(),u.current=null),f.current=!1},[x]),{amplitude:l.amplitude,frequency:l.frequency,frequencyData:l.frequencyData,waveformData:l.waveformData,startAnalysis:g,stopAnalysis:x,isAnalyzing:null!==h.current}})(k);return r.useEffect(()=>{},[w,()=>{},()=>{}]),r.useEffect(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)");t(e.matches);const r=e=>{t(e.matches)};return e.addEventListener("change",r),()=>e.removeEventListener("change",r)},[]),r.useEffect(()=>{v&&a(v.message)},[v]),r.useEffect(()=>{const e=e=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLButtonElement||(" "!==e.key&&"Enter"!==e.key||e.repeat||(e.preventDefault(),j()),"Escape"===e.key&&(e.preventDefault(),E()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[E,j]),f||h||!p?s.jsx(xt,{enabled:!1,children:s.jsxs("div",{className:"app-container relative w-full h-screen overflow-hidden",children:[s.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-black",children:"Skip to main content"}),s.jsx(ft,{isLoading:g||f||m,progress:x.percentage,currentAsset:x.currentAsset,phase:x.phase}),(o||b)&&!g&&s.jsx("div",{className:"absolute top-24 left-1/2 -translate-x-1/2 z-20 max-w-md px-4",children:s.jsxs("div",{className:"bg-red-500/20 backdrop-blur-md border border-red-500/30 rounded-lg p-4 relative",children:[s.jsx("p",{className:"text-white text-sm text-center pr-8",children:o||b}),s.jsx("button",{type:"button",onClick:()=>{a(null)},className:"absolute top-2 right-2 text-white/70 hover:text-white transition-colors","aria-label":"Dismiss error",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),o&&Kt(o)&&s.jsx("p",{className:"text-white/50 text-xs text-center mt-2",children:"Auto-dismissing in 5 seconds..."})]})}),!g&&n&&s.jsx(r.Suspense,{fallback:null,children:s.jsx(Ge,{voiceState:w,audioAmplitude:C,reducedMotion:e})}),!g&&s.jsxs("div",{id:"main-content",role:"main",children:[s.jsx(We,{}),s.jsx(ht,{voiceState:w,onToggle:j,isActive:S,audioAmplitude:C,disabled:!n||!!o}),"idle"===w&&!S&&s.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-10 text-center animate-pulse",children:s.jsx("p",{className:"text-white/70 text-sm font-medium tracking-wide",children:"Tap once to start voice session"})}),S&&"listening"===w&&s.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-10 text-center",children:s.jsx("p",{className:"text-white/80 text-sm font-medium tracking-wide",children:"Rose is listening for your voice..."})}),s.jsx(pt,{ambientVolume:0,onAmbientVolumeChange:()=>{},reducedMotion:e,onReducedMotionChange:t}),s.jsx(yt,{})]})]})}):s.jsx(gt,{capabilities:p,onRetry:y})}p.createRoot(document.getElementById("root")).render(s.jsx(n.StrictMode,{children:s.jsx(xt,{enabled:!1,children:s.jsx(Ls,{})})}));
