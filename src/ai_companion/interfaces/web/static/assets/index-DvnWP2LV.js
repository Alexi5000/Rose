var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import{r as n,R as r,j as s,u as o,E as i,B as a,a as l,H as c,b as u,V as d,c as m,C as h,P as p,d as f}from"./r3f-D-aVanHc.js";import{m as g,c as y,h as x,Q as v,X as w,s as b,Y as j,z as S,Z as E,_ as k,u as R,d as C,v as N,t as T,$ as M,a0 as A,a1 as O}from"./three-SCLi_tbI.js";import{g as P,m as L,A as I,L as _}from"./animations-B_8wJt7L.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const D={uniforms:{time:{value:0},lightPosition:{value:new y(0,10,5)},baseColor:{value:new g("#4d9fff")},emissiveColor:{value:new g("#5dadff")},translucency:{value:.9},subsurfaceStrength:{value:.6},fresnelPower:{value:2.5},glowIntensity:{value:.5},refractionStrength:{value:.1}},vertexShader:"\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying vec3 vViewPosition;\n    varying vec2 vUv;\n    \n    void main() {\n      vUv = uv;\n      vNormal = normalize(normalMatrix * normal);\n      vPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n      \n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      vViewPosition = -mvPosition.xyz;\n      \n      gl_Position = projectionMatrix * mvPosition;\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform vec3 lightPosition;\n    uniform vec3 baseColor;\n    uniform vec3 emissiveColor;\n    uniform float translucency;\n    uniform float subsurfaceStrength;\n    uniform float fresnelPower;\n    uniform float glowIntensity;\n    uniform float refractionStrength;\n    \n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying vec3 vViewPosition;\n    varying vec2 vUv;\n    \n    // Simple noise function for surface detail\n    float noise(vec2 st) {\n      return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n    }\n    \n    void main() {\n      // Normalize vectors\n      vec3 normal = normalize(vNormal);\n      vec3 viewDir = normalize(vViewPosition);\n      vec3 lightDir = normalize(lightPosition - vPosition);\n      \n      // Fresnel effect for edge glow\n      float fresnel = pow(1.0 - max(0.0, dot(normal, viewDir)), fresnelPower);\n      \n      // Subsurface scattering approximation\n      // Light passing through the ice\n      float subsurface = max(0.0, dot(-lightDir, normal));\n      subsurface = pow(subsurface, 2.0) * subsurfaceStrength;\n      \n      // Add surface detail using noise\n      float surfaceNoise = noise(vUv * 10.0 + time * 0.1) * 0.1;\n      \n      // Combine base color with subsurface and fresnel\n      vec3 iceColor = baseColor;\n      iceColor += subsurface * vec3(0.3, 0.6, 1.0); // Blue subsurface tint\n      iceColor += fresnel * vec3(0.5, 0.8, 1.0) * glowIntensity; // Edge glow\n      \n      // Add emissive glow\n      vec3 emissive = emissiveColor * 0.2;\n      \n      // Final color\n      vec3 finalColor = iceColor + emissive + surfaceNoise;\n      \n      // Calculate opacity with fresnel for translucency\n      float alpha = mix(translucency, 1.0, fresnel * 0.5);\n      \n      gl_FragColor = vec4(finalColor, alpha);\n    }\n  "},U="#0a1e3d",F="#1e4d8b",z="#4d9fff",B="#ff8c42",q=768,H=1024,G=1440,W={mobile:{position:[0,2,14],fov:60},tablet:{position:[0,2,12],fov:55},desktop:{position:[0,2,12],fov:50},ultrawide:{position:[0,2,12],fov:50}},V={mobile:{shadows:!1,postProcessing:!1,particleCount:200,waterSubdivision:32},tablet:{shadows:!0,postProcessing:!0,particleCount:500,waterSubdivision:64},desktop:{shadows:!0,postProcessing:!0,particleCount:1e3,waterSubdivision:128}},K={high:{maxSize:2048,anisotropy:16,generateMipmaps:!0,minFilter:w,magFilter:x},medium:{maxSize:1024,anisotropy:8,generateMipmaps:!0,minFilter:w,magFilter:x},low:{maxSize:512,anisotropy:4,generateMipmaps:!0,minFilter:v,magFilter:x}},Y=()=>{const[e,t]=n.useState("desktop"),[r,s]=n.useState(16/9);n.useEffect(()=>{const e=()=>{const e=window.innerWidth,n=window.innerHeight;s(e/n),t(e<q?"mobile":e<H?"tablet":e<G?"desktop":"ultrawide")};let n;e();const r=()=>{clearTimeout(n),n=window.setTimeout(e,100)};return window.addEventListener("resize",r),()=>{clearTimeout(n),window.removeEventListener("resize",r)}},[]);const o="ultrawide"===e?V.desktop:V[e],i=(a="tablet"===e,"mobile"===e?K.low:a?K.medium:K.high);var a;return{viewport:e,cameraConfig:W[e],quality:o,aspectRatio:r,isMobile:"mobile"===e,isTablet:"tablet"===e,isDesktop:"desktop"===e||"ultrawide"===e,isPortrait:r<1,isLandscape:r>=1,enablePostProcessing:o.postProcessing,enableShadows:o.shadows,particleCount:o.particleCount,waterSubdivision:o.waterSubdivision,textureQuality:i}},J="#0a1e3d",$="#4d9fff",Z="#ff6b9d",X={ice:{color:$,emissive:J,emissiveIntensity:.25,metalness:.05,roughness:.25},rose:{color:"#16182a",emissive:$,emissiveIntensity:.15,roughness:.95,metalness:.05},water:{color:"#0d2847",emissive:J,emissiveIntensity:.05,metalness:.95,roughness:.08}},Q={sky:{colors:[{stop:0,color:J},{stop:.35,color:"#1e4d8b"},{stop:.65,color:Z},{stop:1,color:"#ff8c42"}]}},ee={intensity:.9,luminanceThreshold:.25,luminanceSmoothing:.95,radius:.85},te={brightness:.08,contrast:1.15,saturation:1.25},ne={offset:.35,darkness:.45},re={color:Z,near:25,far:90},se={color1:"#5da8ff",color2:"#a855ff",color3:"#52ffb8",baseIntensity:.65,maxIntensity:1.3},oe=e=>{e.frustumCulled=!0,e.traverse(e=>{e instanceof b&&(e.frustumCulled=!0,e.geometry&&(e.geometry.computeBoundingSphere(),e.geometry.computeBoundingBox()))})},ie=e=>{e&&(e.traverse(e=>{e instanceof b&&(e.geometry&&e.geometry.dispose(),e.material&&ae(e.material)),e instanceof j&&e.dispose&&e.dispose()}),e.parent&&e.parent.remove(e))},ae=e=>{(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(t=>{const n=e[t];n&&n instanceof S&&n.dispose()}),e.dispose()})},le=()=>{const e=n.useRef(null),t=n.useRef(null),r=n.useRef(null),i=n.useRef([]),a=n.useRef(null),l=n.useRef(null),{isMobile:c,isTablet:u}=Y(),d=n.useMemo(()=>{const e=c?20:u?35:50,t=[];for(let n=0;n<e;n++){const r=n/e*20-10,s=5+2*Math.random(),o=2*Math.random()-5,i=.3+.7*Math.random(),a=.5+1.5*Math.random(),l=.2*Math.random()-.1,c=.3*Math.random()-.15,u=.2*Math.random()-.1;t.push({position:[r,s,o],rotation:[l,c,u],scale:[i,a,i]})}return t},[c,u]);n.useMemo(()=>{if(!e.current)return;const t=new E;d.forEach((n,r)=>{t.position.set(...n.position),t.rotation.set(...n.rotation),t.scale.set(...n.scale),t.updateMatrix(),e.current.setMatrixAt(r,t.matrix)}),e.current.instanceMatrix.needsUpdate=!0},[d]),o(t=>{const n=t.clock.elapsedTime;if(c||(r.current&&(r.current.uniforms.time.value=n),i.current.forEach(e=>{e&&(e.uniforms.time.value=n)})),e.current&&!c){const t=new E;d.forEach((r,s)=>{const o=.002*Math.sin(.5*n+.1*s),i=.002*Math.cos(.3*n+.15*s);t.position.set(r.position[0]+o,r.position[1],r.position[2]+i),t.rotation.set(...r.rotation),t.scale.set(...r.scale),t.updateMatrix(),e.current.setMatrixAt(s,t.matrix)}),e.current.instanceMatrix.needsUpdate=!0}});const m=c?6:8,h=n.useMemo(()=>(e=>(e.computeBoundingSphere(),e.computeBoundingBox(),e.attributes.normal||e.computeVertexNormals(),e))(new k(.1,1,m)),[m]);return n.useEffect(()=>{const n=e.current,r=t.current,s=h;return n&&oe(n),r&&oe(r),()=>{n&&ie(n),r&&ie(r),s&&s.dispose()}},[h]),s.jsxs("group",{name:"ice-cave-environment",children:[s.jsx("instancedMesh",{ref:e,args:[h,void 0,d.length],castShadow:!c,receiveShadow:!c,children:c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.8}):s.jsx("shaderMaterial",{ref:r,uniforms:D.uniforms,vertexShader:D.vertexShader,fragmentShader:D.fragmentShader,transparent:!0,side:R})}),s.jsxs("group",{ref:t,name:"cave-walls",children:[s.jsxs("mesh",{position:[-8,2,-3],rotation:[0,.3,0],castShadow:!c,receiveShadow:!c,children:[s.jsx("cylinderGeometry",{args:[3,3,8,c?8:16,1,!0,0,.5*Math.PI]}),c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.7,side:R}):s.jsx("shaderMaterial",{ref:e=>{e&&(i.current[0]=e)},uniforms:{...D.uniforms,translucency:{value:.7}},vertexShader:D.vertexShader,fragmentShader:D.fragmentShader,transparent:!0,side:R})]}),s.jsxs("mesh",{position:[8,2,-3],rotation:[0,-.3,0],castShadow:!c,receiveShadow:!c,children:[s.jsx("cylinderGeometry",{args:[3,3,8,c?8:16,1,!0,.5*Math.PI,.5*Math.PI]}),c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.7,side:R}):s.jsx("shaderMaterial",{ref:e=>{e&&(i.current[1]=e)},uniforms:{...D.uniforms,translucency:{value:.7}},vertexShader:D.vertexShader,fragmentShader:D.fragmentShader,transparent:!0,side:R})]}),s.jsxs("mesh",{position:[0,6,-4],rotation:[.1*Math.PI,0,0],receiveShadow:!c,children:[s.jsx("planeGeometry",{args:[20,4,c?16:32,c?8:16]}),c?s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.6,side:R}):s.jsx("shaderMaterial",{ref:e=>{e&&(i.current[2]=e)},uniforms:{...D.uniforms,translucency:{value:.6}},vertexShader:D.vertexShader,fragmentShader:D.fragmentShader,transparent:!0,side:R})]})]}),!c&&s.jsxs(s.Fragment,{children:[s.jsx(ce,{ref:a,count:u?15:25}),s.jsx(ue,{ref:l,count:u?8:12})]})]})},ce=r.forwardRef(({count:e},t)=>{const r=n.useMemo(()=>{const t=[];for(let n=0;n<e;n++){const r=n/e*Math.PI*2,s=3+4*Math.random(),o=Math.cos(r)*s+2*(Math.random()-.5),i=Math.sin(r)*s+2*(Math.random()-.5),a=.05,l=Math.random()*Math.PI*2,c=Math.random()*Math.PI*2,u=Math.random()*Math.PI*2,d=.05+.1*Math.random();t.push({position:[o,a,i],rotation:[l,c,u],scale:d})}return t},[e]);return n.useMemo(()=>{if(!t||"function"==typeof t||!t.current)return;const e=new E;r.forEach((n,r)=>{e.position.set(...n.position),e.rotation.set(...n.rotation),e.scale.setScalar(n.scale),e.updateMatrix(),t.current.setMatrixAt(r,e.matrix)}),t.current.instanceMatrix.needsUpdate=!0},[r,t]),s.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,e],children:[s.jsx("octahedronGeometry",{args:[1,0]}),s.jsx("meshStandardMaterial",{color:X.ice.color,emissive:X.ice.emissive,emissiveIntensity:.5*X.ice.emissiveIntensity,metalness:X.ice.metalness,roughness:X.ice.roughness,transparent:!0,opacity:.7})]})});ce.displayName="IceCrystals";const ue=r.forwardRef(({count:e},t)=>{const r=n.useMemo(()=>{const t=[];for(let n=0;n<e;n++){const e=3*(Math.random()-.5)-5,n=2*(Math.random()-.5)-1,r=.1,s=Math.random()*Math.PI*.3,o=Math.random()*Math.PI*2,i=Math.random()*Math.PI*.3,a=.15+.25*Math.random(),l=a*(.8+.4*Math.random()),c=a*(.6+.4*Math.random()),u=a*(.8+.4*Math.random());t.push({position:[e,r,n],rotation:[s,o,i],scale:[l,c,u]})}return t},[e]);return n.useMemo(()=>{if(!t||"function"==typeof t||!t.current)return;const e=new E;r.forEach((n,r)=>{e.position.set(...n.position),e.rotation.set(...n.rotation),e.scale.set(...n.scale),e.updateMatrix(),t.current.setMatrixAt(r,e.matrix)}),t.current.instanceMatrix.needsUpdate=!0},[r,t]),s.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,e],receiveShadow:!0,castShadow:!0,children:[s.jsx("dodecahedronGeometry",{args:[1,0]}),s.jsx("meshStandardMaterial",{color:"#3a4a5a",roughness:.9,metalness:.1})]})});ue.displayName="Rocks";const de={totalDuration:3.5,camera:{startZ:15,endZ:8,duration:3.5,ease:"power2.inOut",delay:0},rose:{startScale:0,endScale:1,duration:2.2,ease:"back.out(1.4)",delay:1},water:{startStrength:0,endStrength:.5,duration:2.5,ease:"power2.out",delay:1.2},aurora:{startIntensity:0,endIntensity:.65,duration:3.2,ease:"power1.inOut",delay:.8}},me={amplitude:.02,frequency:.5},he={amplitude:.05,frequency:.3},pe={amplitude:.02,frequency:.4},fe={minSpeed:.008,maxSpeed:.018,driftAmplitude:.004,resetHeight:12,minHeight:-1},ge={amplitudeMultiplier:1.8,transitionDuration:.25,ease:"power2.out"},ye={baseIntensity:.15,maxBoost:.6},xe={maxPulse:.08},ve=({audioAmplitude:e=0,animationScale:t=1,reducedMotion:r=!1})=>{const i=n.useRef(null),a=n.useRef(null),{isMobile:l}=Y(),c=r?.3:1,u=l?8:16;return o(n=>{if(!i.current)return;const r=n.clock.elapsedTime,s=1+Math.sin(r*me.frequency*Math.PI*2)*me.amplitude*c,o=e*xe.maxPulse;i.current.scale.y=(s+o)*t,i.current.scale.x=(1+.5*o)*t,i.current.scale.z=(1+.5*o)*t;const a=Math.sin(r*he.frequency*Math.PI*2)*he.amplitude*c;i.current.position.y=.5+a;const l=Math.sin(r*pe.frequency*Math.PI*2)*pe.amplitude*c;i.current.rotation.z=l;const u=ye.baseIntensity+e*ye.maxBoost;i.current.traverse(e=>{if(e instanceof b&&e.material){const t=e.material;void 0!==t.emissiveIntensity&&(t.emissiveIntensity=u)}})}),s.jsxs("group",{ref:i,position:[0,.5,0],children:[s.jsxs("mesh",{ref:a,position:[0,0,0],castShadow:!l,children:[s.jsx("sphereGeometry",{args:[.3,u,u,0,2*Math.PI,0,.6*Math.PI]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[0,.4,0],castShadow:!l,children:[s.jsx("sphereGeometry",{args:[.15,u,u]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[.15,-.3,.1],rotation:[0,0,-.3],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.08,.08,.4,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[-.15,-.3,.1],rotation:[0,0,.3],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.08,.08,.4,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[.25,-.05,.15],rotation:[.5,0,.8],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.06,.06,.35,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[-.25,-.05,.15],rotation:[.5,0,-.8],castShadow:!l,children:[s.jsx("cylinderGeometry",{args:[.06,.06,.35,u/2]}),s.jsx("meshStandardMaterial",{color:X.rose.color,emissive:X.rose.emissive,emissiveIntensity:X.rose.emissiveIntensity,roughness:X.rose.roughness,metalness:X.rose.metalness})]}),s.jsxs("mesh",{position:[0,0,0],children:[s.jsx("sphereGeometry",{args:[.6,u,u]}),s.jsx("meshBasicMaterial",{color:X.rose.emissive,transparent:!0,opacity:.06+.12*e})]})]})},we={uniforms:{time:{value:0},rippleCenter:{value:new C(.5,.5)},rippleStrength:{value:.5},skyColorTop:{value:new g("#0a1e3d")},skyColorHorizon:{value:new g("#7db9ff")},waterColorDeep:{value:new g("#2a6fbb")},waterColorShallow:{value:new g("#4d9fff")}},vertexShader:"\n    uniform float time;\n    uniform vec2 rippleCenter;\n    uniform float rippleStrength;\n    \n    varying vec2 vUv;\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying float vElevation;\n    varying float vDistanceFromCenter;\n    \n    void main() {\n      vUv = uv;\n      vNormal = normal;\n      \n      // Calculate distance from ripple center (Rose's position)\n      vec2 centeredUv = uv - rippleCenter;\n      float dist = length(centeredUv);\n      vDistanceFromCenter = dist;\n      \n      // Create concentric ripples emanating from Rose's position\n      // Multiple frequencies for natural wave interference\n      float ripple1 = sin(dist * 20.0 - time * 2.0) * rippleStrength;\n      float ripple2 = sin(dist * 15.0 - time * 1.5) * rippleStrength * 0.5;\n      float ripple3 = sin(dist * 10.0 - time * 1.0) * rippleStrength * 0.3;\n      \n      // Smooth distance-based fade using exponential decay\n      // Ripples fade naturally as they move away from Rose\n      float fade = exp(-dist * 2.5);\n      float smoothFade = smoothstep(0.0, 0.1, fade) * fade;\n      \n      // Combine ripples with smooth fade\n      float totalRipple = (ripple1 + ripple2 + ripple3) * smoothFade;\n      \n      // Add subtle ambient wave motion for realism\n      float baseWave = sin(uv.x * 5.0 + time * 0.5) * 0.02;\n      baseWave += sin(uv.y * 3.0 + time * 0.3) * 0.02;\n      \n      // Displace vertices to create 3D ripple effect\n      vec3 newPosition = position;\n      newPosition.z += totalRipple * 0.15 + baseWave;\n      \n      vElevation = totalRipple * 0.15 + baseWave;\n      vPosition = newPosition;\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform vec3 skyColorTop;\n    uniform vec3 skyColorHorizon;\n    uniform vec3 waterColorDeep;\n    uniform vec3 waterColorShallow;\n    \n    varying vec2 vUv;\n    varying vec3 vNormal;\n    varying vec3 vPosition;\n    varying float vElevation;\n    varying float vDistanceFromCenter;\n    \n    void main() {\n      // Calculate view direction for Fresnel effect\n      vec3 viewDirection = normalize(cameraPosition - vPosition);\n      \n      // Fresnel effect - more reflection at grazing angles\n      float fresnel = pow(1.0 - dot(viewDirection, vec3(0.0, 0.0, 1.0)), 2.0);\n      \n      // Sky reflection gradient based on UV\n      vec3 skyReflection = mix(skyColorHorizon, skyColorTop, vUv.y);\n      \n      // Water color based on depth (elevation) and distance from center\n      float depthFactor = smoothstep(-0.1, 0.1, vElevation);\n      vec3 waterColor = mix(waterColorDeep, waterColorShallow, depthFactor);\n      \n      // Enhance color near ripple center (Rose's position)\n      float centerGlow = exp(-vDistanceFromCenter * 3.0) * 0.2;\n      waterColor = mix(waterColor, waterColorShallow, centerGlow);\n      \n      // Mix water color and sky reflection based on Fresnel\n      vec3 finalColor = mix(waterColor, skyReflection, fresnel * 0.6);\n      \n      // Add subtle shimmer effect\n      float shimmer = sin(vUv.x * 50.0 + time * 2.0) * sin(vUv.y * 50.0 + time * 1.5);\n      shimmer = shimmer * 0.05 + 0.95;\n      finalColor *= shimmer;\n      \n      // Add foam/highlights at wave peaks\n      float foam = smoothstep(0.08, 0.12, vElevation);\n      finalColor = mix(finalColor, vec3(1.0), foam * 0.3);\n      \n      // Slight transparency for realism\n      float alpha = 0.95 + fresnel * 0.05;\n      \n      gl_FragColor = vec4(finalColor, alpha);\n    }\n  "},be=({rippleStrength:e=.5,rosePosition:t=[0,0],audioAmplitude:r=0})=>{const i=n.useRef(null),{viewport:a}=Y(),l=n.useRef({value:e}),c=V[a]||V.desktop,u=n.useMemo(()=>new N({uniforms:{...we.uniforms,skyColorTop:{value:new g(U)},skyColorHorizon:{value:new g(B)},waterColorDeep:{value:new g(U)},waterColorShallow:{value:new g(z)}},vertexShader:we.vertexShader,fragmentShader:we.fragmentShader,transparent:!0,side:R}),[]);return n.useEffect(()=>{const t=e*(1+r*ge.amplitudeMultiplier);P.to(l.current,{value:t,duration:ge.transitionDuration,ease:ge.ease})},[e,r]),o(e=>{if(i.current&&i.current.material instanceof N){const n=i.current.material;n.uniforms.time.value=e.clock.elapsedTime,n.uniforms.rippleStrength.value=l.current.value;const r=(t[0]+10)/20,s=(t[1]+10)/20;n.uniforms.rippleCenter.value.set(r,s)}}),s.jsxs("mesh",{ref:i,rotation:[-Math.PI/2,0,0],position:[0,0,0],receiveShadow:!0,children:[s.jsx("planeGeometry",{args:[20,20,c.waterSubdivision,c.waterSubdivision]}),s.jsx("primitive",{object:u,attach:"material"})]})},je="#ff8c42",Se="#ffa564",Ee="#ffc188",ke="#e8d4c8",Re={AMBIENT_INTENSITY:.4,AMBIENT_COLOR:"#1e4d8b",IGLOO_LIGHT_INTENSITY:2.5,IGLOO_LIGHT_COLOR:je,IGLOO_LIGHT_DISTANCE:15,IGLOO_LIGHT_DECAY:2,AURORA_LIGHT_INTENSITY:1.2,AURORA_LIGHT_COLOR:"#4d9fff",WATER_LIGHT_INTENSITY:.8,WATER_LIGHT_COLOR:"#4d9fff",KEY_LIGHT_INTENSITY:1.5,KEY_LIGHT_COLOR:"#c8e4ff",FILL_LIGHT_INTENSITY:.6,FILL_LIGHT_COLOR:"#4d9fff"},Ce=-6,Ne=.5,Te=-2,Me=1.2,Ae=.8,Oe=0,Pe=1.5,Le=({audioAmplitude:e=0})=>{const t=n.useRef(null),r=n.useRef(null),{isMobile:i}=Y(),a=Re.IGLOO_LIGHT_INTENSITY;o(t=>{if(r.current){const n=t.clock.elapsedTime,s=1+.05*Math.sin(2*n)+.03*(Math.random()-.5),o=1+.3*e;r.current.intensity=a*s*o}});const l=[Ce,Ne,Te],c=Me,u=i?8:16;return s.jsxs("group",{ref:t,position:l,scale:c,children:[s.jsxs("mesh",{castShadow:!i,receiveShadow:!i,children:[s.jsx("sphereGeometry",{args:[1,u,u,0,2*Math.PI,0,Math.PI/2]}),s.jsx("meshStandardMaterial",{color:ke,emissive:je,emissiveIntensity:Pe,roughness:Ae,metalness:Oe})]}),s.jsxs("mesh",{position:[.7,.2,0],rotation:[0,0,Math.PI/2],castShadow:!i,children:[s.jsx("cylinderGeometry",{args:[.3,.3,.6,u/2]}),s.jsx("meshStandardMaterial",{color:ke,emissive:Ee,emissiveIntensity:.6*Pe,roughness:Ae,metalness:Oe})]}),s.jsx("pointLight",{ref:r,position:[0,.4,0],color:Re.IGLOO_LIGHT_COLOR,intensity:a,distance:Re.IGLOO_LIGHT_DISTANCE,decay:Re.IGLOO_LIGHT_DECAY,castShadow:!1}),s.jsx("pointLight",{position:[.7,.2,0],color:Se,intensity:1,distance:5,decay:2,castShadow:!1})]})},Ie={vertexShader:"\n    varying vec3 vWorldPosition;\n    \n    void main() {\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vWorldPosition = worldPosition.xyz;\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform vec3 topColor;\n    uniform vec3 midColor;\n    uniform vec3 horizonColor;\n    uniform vec3 bottomColor;\n    \n    varying vec3 vWorldPosition;\n    \n    void main() {\n      // Normalize Y position for gradient (-1 to 1)\n      float h = normalize(vWorldPosition).y;\n      \n      vec3 color;\n      \n      // Create smooth gradient with multiple color stops\n      // Using smoothstep for natural color blending (Requirement 9.3)\n      if (h > 0.4) {\n        // Top section: deep blue to sky blue\n        float t = smoothstep(0.4, 1.0, h);\n        color = mix(midColor, topColor, t);\n      } else if (h > 0.0) {\n        // Middle section: sky blue to warm pink\n        float t = smoothstep(0.0, 0.4, h);\n        color = mix(horizonColor, midColor, t);\n      } else {\n        // Bottom section: warm pink to warm orange\n        float t = smoothstep(-0.2, 0.0, h);\n        color = mix(bottomColor, horizonColor, t);\n      }\n      \n      gl_FragColor = vec4(color, 1.0);\n    }\n  "},_e=()=>{const e=n.useMemo(()=>new N({uniforms:{topColor:{value:new g(Q.sky.colors[0].color)},midColor:{value:new g(Q.sky.colors[1].color)},horizonColor:{value:new g(Q.sky.colors[2].color)},bottomColor:{value:new g(Q.sky.colors[3].color)}},vertexShader:Ie.vertexShader,fragmentShader:Ie.fragmentShader,side:T,depthWrite:!1}),[]),t=n.useMemo(()=>new M({color:X.water.color,emissive:X.water.emissive,emissiveIntensity:X.water.emissiveIntensity,metalness:X.water.metalness,roughness:X.water.roughness,envMapIntensity:1.5}),[]),r=n.useMemo(()=>new g(re.color),[]);return s.jsxs("group",{children:[s.jsx("mesh",{material:e,renderOrder:-1,children:s.jsx("sphereGeometry",{args:[500,32,32]})}),s.jsx("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.5,-50],material:t,receiveShadow:!0,children:s.jsx("planeGeometry",{args:[1e3,1e3,1,1]})}),s.jsx("fog",{attach:"fog",args:[r,re.near,re.far]})]})},De={uniforms:{time:{value:0},intensity:{value:.6},color1:{value:new g("#4d9fff")},color2:{value:new g("#9d4dff")},color3:{value:new g("#4dffaa")}},vertexShader:"\n    varying vec2 vUv;\n    varying vec3 vPosition;\n    \n    void main() {\n      vUv = uv;\n      vPosition = position;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform float time;\n    uniform float intensity;\n    uniform vec3 color1; // Blue\n    uniform vec3 color2; // Purple\n    uniform vec3 color3; // Green\n    \n    varying vec2 vUv;\n    varying vec3 vPosition;\n    \n    \n  vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n  vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n  vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }\n  vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n  float snoise(vec3 v) {\n    const vec2 C = vec2(1.0/6.0, 1.0/3.0);\n    const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n    vec3 i  = floor(v + dot(v, C.yyy));\n    vec3 x0 = v - i + dot(i, C.xxx);\n\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min(g.xyz, l.zxy);\n    vec3 i2 = max(g.xyz, l.zxy);\n\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy;\n    vec3 x3 = x0 - D.yyy;\n\n    i = mod289(i);\n    vec4 p = permute(permute(permute(\n              i.z + vec4(0.0, i1.z, i2.z, 1.0))\n            + i.y + vec4(0.0, i1.y, i2.y, 1.0))\n            + i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\n    float n_ = 0.142857142857;\n    vec3 ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);\n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_);\n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n\n    vec4 b0 = vec4(x.xy, y.xy);\n    vec4 b1 = vec4(x.zw, y.zw);\n\n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n\n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;\n\n    vec3 p0 = vec3(a0.xy, h.x);\n    vec3 p1 = vec3(a0.zw, h.y);\n    vec3 p2 = vec3(a1.xy, h.z);\n    vec3 p3 = vec3(a1.zw, h.w);\n\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));\n  }\n\n    \n    void main() {\n      // Create flowing noise patterns with multiple octaves\n      vec3 noiseCoord1 = vec3(vUv * 2.0, time * 0.1);\n      vec3 noiseCoord2 = vec3(vUv * 3.0, time * 0.15);\n      vec3 noiseCoord3 = vec3(vUv * 1.5, time * 0.08);\n      \n      float noise1 = snoise(noiseCoord1);\n      float noise2 = snoise(noiseCoord2);\n      float noise3 = snoise(noiseCoord3);\n      \n      // Combine noise layers for complex aurora pattern\n      float combinedNoise = noise1 * 0.5 + noise2 * 0.3 + noise3 * 0.2;\n      \n      // Create wave-like flowing motion\n      float wave = sin(vUv.x * 3.0 + time * 0.2) * 0.3;\n      wave += sin(vUv.y * 2.0 - time * 0.15) * 0.2;\n      \n      // Combine noise and waves\n      float aurora = combinedNoise + wave;\n      \n      // Apply smoothstep for ethereal edges\n      aurora = smoothstep(0.2, 0.8, aurora);\n      \n      // Create vertical gradient (stronger at top)\n      float verticalGradient = smoothstep(0.0, 0.5, vUv.y);\n      aurora *= verticalGradient;\n      \n      // Mix colors based on noise patterns\n      vec3 auroraColor = mix(color1, color2, noise1 * 0.5 + 0.5);\n      auroraColor = mix(auroraColor, color3, noise2 * 0.3 + 0.3);\n      \n      // Add subtle shimmer\n      float shimmer = sin(vUv.x * 20.0 + time * 2.0) * sin(vUv.y * 15.0 + time * 1.5);\n      shimmer = shimmer * 0.1 + 0.9;\n      auroraColor *= shimmer;\n      \n      // Apply intensity and create transparency\n      float alpha = aurora * intensity * 0.7;\n      \n      // Fade edges for seamless blending\n      float edgeFade = smoothstep(0.0, 0.1, vUv.x) * smoothstep(1.0, 0.9, vUv.x);\n      alpha *= edgeFade;\n      \n      gl_FragColor = vec4(auroraColor, alpha);\n    }\n  "},Ue=({audioAmplitude:e=0,baseIntensity:t=se.baseIntensity,reducedMotion:r=!1})=>{const i=n.useRef(null),{isMobile:a}=Y(),l=r?.3:1,c=n.useMemo(()=>{const e=new N({uniforms:O.clone(De.uniforms),vertexShader:De.vertexShader,fragmentShader:De.fragmentShader,transparent:!0,side:R,depthWrite:!1,blending:A});return e.uniforms.color1.value=new g(se.color1),e.uniforms.color2.value=new g(se.color2),e.uniforms.color3.value=new g(se.color3),e},[]);n.useEffect(()=>{if(!c)return;const n=t+e*(se.maxIntensity-se.baseIntensity);P.to(c.uniforms.intensity,{value:n,duration:.3,ease:"power2.out"})},[e,t,c]),o(e=>{c&&(c.uniforms.time.value=e.clock.elapsedTime*l)}),n.useEffect(()=>()=>{c.dispose()},[c]);const u=a?32:64,d=a?16:32;return s.jsxs("mesh",{ref:i,position:[0,8,-15],rotation:[-Math.PI/6,0,0],children:[s.jsx("planeGeometry",{args:[30,12,u,d]}),s.jsx("primitive",{object:c,attach:"material"})]})},Fe=({voiceState:e="idle",audioAmplitude:t=0})=>{const r=n.useRef(null),i=n.useRef(null),a=n.useRef(null),{quality:l}=Y(),c=l.shadows,u={ambient:Re.AMBIENT_INTENSITY,key:Re.KEY_LIGHT_INTENSITY,rim:Re.AURORA_LIGHT_INTENSITY,fill:Re.FILL_LIGHT_INTENSITY};return o(()=>{if(!r.current||!i.current||!a.current)return;let n=1,s=0;switch(e){case"listening":n=1.1,i.current.intensity=1.2*u.rim;break;case"speaking":n=1.15,s=.2;const e=1+.15*t;r.current.intensity=u.key*n*e,a.current.intensity=u.fill*(1+s)*e;break;case"processing":n=1.05;break;default:return r.current.intensity=u.key,i.current.intensity=u.rim,void(a.current.intensity=u.fill)}"speaking"!==e&&(r.current.intensity=u.key*n,a.current.intensity=u.fill*(1+s))}),s.jsxs(s.Fragment,{children:[s.jsx("ambientLight",{color:Re.AMBIENT_COLOR,intensity:u.ambient}),s.jsx("directionalLight",{ref:r,position:[5,10,5],color:Re.KEY_LIGHT_COLOR,intensity:u.key,castShadow:c,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10,"shadow-bias":-1e-4,"shadow-normalBias":.02,"shadow-radius":4}),s.jsx("directionalLight",{ref:i,position:[0,15,-10],color:Re.AURORA_LIGHT_COLOR,intensity:u.rim}),s.jsx("pointLight",{ref:a,position:[-8,5,3],color:Re.FILL_LIGHT_COLOR,intensity:u.fill,distance:30,decay:2})]})},ze=({reducedMotion:e=!1})=>{const t=n.useRef(null),{quality:r}=Y(),i=r.particleCount,a=e?Math.floor(.5*i):i,l=n.useMemo(()=>{const e=[],{minSpeed:t,maxSpeed:n,driftAmplitude:r,resetHeight:s}=fe;for(let o=0;o<a;o++)e.push({position:new y(20*(Math.random()-.5),Math.random()*s,20*(Math.random()-.5)),velocity:new y(0,0,0),speed:t+Math.random()*(n-t),size:.02+.05*Math.random(),drift:(Math.random()-.5)*r});return e},[a]),c=n.useMemo(()=>new E,[]);return n.useEffect(()=>()=>{t.current&&ie(t.current)},[]),o(e=>{if(!t.current)return;const n=e.camera,{resetHeight:r,minHeight:s}=fe;l.forEach((e,o)=>{e.position.y-=e.speed,e.position.x+=e.drift,e.position.y<s&&(e.position.y=r,e.position.x=20*(Math.random()-.5),e.position.z=20*(Math.random()-.5));const i=n.position.distanceTo(e.position),a=Math.max(0,1-i/15);c.position.copy(e.position),c.scale.setScalar(e.size*a),c.updateMatrix(),t.current.setMatrixAt(o,c.matrix)}),t.current.instanceMatrix.needsUpdate=!0}),s.jsxs("instancedMesh",{ref:t,args:[void 0,void 0,a],children:[s.jsx("sphereGeometry",{args:[1,8,8]}),s.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.6,blending:A,depthWrite:!1})]})},Be=({enabled:e=!0})=>{const{enablePostProcessing:t}=Y();return t&&e?s.jsxs(i,{children:[s.jsx(a,{intensity:ee.intensity,luminanceThreshold:ee.luminanceThreshold,luminanceSmoothing:ee.luminanceSmoothing,mipmapBlur:!0,radius:ee.radius}),s.jsx(l,{brightness:te.brightness,contrast:te.contrast-1}),s.jsx(c,{saturation:te.saturation-1,hue:0,blendFunction:u.NORMAL}),s.jsx(d,{offset:ne.offset,darkness:ne.darkness,eskil:!1,blendFunction:u.NORMAL})]}):null},qe=(e={})=>{const{enabled:t=!0,duration:r=de.totalDuration,onComplete:s}=e,o=n.useRef(null),i=n.useRef(!1),[a,l]=n.useState(de.camera.startZ),[c,u]=n.useState(de.rose.startScale),[d,m]=n.useState(de.water.startStrength),[h,p]=n.useState(de.aurora.startIntensity);n.useEffect(()=>{if(!t||i.current)return;const e=P.timeline({defaults:{ease:de.camera.ease},onComplete:()=>{s&&s()}});return e.to({z:de.camera.startZ},{z:de.camera.endZ,duration:de.camera.duration,ease:de.camera.ease,onUpdate:function(){l(this.targets()[0].z)}},de.camera.delay),e.to({scale:de.rose.startScale},{scale:de.rose.endScale,duration:de.rose.duration,ease:de.rose.ease,onUpdate:function(){u(this.targets()[0].scale)}},de.rose.delay),e.to({strength:de.water.startStrength},{strength:de.water.endStrength,duration:de.water.duration,ease:de.water.ease,onUpdate:function(){m(this.targets()[0].strength)}},de.water.delay),e.to({intensity:de.aurora.startIntensity},{intensity:de.aurora.endIntensity,duration:de.aurora.duration,ease:de.aurora.ease,onUpdate:function(){p(this.targets()[0].intensity)}},de.aurora.delay),o.current=e,i.current=!0,()=>{o.current&&(o.current.kill(),o.current=null)}},[t,r,s]);return{cameraZ:a,roseScale:c,waterRippleStrength:d,auroraIntensity:h,timeline:o.current,play:()=>{o.current&&o.current.play()},pause:()=>{o.current&&o.current.pause()},restart:()=>{o.current&&(i.current=!1,o.current.restart())},reverse:()=>{o.current&&o.current.reverse()},skip:()=>{o.current&&o.current.progress(1)},isAnimating:o.current?.isActive()??!1,hasPlayed:i.current}},He=({audioAmplitude:e,voiceState:t,enableEntryAnimation:r,reducedMotion:i,cameraConfig:a,isMobile:l})=>{const{qualityLevel:c,isPerformanceGood:u}=((e={})=>{const{targetFPS:t=60,enableAdaptiveQuality:r=!0,logInterval:s=5e3,onPerformanceChange:i}=e,{gl:a}=m(),[l,c]=n.useState({fps:60,frameTime:16.67,drawCalls:0,triangles:0,geometries:0,textures:0,programs:0}),[u,d]=n.useState("high"),[h,p]=n.useState(!0),f=n.useRef([]),g=n.useRef(0),y=n.useRef(0),x=n.useCallback(e=>{if(0===e.length)return 60;const t=e.reduce((e,t)=>e+t,0)/e.length;return Math.round(1e3/t)},[]),v=n.useCallback(()=>{const e=a.info;return{drawCalls:e.render.calls,triangles:e.render.triangles,geometries:e.memory.geometries,textures:e.memory.textures,programs:e.programs?.length||0,memory:{geometries:e.memory.geometries,textures:e.memory.textures}}},[a]),w=n.useCallback(e=>e>=.8*t?"high":e>=.5*t?"medium":"low",[t]);return o((e,n)=>{const o=performance.now(),a=1e3*n;if(f.current.push(a),f.current.length>60&&f.current.shift(),s>0&&o-g.current>=s){const e=x(f.current),n=f.current.reduce((e,t)=>e+t,0)/f.current.length,s=v(),a={fps:e,frameTime:n,drawCalls:s.drawCalls||0,triangles:s.triangles||0,geometries:s.geometries||0,textures:s.textures||0,programs:s.programs||0,memory:s.memory};if(c(a),p(e>=.8*t),r){const t=w(e);t!==u&&d(t)}i?.(a),g.current=o}y.current=o}),n.useEffect(()=>()=>{a.info.reset()},[a]),{metrics:l,qualityLevel:u,isPerformanceGood:h,targetFPS:t}})({targetFPS:l?30:60,enableAdaptiveQuality:!0,logInterval:5e3,onPerformanceChange:e=>{}}),{cameraZ:d,roseScale:h,waterRippleStrength:f,auroraIntensity:g,isAnimating:y}=qe({enabled:r,duration:3,onComplete:()=>{}}),x=y?d:a.position[2];return s.jsxs(s.Fragment,{children:[s.jsx(p,{makeDefault:!0,position:[a.position[0],a.position[1],x],fov:a.fov,near:.1,far:1e3}),s.jsxs(n.Suspense,{fallback:null,children:[s.jsx(Fe,{voiceState:t,audioAmplitude:e}),s.jsx(le,{}),s.jsx(ve,{audioAmplitude:e,animationScale:h,reducedMotion:i}),s.jsx(be,{audioAmplitude:e,rosePosition:[0,0],rippleStrength:f}),s.jsx(Le,{audioAmplitude:e}),s.jsx(_e,{}),s.jsx(Ue,{audioAmplitude:e,baseIntensity:g,reducedMotion:i}),s.jsx(ze,{reducedMotion:i}),s.jsx(Be,{enabled:!i&&"low"!==c})]})]})},Ge=({audioAmplitude:e=0,voiceState:t="idle",enableEntryAnimation:n=!0,reducedMotion:r=!1})=>{const{cameraConfig:o,isMobile:i}=Y();return s.jsx(h,{gl:{antialias:!0,alpha:!1,powerPreference:"high-performance"},dpr:i?[1,1.5]:[1,2],shadows:!0,style:{touchAction:"none"},frameloop:"always",children:s.jsx(He,{audioAmplitude:e,voiceState:t,enableEntryAnimation:n,reducedMotion:r,cameraConfig:o,isMobile:i})})},We=()=>s.jsx(L.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1.5,ease:"easeOut",delay:.5},className:"absolute top-8 sm:top-12 left-1/2 -translate-x-1/2 z-10 pointer-events-none px-4",children:s.jsxs("h1",{className:"text-white text-center select-none",children:[s.jsx("div",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-light tracking-[0.25em] sm:tracking-[0.3em] mb-1 sm:mb-2 drop-shadow-lg",children:"ROSE"}),s.jsx("div",{className:"text-base sm:text-lg md:text-xl lg:text-2xl xl:text-3xl font-light tracking-[0.15em] sm:tracking-[0.2em] opacity-90 drop-shadow-md",children:"THE HEALER SHAMAN"})]})}),Ve=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ke=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),Ye=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var Je={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=n.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:o="",children:i,iconNode:a,...l},c)=>n.createElement("svg",{ref:c,...Je,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:Ke("lucide",o),...!i&&!Ye(l)&&{"aria-hidden":"true"},...l},[...a.map(([e,t])=>n.createElement(e,t)),...Array.isArray(i)?i:[i]])),Ze=(e,t)=>{const r=n.forwardRef(({className:r,...s},o)=>{return n.createElement($e,{ref:o,iconNode:t,className:Ke(`lucide-${i=Ve(e),i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...s});var i});return r.displayName=Ve(e),r},Xe=Ze("accessibility",[["circle",{cx:"16",cy:"4",r:"1",key:"1grugj"}],["path",{d:"m18 19 1-7-6 1",key:"r0i19z"}],["path",{d:"m5 8 3-3 5.5 3-2.36 3.5",key:"9ptxx2"}],["path",{d:"M4.24 14.5a5 5 0 0 0 6.88 6",key:"10kmtu"}],["path",{d:"M13.76 17.5a5 5 0 0 0-6.88-6",key:"2qq6rc"}]]),Qe=Ze("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]),et=Ze("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),tt=Ze("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]),nt=Ze("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),rt=Ze("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),st=Ze("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ot=Ze("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),it=Ze("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),at=Ze("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),lt=Ze("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),ct=Ze("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ut=(e=10)=>{"vibrate"in navigator&&navigator.vibrate(e)},dt={idle:{scale:1,boxShadow:"0 0 20px rgba(77, 159, 255, 0.4)",transition:{duration:.3,ease:"easeOut"}},listening:{scale:1.1,boxShadow:"0 0 40px rgba(77, 159, 255, 0.8)",transition:{duration:.3,ease:"easeOut"}},processing:{scale:1.05,boxShadow:"0 0 30px rgba(157, 77, 255, 0.6)",transition:{duration:.3,ease:"easeInOut"}},speaking:{scale:[1,1.05,1],boxShadow:"0 0 30px rgba(255, 140, 66, 0.6)",transition:{repeat:1/0,duration:1,ease:"easeInOut"}}},mt={scale:1.05,transition:{duration:.2,ease:"easeOut"}},ht={scale:.95,transition:{duration:.1,ease:"easeIn"}},pt=({voiceState:e,onStartRecording:t,onStopRecording:n,disabled:r=!1,audioAmplitude:o=0})=>{const i=()=>{"listening"===e&&n()},a="speaking"===e?1+.1*o:1;return s.jsxs("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 z-10",children:["listening"===e&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{className:"absolute inset-0 rounded-full border-2 border-blue-400/50",initial:{scale:1,opacity:.8},animate:{scale:2,opacity:0},transition:{duration:1.5,repeat:1/0,ease:"easeOut"},style:{width:"80px",height:"80px",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),s.jsx(L.div,{className:"absolute inset-0 rounded-full border-2 border-blue-400/30",initial:{scale:1,opacity:.6},animate:{scale:2.5,opacity:0},transition:{duration:2,repeat:1/0,ease:"easeOut",delay:.5},style:{width:"80px",height:"80px",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})]}),"idle"===e&&s.jsx(L.div,{className:"absolute inset-0 rounded-full bg-blue-400/20 blur-xl",animate:{opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{width:"100px",height:"100px",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),s.jsxs(L.button,{className:"relative focus:outline-none focus-visible:ring-4 focus-visible:ring-blue-400/70 rounded-full touch-none select-none",variants:dt,animate:e,style:{scale:a,WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none"},whileHover:"idle"===e?mt:void 0,whileTap:"idle"===e?ht:void 0,onMouseDown:()=>{r||"idle"!==e||t()},onMouseUp:i,onMouseLeave:i,onTouchStart:n=>{n.preventDefault(),r||"idle"!==e||(ut(10),t())},onTouchEnd:t=>{t.preventDefault(),"listening"===e&&(ut(10),n())},onTouchCancel:t=>{t.preventDefault(),"listening"===e&&n()},onKeyDown:s=>{" "===s.key||"Enter"===s.key?(s.preventDefault(),r||"idle"!==e||t()):"Escape"===s.key&&(s.preventDefault(),"listening"===e&&n())},onKeyUp:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),"listening"===e&&n())},disabled:r||"processing"===e||"speaking"===e,"aria-label":(()=>{switch(e){case"listening":return"Recording your voice. Release to send.";case"processing":return"Processing your message...";case"speaking":return"Rose is responding...";default:return"Press and hold to speak with Rose"}})(),"aria-pressed":"listening"===e,role:"button",tabIndex:0,children:[s.jsx(L.div,{className:"w-20 h-20 rounded-full bg-white/10 backdrop-blur-md\r\n                     border-2 border-white/30 flex items-center justify-center",animate:{borderColor:"listening"===e?"rgba(77, 159, 255, 0.6)":"speaking"===e?"rgba(255, 140, 66, 0.6)":"rgba(255, 255, 255, 0.3)",backgroundColor:"listening"===e?"rgba(77, 159, 255, 0.15)":"speaking"===e?"rgba(255, 140, 66, 0.15)":"rgba(255, 255, 255, 0.1)"},transition:{duration:.3,ease:"easeInOut"},children:(()=>{switch(e){case"listening":case"speaking":return s.jsx(nt,{className:"w-8 h-8 text-white"});case"processing":return s.jsx(et,{className:"w-8 h-8 text-white animate-spin"});default:return s.jsx(tt,{className:"w-8 h-8 text-white/80"})}})()}),s.jsxs("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:["processing"===e&&"Processing your message...","speaking"===e&&"Rose is responding..."]})]})]})},ft=({isLoading:e,progress:t=0,currentAsset:n,phase:r})=>{const o=((e,t)=>{if(!e)return"critical"===t?"ðŸŽ¨":"secondary"===t?"ðŸŽ­":"effects"===t?"âœ¨":"ðŸ“¦";const n=e.split(".").pop()?.toLowerCase();return"css"===n?"ðŸŽ¨":"glb"===n||"gltf"===n||"jpg"===n||"png"===n||"webp"===n?"ðŸŽ­":"mp3"===n||"wav"===n||"ogg"===n?"ðŸŽµ":"ðŸ“¦"})(n,r),i=(e=>"critical"===e?"Loading essential elements":"secondary"===e?"Loading environmental details":"effects"===e?"Preparing visual effects":"complete"===e?"Ready":"Entering the sanctuary")(r),a=(l=n)?(l.split("/").pop()||"").split(".")[0].replace(/[-_]/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"";var l;return s.jsx(I,{children:e&&s.jsx(L.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:1,ease:"easeInOut"},className:"fixed inset-0 z-50 flex items-center justify-center",style:{background:`linear-gradient(to bottom, ${U} 0%, ${F} 100%)`},children:s.jsxs("div",{className:"text-center px-4 max-w-md",children:[s.jsx(L.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},className:"flex justify-center mb-6",children:s.jsx(et,{className:"w-12 h-12 text-white/60 animate-spin"})}),s.jsx(L.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.8},className:"text-white/60 text-sm tracking-wide mb-2",children:i}),a&&s.jsxs(L.p,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.3},className:"text-white/40 text-xs tracking-wide mb-6 flex items-center justify-center gap-2",children:[s.jsx("span",{className:"text-base",children:o}),s.jsx("span",{children:a})]},n),s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.8},className:"w-64 h-1 bg-white/10 rounded-full overflow-hidden mx-auto",children:s.jsx(L.div,{className:"h-full bg-white/40 rounded-full",initial:{width:"0%"},animate:{width:`${t}%`},transition:{duration:.3,ease:"easeOut"}})}),t>0&&s.jsxs(L.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7,duration:.5},className:"text-white/40 text-xs mt-3 tracking-wider",children:[Math.round(t),"%"]})]})})})},gt=({ambientVolume:e,onAmbientVolumeChange:t,reducedMotion:r,onReducedMotionChange:o})=>{const[i,a]=n.useState(!1),[l,c]=n.useState(!1),u=0===e;return s.jsxs("div",{className:"absolute top-6 right-6 z-10",onKeyDown:e=>{"Escape"===e.key&&i&&(e.preventDefault(),a(!1))},children:[s.jsx(L.button,{className:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-md\r\n                   border border-white/20 flex items-center justify-center\r\n                   focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\r\n                   transition-all duration-300",animate:{opacity:i||l?1:.3},whileHover:{scale:1.05,opacity:1},whileTap:{scale:.95},onClick:()=>a(!i),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),"aria-label":i?"Close settings":"Open settings","aria-expanded":i,"aria-controls":"settings-panel",children:i?s.jsx(ct,{className:"w-5 h-5 text-white/80"}):s.jsx(ot,{className:"w-5 h-5 text-white/80"})}),s.jsx(I,{children:i&&s.jsxs(L.div,{id:"settings-panel",initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2,ease:"easeOut"},className:"absolute top-14 right-0 w-72 bg-white/10 backdrop-blur-md\r\n                       border border-white/20 rounded-lg p-4 shadow-xl",role:"region","aria-label":"Settings panel",children:[s.jsx("h3",{className:"text-white text-sm font-light tracking-wide mb-4",children:"Settings"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("label",{htmlFor:"ambient-volume",className:"text-white/80 text-xs tracking-wide",children:"Ambient Audio"}),s.jsx("button",{onClick:()=>{t(u?.5:0)},className:"p-1 rounded hover:bg-white/10 transition-colors\r\n                           focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50","aria-label":u?"Unmute ambient audio":"Mute ambient audio",tabIndex:0,children:u?s.jsx(lt,{className:"w-4 h-4 text-white/60"}):s.jsx(at,{className:"w-4 h-4 text-white/80"})})]}),s.jsx("input",{id:"ambient-volume",type:"range",min:"0",max:"1",step:"0.01",value:e,onChange:e=>t(parseFloat(e.target.value)),className:"w-full h-1 bg-white/20 rounded-lg appearance-none cursor-pointer\r\n                         [&::-webkit-slider-thumb]:appearance-none\r\n                         [&::-webkit-slider-thumb]:w-3\r\n                         [&::-webkit-slider-thumb]:h-3\r\n                         [&::-webkit-slider-thumb]:rounded-full\r\n                         [&::-webkit-slider-thumb]:bg-white\r\n                         [&::-webkit-slider-thumb]:cursor-pointer\r\n                         [&::-moz-range-thumb]:w-3\r\n                         [&::-moz-range-thumb]:h-3\r\n                         [&::-moz-range-thumb]:rounded-full\r\n                         [&::-moz-range-thumb]:bg-white\r\n                         [&::-moz-range-thumb]:border-0\r\n                         [&::-moz-range-thumb]:cursor-pointer","aria-label":"Ambient audio volume"}),s.jsxs("div",{className:"flex justify-between text-white/40 text-xs mt-1",children:[s.jsx("span",{children:"0%"}),s.jsxs("span",{children:[Math.round(100*e),"%"]}),s.jsx("span",{children:"100%"})]})]}),s.jsxs("div",{className:"border-t border-white/10 pt-4",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(Xe,{className:"w-4 h-4 text-white/60 mr-2"}),s.jsx("h4",{className:"text-white/80 text-xs tracking-wide",children:"Accessibility"})]}),s.jsxs("label",{className:"flex items-center justify-between cursor-pointer group",children:[s.jsx("span",{className:"text-white/70 text-xs",children:"Reduce Motion"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"checkbox",checked:r,onChange:e=>o(e.target.checked),className:"sr-only peer","aria-label":"Enable reduced motion"}),s.jsx("div",{className:"w-10 h-5 bg-white/20 rounded-full peer\r\n                               peer-checked:bg-blue-400/50\r\n                               peer-focus:ring-2 peer-focus:ring-white/40\r\n                               transition-colors duration-200"}),s.jsx("div",{className:"absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full\r\n                               peer-checked:translate-x-5\r\n                               transition-transform duration-200"})]})]}),s.jsx("p",{className:"text-white/40 text-xs mt-1 ml-0",children:"Simplifies animations for better accessibility"})]}),s.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:s.jsxs("p",{className:"text-white/40 text-xs leading-relaxed",children:["Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"Space"})," or"," ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"Enter"})," to activate voice interaction."," ","Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"?"})," for more keyboard shortcuts."]})})]})})]})},yt=()=>{const[e,t]=n.useState(!1);return n.useEffect(()=>{const n=n=>{"?"!==n.key||e?"Escape"===n.key&&e&&(n.preventDefault(),t(!1)):(n.preventDefault(),t(!0))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[e]),s.jsxs(s.Fragment,{children:[s.jsx(L.button,{className:"absolute bottom-6 right-6 z-10 w-10 h-10 rounded-full \r\n                   bg-white/10 backdrop-blur-md border border-white/20 \r\n                   flex items-center justify-center\r\n                   focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\r\n                   transition-all duration-300",whileHover:{scale:1.05,opacity:1},whileTap:{scale:.95},onClick:()=>t(!e),"aria-label":"Show keyboard shortcuts",title:"Keyboard shortcuts (?)",children:s.jsx(Qe,{className:"w-5 h-5 text-white/80"})}),s.jsx(I,{children:e&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:()=>t(!1)}),s.jsxs(L.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50\r\n                         w-full max-w-md bg-white/10 backdrop-blur-md\r\n                         border border-white/20 rounded-lg p-6 shadow-2xl",role:"dialog","aria-labelledby":"keyboard-help-title","aria-modal":"true",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{id:"keyboard-help-title",className:"text-white text-lg font-light tracking-wide flex items-center gap-2",children:[s.jsx(Qe,{className:"w-5 h-5"}),"Keyboard Shortcuts"]}),s.jsx("button",{onClick:()=>t(!1),className:"p-1 rounded hover:bg-white/10 transition-colors\r\n                           focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50","aria-label":"Close keyboard shortcuts",children:s.jsx(ct,{className:"w-5 h-5 text-white/80"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-white/90 text-sm font-medium mb-2",children:"Voice Interaction"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Start recording"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Space"}),s.jsx("span",{className:"text-white/50",children:"or"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Enter"})]})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Stop recording"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Release key"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Cancel recording"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Escape"})]})]})]}),s.jsxs("div",{className:"border-t border-white/10 pt-4",children:[s.jsx("h3",{className:"text-white/90 text-sm font-medium mb-2",children:"Navigation"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Move between elements"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Tab"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Move backwards"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Shift + Tab"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Activate button"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Enter"})]})]})]}),s.jsxs("div",{className:"border-t border-white/10 pt-4",children:[s.jsx("h3",{className:"text-white/90 text-sm font-medium mb-2",children:"Help"}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Show this help"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"?"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-white/70",children:"Close dialogs"}),s.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-white/80 text-xs",children:"Escape"})]})]})]})]}),s.jsx("div",{className:"mt-6 pt-4 border-t border-white/10",children:s.jsxs("p",{className:"text-white/50 text-xs leading-relaxed",children:["All interactive elements can be accessed using keyboard navigation. Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-white/10 rounded text-white/60",children:"Tab"})," to move between elements."]})})]})]})})]})},xt=({capabilities:e,onRetry:t})=>{const n=(e=>e.supported?e.maxTextureSize&&e.maxTextureSize<2048?"Your graphics hardware does not meet the minimum requirements for this experience":"An unknown error occurred while initializing 3D graphics":e.error||"WebGL is not supported in your browser")(e),r=(()=>{const e=navigator.userAgent.toLowerCase(),t=[],n=e.includes("chrome")&&!e.includes("edge"),r=e.includes("firefox"),s=e.includes("safari")&&!e.includes("chrome"),o=e.includes("edge")||e.includes("edg/");return e.includes("trident")||e.includes("msie")?(t.push("Internet Explorer is not supported. Please use a modern browser."),t.push("Recommended browsers: Chrome, Firefox, Safari, or Edge")):s?(t.push("Make sure you are using Safari 15 or later"),t.push("Check that hardware acceleration is enabled in Safari preferences")):r?(t.push("Make sure you are using Firefox 90 or later"),t.push("Check that WebGL is enabled in about:config (webgl.disabled should be false)")):n||o?(t.push("Make sure you are using the latest version of your browser"),t.push("Check that hardware acceleration is enabled in browser settings"),t.push("Try visiting chrome://gpu to see if WebGL is blocked")):(t.push("Please use a modern browser such as Chrome, Firefox, Safari, or Edge"),t.push("Make sure your browser is up to date")),t.push("Update your graphics drivers to the latest version"),t.push("Try disabling browser extensions that might block WebGL"),t})();return s.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#0a1e3d] to-[#1e4d8b] flex items-center justify-center z-50 p-4",children:s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"max-w-2xl w-full",children:[s.jsxs("div",{className:"bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-8 shadow-2xl",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("div",{className:"w-20 h-20 rounded-full bg-orange-500/20 flex items-center justify-center",children:s.jsx(it,{className:"w-10 h-10 text-orange-400"})})}),s.jsx("h1",{className:"text-3xl font-light text-white text-center mb-4 tracking-wide",children:"3D Experience Unavailable"}),s.jsx("p",{className:"text-white/80 text-center mb-8 text-lg",children:n}),null!==e.version&&s.jsxs("details",{className:"mb-6 bg-white/5 rounded-lg p-4",children:[s.jsx("summary",{className:"text-white/60 text-sm cursor-pointer hover:text-white/80 transition-colors",children:"Technical Details"}),s.jsxs("div",{className:"mt-4 space-y-2 text-sm text-white/60 font-mono",children:[s.jsxs("div",{children:["WebGL Version: ",e.version||"Not supported"]}),e.renderer&&s.jsxs("div",{children:["Renderer: ",e.renderer]}),e.vendor&&s.jsxs("div",{children:["Vendor: ",e.vendor]}),e.maxTextureSize&&s.jsxs("div",{children:["Max Texture Size: ",e.maxTextureSize,"px"]})]})]}),s.jsxs("div",{className:"bg-white/5 rounded-lg p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(rt,{className:"w-5 h-5 text-blue-400"}),s.jsx("h2",{className:"text-white font-medium",children:"What can I do?"})]}),s.jsx("ul",{className:"space-y-3 text-white/70 text-sm",children:r.map((e,t)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-400 mt-1",children:"â€¢"}),s.jsx("span",{children:e})]},t))})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[t&&s.jsxs(L.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:t,className:"flex items-center justify-center gap-2 px-6 py-3 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/30 rounded-lg text-white transition-colors",children:[s.jsx(st,{className:"w-4 h-4"}),s.jsx("span",{children:"Try Again"})]}),s.jsxs(L.a,{whileHover:{scale:1.05},whileTap:{scale:.95},href:"https://get.webgl.org/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white transition-colors",children:[s.jsx(rt,{className:"w-4 h-4"}),s.jsx("span",{children:"Learn More About WebGL"})]})]}),s.jsx("div",{className:"mt-8 pt-6 border-t border-white/10",children:s.jsxs("p",{className:"text-white/50 text-sm text-center",children:["You can still access Rose through our"," ",s.jsx("a",{href:"/text",className:"text-blue-400 hover:text-blue-300 underline transition-colors",children:"text-only interface"})]})})]}),s.jsx("div",{className:"mt-6 text-center",children:s.jsx("p",{className:"text-white/40 text-xs",children:"Rose the Healer Shaman requires WebGL for the immersive 3D experience"})})]})})},vt=({children:e,enabled:t=!1})=>(((e={})=>{const{duration:t=1.2,easing:r=e=>Math.min(1,1.001-Math.pow(2,-10*e)),enabled:s=!0}=e,o=n.useRef(null),i=n.useRef(null);n.useEffect(()=>{if(!s)return;const e=new _({duration:t,easing:r});o.current=e;const n=t=>{e.raf(t),i.current=requestAnimationFrame(n)};return i.current=requestAnimationFrame(n),()=>{null!==i.current&&cancelAnimationFrame(i.current),o.current&&(o.current.destroy(),o.current=null)}},[t,r,s]),o.current})({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),enabled:t}),s.jsx(s.Fragment,{children:e}));
/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function wt(e,t){return function(){return e.apply(t,arguments)}}const{toString:bt}=Object.prototype,{getPrototypeOf:jt}=Object,{iterator:St,toStringTag:Et}=Symbol,kt=(e=>t=>{const n=bt.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Rt=e=>(e=e.toLowerCase(),t=>kt(t)===e),Ct=e=>t=>typeof t===e,{isArray:Nt}=Array,Tt=Ct("undefined");function Mt(e){return null!==e&&!Tt(e)&&null!==e.constructor&&!Tt(e.constructor)&&Pt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const At=Rt("ArrayBuffer");const Ot=Ct("string"),Pt=Ct("function"),Lt=Ct("number"),It=e=>null!==e&&"object"==typeof e,_t=e=>{if("object"!==kt(e))return!1;const t=jt(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Et in e||St in e)},Dt=Rt("Date"),Ut=Rt("File"),Ft=Rt("Blob"),zt=Rt("FileList"),Bt=Rt("URLSearchParams"),[qt,Ht,Gt,Wt]=["ReadableStream","Request","Response","Headers"].map(Rt);function Vt(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,s;if("object"!=typeof e&&(e=[e]),Nt(e))for(r=0,s=e.length;r<s;r++)t.call(null,e[r],r,e);else{if(Mt(e))return;const s=n?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let i;for(r=0;r<o;r++)i=s[r],t.call(null,e[i],i,e)}}function Kt(e,t){if(Mt(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r,s=n.length;for(;s-- >0;)if(r=n[s],t===r.toLowerCase())return r;return null}const Yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Jt=e=>!Tt(e)&&e!==Yt;const $t=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&jt(Uint8Array)),Zt=Rt("HTMLFormElement"),Xt=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Qt=Rt("RegExp"),en=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Vt(n,(n,s)=>{let o;!1!==(o=t(n,s,e))&&(r[s]=o||n)}),Object.defineProperties(e,r)};const tn=Rt("AsyncFunction"),nn=(rn="function"==typeof setImmediate,sn=Pt(Yt.postMessage),rn?setImmediate:sn?(on=`axios@${Math.random()}`,an=[],Yt.addEventListener("message",({source:e,data:t})=>{e===Yt&&t===on&&an.length&&an.shift()()},!1),e=>{an.push(e),Yt.postMessage(on,"*")}):e=>setTimeout(e));var rn,sn,on,an;const ln="undefined"!=typeof queueMicrotask?queueMicrotask.bind(Yt):"undefined"!=typeof process&&process.nextTick||nn,cn={isArray:Nt,isArrayBuffer:At,isBuffer:Mt,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Pt(e.append)&&("formdata"===(t=kt(e))||"object"===t&&Pt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&At(e.buffer),t},isString:Ot,isNumber:Lt,isBoolean:e=>!0===e||!1===e,isObject:It,isPlainObject:_t,isEmptyObject:e=>{if(!It(e)||Mt(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(t){return!1}},isReadableStream:qt,isRequest:Ht,isResponse:Gt,isHeaders:Wt,isUndefined:Tt,isDate:Dt,isFile:Ut,isBlob:Ft,isRegExp:Qt,isFunction:Pt,isStream:e=>It(e)&&Pt(e.pipe),isURLSearchParams:Bt,isTypedArray:$t,isFileList:zt,forEach:Vt,merge:function e(){const{caseless:t,skipUndefined:n}=Jt(this)&&this||{},r={},s=(s,o)=>{const i=t&&Kt(r,o)||o;_t(r[i])&&_t(s)?r[i]=e(r[i],s):_t(s)?r[i]=e({},s):Nt(s)?r[i]=s.slice():n&&Tt(s)||(r[i]=s)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&Vt(arguments[o],s);return r},extend:(e,t,n,{allOwnKeys:r}={})=>(Vt(t,(t,r)=>{n&&Pt(t)?e[r]=wt(t,n):e[r]=t},{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let s,o,i;const a={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),o=s.length;o-- >0;)i=s[o],r&&!r(i,e,t)||a[i]||(t[i]=e[i],a[i]=!0);e=!1!==n&&jt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:kt,kindOfTest:Rt,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Nt(e))return e;let t=e.length;if(!Lt(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[St]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Zt,hasOwnProperty:Xt,hasOwnProp:Xt,reduceDescriptors:en,freezeMethods:e=>{en(e,(t,n)=>{if(Pt(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Pt(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return Nt(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Kt,global:Yt,isContextDefined:Jt,isSpecCompliantForm:function(e){return!!(e&&Pt(e.append)&&"FormData"===e[Et]&&e[St])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(It(e)){if(t.indexOf(e)>=0)return;if(Mt(e))return e;if(!("toJSON"in e)){t[r]=e;const s=Nt(e)?[]:{};return Vt(e,(e,t)=>{const o=n(e,r+1);!Tt(o)&&(s[t]=o)}),t[r]=void 0,s}}return e};return n(e,0)},isAsyncFn:tn,isThenable:e=>e&&(It(e)||Pt(e))&&Pt(e.then)&&Pt(e.catch),setImmediate:nn,asap:ln,isIterable:e=>null!=e&&Pt(e[St])};function un(e,t,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}cn.inherits(un,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:cn.toJSONObject(this.config),code:this.code,status:this.status}}});const dn=un.prototype,mn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{mn[e]={value:e}}),Object.defineProperties(un,mn),Object.defineProperty(dn,"isAxiosError",{value:!0}),un.from=(e,t,n,r,s,o)=>{const i=Object.create(dn);cn.toFlatObject(e,i,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const a=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return un.call(i,a,l,n,r,s),e&&null==i.cause&&Object.defineProperty(i,"cause",{value:e,configurable:!0}),i.name=e&&e.name||"Error",o&&Object.assign(i,o),i};function hn(e){return cn.isPlainObject(e)||cn.isArray(e)}function pn(e){return cn.endsWith(e,"[]")?e.slice(0,-2):e}function fn(e,t,n){return e?e.concat(t).map(function(e,t){return e=pn(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const gn=cn.toFlatObject(cn,{},null,function(e){return/^is[A-Z]/.test(e)});function yn(e,t,n){if(!cn.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=cn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!cn.isUndefined(t[e])})).metaTokens,s=n.visitor||c,o=n.dots,i=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&cn.isSpecCompliantForm(t);if(!cn.isFunction(s))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(cn.isDate(e))return e.toISOString();if(cn.isBoolean(e))return e.toString();if(!a&&cn.isBlob(e))throw new un("Blob is not supported. Use a Buffer instead.");return cn.isArrayBuffer(e)||cn.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,s){let a=e;if(e&&!s&&"object"==typeof e)if(cn.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(cn.isArray(e)&&function(e){return cn.isArray(e)&&!e.some(hn)}(e)||(cn.isFileList(e)||cn.endsWith(n,"[]"))&&(a=cn.toArray(e)))return n=pn(n),a.forEach(function(e,r){!cn.isUndefined(e)&&null!==e&&t.append(!0===i?fn([n],r,o):null===i?n:n+"[]",l(e))}),!1;return!!hn(e)||(t.append(fn(s,n,o),l(e)),!1)}const u=[],d=Object.assign(gn,{defaultVisitor:c,convertValue:l,isVisitable:hn});if(!cn.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!cn.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),cn.forEach(n,function(n,o){!0===(!(cn.isUndefined(n)||null===n)&&s.call(t,n,cn.isString(o)?o.trim():o,r,d))&&e(n,r?r.concat(o):[o])}),u.pop()}}(e),t}function xn(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function vn(e,t){this._pairs=[],e&&yn(e,this,t)}const wn=vn.prototype;function bn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function jn(e,t,n){if(!t)return e;const r=n&&n.encode||bn;cn.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let o;if(o=s?s(t,n):cn.isURLSearchParams(t)?t.toString():new vn(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}wn.append=function(e,t){this._pairs.push([e,t])},wn.toString=function(e){const t=e?function(t){return e.call(this,t,xn)}:xn;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class Sn{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){cn.forEach(this.handlers,function(t){null!==t&&e(t)})}}const En={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},kn={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:vn,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Rn="undefined"!=typeof window&&"undefined"!=typeof document,Cn="object"==typeof navigator&&navigator||void 0,Nn=Rn&&(!Cn||["ReactNative","NativeScript","NS"].indexOf(Cn.product)<0),Tn="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Mn=Rn&&window.location.href||"http://localhost",An={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Rn,hasStandardBrowserEnv:Nn,hasStandardBrowserWebWorkerEnv:Tn,navigator:Cn,origin:Mn},Symbol.toStringTag,{value:"Module"})),...kn};function On(e){function t(e,n,r,s){let o=e[s++];if("__proto__"===o)return!0;const i=Number.isFinite(+o),a=s>=e.length;if(o=!o&&cn.isArray(r)?r.length:o,a)return cn.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!i;r[o]&&cn.isObject(r[o])||(r[o]=[]);return t(e,n,r[o],s)&&cn.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const s=n.length;let o;for(r=0;r<s;r++)o=n[r],t[o]=e[o];return t}(r[o])),!i}if(cn.isFormData(e)&&cn.isFunction(e.entries)){const n={};return cn.forEachEntry(e,(e,r)=>{t(function(e){return cn.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null}const Pn={transitional:En,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=cn.isObject(e);s&&cn.isHTMLForm(e)&&(e=new FormData(e));if(cn.isFormData(e))return r?JSON.stringify(On(e)):e;if(cn.isArrayBuffer(e)||cn.isBuffer(e)||cn.isStream(e)||cn.isFile(e)||cn.isBlob(e)||cn.isReadableStream(e))return e;if(cn.isArrayBufferView(e))return e.buffer;if(cn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return yn(e,new An.classes.URLSearchParams,{visitor:function(e,t,n,r){return An.isNode&&cn.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((o=cn.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return yn(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),function(e,t,n){if(cn.isString(e))try{return(t||JSON.parse)(e),cn.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Pn.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(cn.isResponse(e)||cn.isReadableStream(e))return e;if(e&&cn.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(s){if(n){if("SyntaxError"===s.name)throw un.from(s,un.ERR_BAD_RESPONSE,this,null,this.response);throw s}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:An.classes.FormData,Blob:An.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};cn.forEach(["delete","get","head","post","put","patch"],e=>{Pn.headers[e]={}});const Ln=cn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),In=Symbol("internals");function _n(e){return e&&String(e).trim().toLowerCase()}function Dn(e){return!1===e||null==e?e:cn.isArray(e)?e.map(Dn):String(e)}function Un(e,t,n,r,s){return cn.isFunction(r)?r.call(this,t,n):(s&&(t=n),cn.isString(t)?cn.isString(r)?-1!==t.indexOf(r):cn.isRegExp(r)?r.test(t):void 0:void 0)}let Fn=class{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function s(e,t,n){const s=_n(t);if(!s)throw new Error("header name must be a non-empty string");const o=cn.findKey(r,s);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=Dn(e))}const o=(e,t)=>cn.forEach(e,(e,n)=>s(e,n,t));if(cn.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(cn.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const t={};let n,r,s;return e&&e.split("\n").forEach(function(e){s=e.indexOf(":"),n=e.substring(0,s).trim().toLowerCase(),r=e.substring(s+1).trim(),!n||t[n]&&Ln[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(cn.isObject(e)&&cn.isIterable(e)){let n,r,s={};for(const t of e){if(!cn.isArray(t))throw TypeError("Object iterator must return a key-value pair");s[r=t[0]]=(n=s[r])?cn.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}o(s,t)}else null!=e&&s(t,e,n);return this}get(e,t){if(e=_n(e)){const n=cn.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(cn.isFunction(t))return t.call(this,e,n);if(cn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=_n(e)){const n=cn.findKey(this,e);return!(!n||void 0===this[n]||t&&!Un(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function s(e){if(e=_n(e)){const s=cn.findKey(n,e);!s||t&&!Un(0,n[s],s,t)||(delete n[s],r=!0)}}return cn.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const s=t[n];e&&!Un(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const t=this,n={};return cn.forEach(this,(r,s)=>{const o=cn.findKey(n,s);if(o)return t[o]=Dn(r),void delete t[s];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(s):String(s).trim();i!==s&&delete t[s],t[i]=Dn(r),n[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return cn.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&cn.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){const t=(this[In]=this[In]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=_n(e);t[r]||(!function(e,t){const n=cn.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,s){return this[r].call(this,t,e,n,s)},configurable:!0})})}(n,e),t[r]=!0)}return cn.isArray(e)?e.forEach(r):r(e),this}};function zn(e,t){const n=this||Pn,r=t||n,s=Fn.from(r.headers);let o=r.data;return cn.forEach(e,function(e){o=e.call(n,o,s.normalize(),t?t.status:void 0)}),s.normalize(),o}function Bn(e){return!(!e||!e.__CANCEL__)}function qn(e,t,n){un.call(this,null==e?"canceled":e,un.ERR_CANCELED,t,n),this.name="CanceledError"}function Hn(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new un("Request failed with status code "+n.status,[un.ERR_BAD_REQUEST,un.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Fn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),cn.reduceDescriptors(Fn.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),cn.freezeMethods(Fn),cn.inherits(qn,un,{__CANCEL__:!0});const Gn=(e,t,n=3)=>{let r=0;const s=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let s,o=0,i=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=r[i];s||(s=l),n[o]=a,r[o]=l;let u=i,d=0;for(;u!==o;)d+=n[u++],u%=e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),l-s<t)return;const m=c&&l-c;return m?Math.round(1e3*d/m):void 0}}(50,250);return function(e,t){let n,r,s=0,o=1e3/t;const i=(t,o=Date.now())=>{s=o,n=null,r&&(clearTimeout(r),r=null),e(...t)};return[(...e)=>{const t=Date.now(),a=t-s;a>=o?i(e,t):(n=e,r||(r=setTimeout(()=>{r=null,i(n)},o-a)))},()=>n&&i(n)]}(n=>{const o=n.loaded,i=n.lengthComputable?n.total:void 0,a=o-r,l=s(a);r=o;e({loaded:o,total:i,progress:i?o/i:void 0,bytes:a,rate:l||void 0,estimated:l&&i&&o<=i?(i-o)/l:void 0,event:n,lengthComputable:null!=i,[t?"download":"upload"]:!0})},n)},Wn=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Vn=e=>(...t)=>cn.asap(()=>e(...t)),Kn=An.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,An.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(An.origin),An.navigator&&/(msie|trident)/i.test(An.navigator.userAgent)):()=>!0,Yn=An.hasStandardBrowserEnv?{write(e,t,n,r,s,o){const i=[e+"="+encodeURIComponent(t)];cn.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),cn.isString(r)&&i.push("path="+r),cn.isString(s)&&i.push("domain="+s),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Jn(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const $n=e=>e instanceof Fn?{...e}:e;function Zn(e,t){t=t||{};const n={};function r(e,t,n,r){return cn.isPlainObject(e)&&cn.isPlainObject(t)?cn.merge.call({caseless:r},e,t):cn.isPlainObject(t)?cn.merge({},t):cn.isArray(t)?t.slice():t}function s(e,t,n,s){return cn.isUndefined(t)?cn.isUndefined(e)?void 0:r(void 0,e,0,s):r(e,t,0,s)}function o(e,t){if(!cn.isUndefined(t))return r(void 0,t)}function i(e,t){return cn.isUndefined(t)?cn.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,s,o){return o in t?r(n,s):o in e?r(void 0,n):void 0}const l={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(e,t,n)=>s($n(e),$n(t),0,!0)};return cn.forEach(Object.keys({...e,...t}),function(r){const o=l[r]||s,i=o(e[r],t[r],r);cn.isUndefined(i)&&o!==a||(n[r]=i)}),n}const Xn=e=>{const t=Zn({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:o,headers:i,auth:a}=t;if(t.headers=i=Fn.from(i),t.url=jn(Jn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&i.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),cn.isFormData(n))if(An.hasStandardBrowserEnv||An.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(cn.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,n])=>{t.includes(e.toLowerCase())&&i.set(e,n)})}if(An.hasStandardBrowserEnv&&(r&&cn.isFunction(r)&&(r=r(t)),r||!1!==r&&Kn(t.url))){const e=s&&o&&Yn.read(o);e&&i.set(s,e)}return t},Qn="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const r=Xn(e);let s=r.data;const o=Fn.from(r.headers).normalize();let i,a,l,c,u,{responseType:d,onUploadProgress:m,onDownloadProgress:h}=r;function p(){c&&c(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(i),r.signal&&r.signal.removeEventListener("abort",i)}let f=new XMLHttpRequest;function g(){if(!f)return;const r=Fn.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());Hn(function(e){t(e),p()},function(e){n(e),p()},{data:d&&"text"!==d&&"json"!==d?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f}),f=null}f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new un("Request aborted",un.ECONNABORTED,e,f)),f=null)},f.onerror=function(t){const r=new un(t&&t.message?t.message:"Network Error",un.ERR_NETWORK,e,f);r.event=t||null,n(r),f=null},f.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const s=r.transitional||En;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new un(t,s.clarifyTimeoutError?un.ETIMEDOUT:un.ECONNABORTED,e,f)),f=null},void 0===s&&o.setContentType(null),"setRequestHeader"in f&&cn.forEach(o.toJSON(),function(e,t){f.setRequestHeader(t,e)}),cn.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),d&&"json"!==d&&(f.responseType=r.responseType),h&&([l,u]=Gn(h,!0),f.addEventListener("progress",l)),m&&f.upload&&([a,c]=Gn(m),f.upload.addEventListener("progress",a),f.upload.addEventListener("loadend",c)),(r.cancelToken||r.signal)&&(i=t=>{f&&(n(!t||t.type?new qn(null,e,f):t),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(i),r.signal&&(r.signal.aborted?i():r.signal.addEventListener("abort",i)));const y=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);y&&-1===An.protocols.indexOf(y)?n(new un("Unsupported protocol "+y+":",un.ERR_BAD_REQUEST,e)):f.send(s||null)})},er=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const s=function(e){if(!n){n=!0,i();const t=e instanceof Error?e:this.reason;r.abort(t instanceof un?t:new qn(t instanceof Error?t.message:t))}};let o=t&&setTimeout(()=>{o=null,s(new un(`timeout ${t} of ms exceeded`,un.ETIMEDOUT))},t);const i=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(s):e.removeEventListener("abort",s)}),e=null)};e.forEach(e=>e.addEventListener("abort",s));const{signal:a}=r;return a.unsubscribe=()=>cn.asap(i),a}},tr=function*(e,t){let n=e.byteLength;if(n<t)return void(yield e);let r,s=0;for(;s<n;)r=s+t,yield e.slice(s,r),s=r},nr=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}},rr=(e,t,n,r)=>{const s=async function*(e,t){for await(const n of nr(e))yield*tr(n,t)}(e,t);let o,i=0,a=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await s.next();if(t)return a(),void e.close();let o=r.byteLength;if(n){let e=i+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw a(t),t}},cancel:e=>(a(e),s.return())},{highWaterMark:2})},{isFunction:sr}=cn,or=(({Request:e,Response:t})=>({Request:e,Response:t}))(cn.global),{ReadableStream:ir,TextEncoder:ar}=cn.global,lr=(e,...t)=>{try{return!!e(...t)}catch(n){return!1}},cr=e=>{e=cn.merge.call({skipUndefined:!0},or,e);const{fetch:t,Request:n,Response:r}=e,s=t?sr(t):"function"==typeof fetch,o=sr(n),i=sr(r);if(!s)return!1;const a=s&&sr(ir),l=s&&("function"==typeof ar?(e=>t=>e.encode(t))(new ar):async e=>new Uint8Array(await new n(e).arrayBuffer())),c=o&&a&&lr(()=>{let e=!1;const t=new n(An.origin,{body:new ir,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),u=i&&a&&lr(()=>cn.isReadableStream(new r("").body)),d={stream:u&&(e=>e.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!d[e]&&(d[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new un(`Response type '${e}' is not supported`,un.ERR_NOT_SUPPORT,n)})});const m=async(e,t)=>{const r=cn.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(cn.isBlob(e))return e.size;if(cn.isSpecCompliantForm(e)){const t=new n(An.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return cn.isArrayBufferView(e)||cn.isArrayBuffer(e)?e.byteLength:(cn.isURLSearchParams(e)&&(e+=""),cn.isString(e)?(await l(e)).byteLength:void 0)})(t):r};return async e=>{let{url:s,method:i,data:a,signal:l,cancelToken:h,timeout:p,onDownloadProgress:f,onUploadProgress:g,responseType:y,headers:x,withCredentials:v="same-origin",fetchOptions:w}=Xn(e),b=t||fetch;y=y?(y+"").toLowerCase():"text";let j=er([l,h&&h.toAbortSignal()],p),S=null;const E=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let k;try{if(g&&c&&"get"!==i&&"head"!==i&&0!==(k=await m(x,a))){let e,t=new n(s,{method:"POST",body:a,duplex:"half"});if(cn.isFormData(a)&&(e=t.headers.get("content-type"))&&x.setContentType(e),t.body){const[e,n]=Wn(k,Gn(Vn(g)));a=rr(t.body,65536,e,n)}}cn.isString(v)||(v=v?"include":"omit");const t=o&&"credentials"in n.prototype,l={...w,signal:j,method:i.toUpperCase(),headers:x.normalize().toJSON(),body:a,duplex:"half",credentials:t?v:void 0};S=o&&new n(s,l);let h=await(o?b(S,w):b(s,l));const p=u&&("stream"===y||"response"===y);if(u&&(f||p&&E)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=h[t]});const t=cn.toFiniteNumber(h.headers.get("content-length")),[n,s]=f&&Wn(t,Gn(Vn(f),!0))||[];h=new r(rr(h.body,65536,n,()=>{s&&s(),E&&E()}),e)}y=y||"text";let R=await d[cn.findKey(d,y)||"text"](h,e);return!p&&E&&E(),await new Promise((t,n)=>{Hn(t,n,{data:R,headers:Fn.from(h.headers),status:h.status,statusText:h.statusText,config:e,request:S})})}catch(R){if(E&&E(),R&&"TypeError"===R.name&&/Load failed|fetch/i.test(R.message))throw Object.assign(new un("Network Error",un.ERR_NETWORK,e,S),{cause:R.cause||R});throw un.from(R,R&&R.code,e,S)}}},ur=new Map,dr=e=>{let t=e?e.env:{};const{fetch:n,Request:r,Response:s}=t,o=[r,s,n];let i,a,l=o.length,c=ur;for(;l--;)i=o[l],a=c.get(i),void 0===a&&c.set(i,a=l?new Map:cr(t)),c=a;return a};dr();const mr={http:null,xhr:Qn,fetch:{get:dr}};cn.forEach(mr,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}});const hr=e=>`- ${e}`,pr=e=>cn.isFunction(e)||null===e||!1===e,fr=(e,t)=>{e=cn.isArray(e)?e:[e];const{length:n}=e;let r,s;const o={};for(let i=0;i<n;i++){let n;if(r=e[i],s=r,!pr(r)&&(s=mr[(n=String(r)).toLowerCase()],void 0===s))throw new un(`Unknown adapter '${n}'`);if(s&&(cn.isFunction(s)||(s=s.get(t))))break;o[n||"#"+i]=s}if(!s){const e=Object.entries(o).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new un("There is no suitable adapter to dispatch the request "+(n?e.length>1?"since :\n"+e.map(hr).join("\n"):" "+hr(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s};function gr(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new qn(null,e)}function yr(e){gr(e),e.headers=Fn.from(e.headers),e.data=zn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return fr(e.adapter||Pn.adapter,e)(e).then(function(t){return gr(e),t.data=zn.call(e,e.transformResponse,t),t.headers=Fn.from(t.headers),t},function(t){return Bn(t)||(gr(e),t&&t.response&&(t.response.data=zn.call(e,e.transformResponse,t.response),t.response.headers=Fn.from(t.response.headers))),Promise.reject(t)})}const xr="1.12.2",vr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{vr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const wr={};vr.transitional=function(e,t,n){return(r,s,o)=>{if(!1===e)throw new un(function(e,t){return"[Axios v"+xr+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}(s," has been removed"+(t?" in "+t:"")),un.ERR_DEPRECATED);return t&&!wr[s]&&(wr[s]=!0),!e||e(r,s,o)}},vr.spelling=function(e){return(e,t)=>!0};const br={assertOptions:function(e,t,n){if("object"!=typeof e)throw new un("options must be an object",un.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let s=r.length;for(;s-- >0;){const o=r[s],i=t[o];if(i){const t=e[o],n=void 0===t||i(t,o,e);if(!0!==n)throw new un("option "+o+" must be "+n,un.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new un("Unknown option "+o,un.ERR_BAD_OPTION)}},validators:vr},jr=br.validators;let Sr=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Sn,response:new Sn}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(r){}}throw n}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Zn(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:s}=t;void 0!==n&&br.assertOptions(n,{silentJSONParsing:jr.transitional(jr.boolean),forcedJSONParsing:jr.transitional(jr.boolean),clarifyTimeoutError:jr.transitional(jr.boolean)},!1),null!=r&&(cn.isFunction(r)?t.paramsSerializer={serialize:r}:br.assertOptions(r,{encode:jr.function,serialize:jr.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),br.assertOptions(t,{baseUrl:jr.spelling("baseURL"),withXsrfToken:jr.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&cn.merge(s.common,s[t.method]);s&&cn.forEach(["delete","get","head","post","put","patch","common"],e=>{delete s[e]}),t.headers=Fn.concat(o,s);const i=[];let a=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let u,d=0;if(!a){const e=[yr.bind(this),void 0];for(e.unshift(...i),e.push(...l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=i.length;let m=t;for(;d<u;){const e=i[d++],t=i[d++];try{m=e(m)}catch(h){t.call(this,h);break}}try{c=yr.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return jn(Jn((e=Zn(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};cn.forEach(["delete","get","head","options"],function(e){Sr.prototype[e]=function(t,n){return this.request(Zn(n||{},{method:e,url:t,data:(n||{}).data}))}}),cn.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,s){return this.request(Zn(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Sr.prototype[e]=t(),Sr.prototype[e+"Form"]=t(!0)});const Er={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Er).forEach(([e,t])=>{Er[t]=e});const kr=function e(t){const n=new Sr(t),r=wt(Sr.prototype.request,n);return cn.extend(r,Sr.prototype,n,{allOwnKeys:!0}),cn.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Zn(t,n))},r}(Pn);kr.Axios=Sr,kr.CanceledError=qn,kr.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,s){n.reason||(n.reason=new qn(e,r,s),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},kr.isCancel=Bn,kr.VERSION=xr,kr.toFormData=yn,kr.AxiosError=un,kr.Cancel=kr.CanceledError,kr.all=function(e){return Promise.all(e)},kr.spread=function(e){return function(t){return e.apply(null,t)}},kr.isAxiosError=function(e){return cn.isObject(e)&&!0===e.isAxiosError},kr.mergeConfig=Zn,kr.AxiosHeaders=Fn,kr.formToJSON=e=>On(cn.isHTMLForm(e)?new FormData(e):e),kr.getAdapter=fr,kr.HttpStatusCode=Er,kr.default=kr;const{Axios:Rr,AxiosError:Cr,CanceledError:Nr,isCancel:Tr,CancelToken:Mr,VERSION:Ar,all:Or,Cancel:Pr,isAxiosError:Lr,spread:Ir,toFormData:_r,AxiosHeaders:Dr,HttpStatusCode:Ur,formToJSON:Fr,getAdapter:zr,mergeConfig:Br}=kr,qr="ðŸ”Œ No internet connection. Please check your network and try again.",Hr="ðŸ”Œ Cannot connect to Rose. Please ensure the server is running.",Gr="â±ï¸ Request timed out. The server is taking too long to respond. Please try again.",Wr="âŒ Server error occurred. Please try again in a moment.",Vr="ðŸŽ¤ Microphone access denied. Please allow microphone access in your browser settings.",Kr="ðŸŽ¤ No microphone found. Please connect a microphone and try again.",Yr="ðŸŽ¤ Microphone is already in use by another application.",Jr="ðŸŽ¤ Microphone error. Please check your device and try again.",$r="ðŸŽ¤ I couldn't hear that clearly. Could you try again?",Zr="ðŸŽ¤ Audio file is too large. Please record a shorter message.",Xr="ðŸ”Š Failed to play audio response. Please check your speakers.",Qr="ðŸ”Š Network error loading audio. Please check your connection and try again.",es="ðŸ”Š Unable to decode audio. The audio file may be corrupted.",ts="ðŸ”Š Your browser doesn't support this audio format. Please try a different browser.",ns="â±ï¸ Audio took too long to load. Please check your connection and try again.",rs="ðŸ”Š Tap here to enable audio playback. Your browser blocked autoplay.",ss="ðŸ”Š Audio playback stalled. Retrying...",os="â±ï¸ Your session has expired. Please refresh the page.",is="â±ï¸ Session not found. Please refresh the page.",as="â±ï¸ Too many requests. Please wait a moment and try again.",ls="ðŸ¥ Health check failed. The server may be down.",cs="âŒ An unexpected error occurred. Please try again.",us={[qr]:{category:"connection",severity:"error",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Hr]:{category:"connection",severity:"critical",isTransient:!1,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Gr]:{category:"connection",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Vr]:{category:"microphone",severity:"error",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!1},[Kr]:{category:"microphone",severity:"error",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!1},[$r]:{category:"voice_processing",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Zr]:{category:"voice_processing",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[Xr]:{category:"playback",severity:"error",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},[os]:{category:"session",severity:"error",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!0},[as]:{category:"rate_limit",severity:"warning",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1},"âŒ Failed to load critical assets. Please refresh the page.":{category:"asset",severity:"critical",isTransient:!1,isDismissible:!0,retryable:!1,requiresRefresh:!0}};function ds(e){const t=function(e){return us[e]||{category:"generic",severity:"error",isTransient:!0,isDismissible:!0,retryable:!0,requiresRefresh:!1}}(e);return t.isTransient}const ms=new class{constructor(){t(this,"client");this.client=kr.create({baseURL:"/api/v1",timeout:6e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>navigator.onLine?e:Promise.reject(new Error(qr)),e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>{e.config,e.config?.method?.toUpperCase(),e.response,e.response,e.message,e.response,e.config?.data instanceof FormData||e.config;if(e.message===qr)throw new Error(qr);if("ECONNABORTED"===e.code)throw new Error(Gr);if(e.response){const t=e.response.status,n=e.response.data;if(401===t||403===t)throw new Error(os);if(413===t)throw new Error(Zr);if(429===t)throw new Error(as);if(t>=500)throw new Error(Wr);const r=n.detail||n.message||Wr;throw new Error(r)}throw e.request?new Error(Hr):new Error(cs)})}async startSession(){return(await this.client.post("/session/start")).data}async processVoice(e,t){const n=new FormData;n.append("audio",e,"recording.webm"),n.append("session_id",t);return(await this.client.post("/voice/process",n,{headers:{"Content-Type":"multipart/form-data"}})).data}async checkHealth(){return(await this.client.get("/health")).data}},hs={mimeType:{preferred:"audio/webm",fallbacks:["audio/mp4","audio/ogg"]},audioConstraints:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,latency:.01},timeslice:100,maxRecordingDuration:6e4,minRecordingDuration:300,minAudioSizeBytes:1e3,retryAttempts:2,retryDelay:1e3,errorResetDelay:3e3},ps={fftSize:512,smoothingTimeConstant:.85,minDecibels:-85,maxDecibels:-15,noiseGate:.02},fs=15e3,gs=2,ys=["audio/webm;codecs=opus","audio/ogg;codecs=opus","audio/mp4"],xs=96e3,vs=6e4,ws="ðŸŽ¨",bs="ðŸŽ­",js="ðŸŽ­",Ss="ðŸŽµ",Es="ðŸ“¦",ks=[],Rs=[],Cs=e=>{const t=e.split(".").pop()?.toLowerCase();return"css"===t?ws:"glb"===t||"gltf"===t?bs:"jpg"===t||"png"===t||"webp"===t?js:"mp3"===t||"wav"===t||"ogg"===t?Ss:Es},Ns=()=>{const[e,t]=n.useState(!0),[r,s]=n.useState(null),[o,i]=n.useState(0),a=()=>{t(!0),setTimeout(()=>{try{const e=(()=>{const e=document.createElement("canvas");let t=null,n=null;try{t=e.getContext("webgl2"),t&&(n=2)}catch(i){}if(!t)try{t=e.getContext("webgl")||e.getContext("experimental-webgl"),t&&(n=1)}catch(i){}if(!t||!n)return{supported:!1,version:null,renderer:null,vendor:null,maxTextureSize:null,error:"WebGL is not supported in your browser"};let r=null,s=null,o=null;try{const e=t.getExtension("WEBGL_debug_renderer_info");e&&(r=t.getParameter(e.UNMASKED_RENDERER_WEBGL),s=t.getParameter(e.UNMASKED_VENDOR_WEBGL)),o=t.getParameter(t.MAX_TEXTURE_SIZE)}catch(i){}try{t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}catch(i){return{supported:!1,version:null,renderer:r,vendor:s,maxTextureSize:o,error:"WebGL context is not functional"}}return{supported:!0,version:n,renderer:r,vendor:s,maxTextureSize:o,error:null}})();s(e)}catch(e){s({supported:!1,version:null,renderer:null,vendor:null,maxTextureSize:null,error:"An error occurred while detecting WebGL support"})}finally{t(!1)}},100)};n.useEffect(()=>{a()},[o]);const l=!!r&&(e=>!(!e.supported||!e.version||e.maxTextureSize&&e.maxTextureSize<2048))(r);return{isSupported:l,isChecking:e,capabilities:r,retry:()=>{i(e=>e+1)}}};function Ts(){const[e,t]=n.useState(!1),[r,o]=n.useState(""),[i,a]=n.useState(null),l=n.useRef(null),{isHealthy:c,error:u,version:d,isLoading:m}=(()=>{const[e,t]=n.useState(null),[r,s]=n.useState(null),[o,i]=n.useState(null),[a,l]=n.useState(!0);return n.useEffect(()=>{(async()=>{try{l(!0);const e=await ms.checkHealth();t(!0),i(e.version||null),s(null)}catch(e){const n=e instanceof Error?e.message:ls;s(n),t(!1),i(null)}finally{l(!1)}})()},[]),{isHealthy:e,error:r,version:o,isLoading:a}})(),{isSupported:h,isChecking:p,capabilities:f,retry:g}=Ns(),{isLoading:y,progress:x,error:v}=((e={})=>{const{enabled:t=!0,onProgress:r,onComplete:s,onError:o}=e,[i,a]=n.useState({loaded:0,total:0,percentage:0,phase:"critical",failedAssets:[],criticalAssetsFailed:!1}),[l,c]=n.useState(!0),[u,d]=n.useState(null),[m,h]=n.useState([]),p=ks.length+Rs.length,f=n.useCallback((e,t,n,s,o)=>{const i=p>0?Math.round(e/p*100):0,l={loaded:e,total:p,percentage:i,phase:t,currentAsset:n,failedAssets:s,criticalAssetsFailed:o};a(l),r?.(l)},[p,r]);return n.useEffect(()=>{if(!t)return void c(!1);let e=0,n=!1;return(async()=>{try{const r=[];let o=!1;f(e,"critical","Loading essential scene elements...",r,o);for(const s of ks){if(n)return;try{Cs(s),e++,f(e,"critical",s,r,o),await new Promise(e=>setTimeout(e,100))}catch(t){r.push(s),o=!0,h(e=>[...e,s])}}if(o)throw new Error(`Critical assets failed to load: ${r.join(", ")}`);if(n)return;f(e,"secondary","Loading environmental details...",r,o);for(const s of Rs){if(n)return;try{Cs(s),e++,f(e,"secondary",s,r,o),await new Promise(e=>setTimeout(e,100))}catch(t){r.push(s),h(e=>[...e,s])}}if(r.length,n)return;if(f(e,"effects","Preparing visual effects...",r,o),await new Promise(e=>setTimeout(e,200)),n)return;r.length,f(p,"complete","Ready",r,o),c(!1),s?.()}catch(t){if(!n){const e=t instanceof Error?t:new Error("Asset loading failed");d(e),c(!1),o?.(e)}}})(),()=>{n=!0}},[t,f,p,s,o]),{isLoading:l,progress:i,error:u,failedAssets:m}})({enabled:h,onProgress:e=>{},onComplete:()=>{},onError:e=>{a("Failed to load scene assets. Please refresh the page.")}});n.useEffect(()=>{u&&a(u)},[u,d]),n.useEffect(()=>{if(l.current&&(clearTimeout(l.current),l.current=null),i){const e=ds(i)?5e3:null;null!==e&&(l.current=setTimeout(()=>{a(null),l.current=null},e))}return()=>{l.current&&(clearTimeout(l.current),l.current=null)}},[i]),n.useEffect(()=>{if(!1===c)return;if(null===c)return;(async()=>{try{const e=localStorage.getItem("rose_session_id");if(e)return void o(e);const t=await ms.startSession();o(t.session_id),localStorage.setItem("rose_session_id",t.session_id)}catch(e){a("Failed to connect to Rose. Please refresh the page.")}})()},[c]);const{voiceState:w,startRecording:b,stopRecording:j,audioElement:S,error:E}=(e=>{const{sessionId:t,onError:r,onResponseText:s,onAutoplayBlocked:o}=e,[i,a]=n.useState("idle"),[l,c]=n.useState(null),[u,d]=n.useState(""),m=n.useRef(null),h=n.useRef([]),p=n.useRef(null),f=n.useRef(null),g=n.useRef(0),y=n.useRef(null),x=n.useRef(0),v=n.useCallback(()=>{for(const e of ys)if(MediaRecorder.isTypeSupported(e)){const t=e.startsWith("audio/webm")?"webm":e.startsWith("audio/ogg")?"ogg":"mp4";return{mimeType:e,extension:t}}return{mimeType:void 0,extension:"webm"}},[]),w=n.useCallback(()=>{const e=document.createElement("audio");return{mp3:""!==e.canPlayType("audio/mpeg"),webm_opus:""!==e.canPlayType('audio/webm; codecs="opus"'),ogg_opus:""!==e.canPlayType('audio/ogg; codecs="opus"'),mp4:""!==e.canPlayType("audio/mp4"),wav:""!==e.canPlayType("audio/wav")}},[]),b=n.useCallback(async()=>{try{c(null),h.current=[],x.current=Date.now();const e=await navigator.mediaDevices.getUserMedia({audio:hs.audioConstraints});p.current=e;const{mimeType:t}=v(),n=new MediaRecorder(e,{mimeType:t,bitsPerSecond:xs});m.current=n,n.ondataavailable=e=>{e.data.size>0&&h.current.push(e.data)},n.onstop=async()=>{const e=Date.now()-x.current;p.current&&(p.current.getTracks().forEach(e=>e.stop()),p.current=null);const n=t||"audio/webm",s=new Blob(h.current,{type:n});if(m.current=null,e<hs.minRecordingDuration){const e="ðŸŽ¤ Recording too short. Please hold the button longer and speak clearly.";return c(e),a("idle"),void(r&&r(e))}if(s.size<hs.minAudioSizeBytes){const e="ðŸŽ¤ Recording too short. Please hold the button longer and speak clearly.";return c(e),a("idle"),void(r&&r(e))}if(e>vs){const e="ðŸŽ¤ Recording too long. Please keep messages under 60 seconds.";return c(e),a("idle"),void(r&&r(e))}await S(s)},n.start(),a("listening")}catch(e){let t=Jr;e instanceof Error&&("NotFoundError"===e.name?t=Kr:"NotAllowedError"===e.name?t=Vr:"NotReadableError"===e.name&&(t=Yr)),c(t),a("idle"),r&&r(t)}},[t,r,v]),j=n.useCallback(()=>{m.current&&"listening"===i&&m.current.stop()},[i]),S=n.useCallback(async e=>{if(!t){const e=is;return c(e),a("idle"),void(r&&r(e))}a("processing"),c(null);try{const n=await ms.processVoice(e,t);d(n.text),s&&s(n.text),await k(n.audio_url)}catch(n){const e=n instanceof Error?n.message:$r;c(e),a("idle"),r&&r(e)}},[t,r,s]),E=n.useCallback(()=>{if(f.current){const e=f.current;e.oncanplaythrough=null,e.oncanplay=null,e.onplay=null,e.onended=null,e.onerror=null,e.onstalled=null,e.onsuspend=null,e.pause(),e.src="",e.load(),f.current=null}y.current&&(URL.revokeObjectURL(y.current),y.current=null)},[]),k=n.useCallback(async e=>new Promise(async(t,n)=>{try{const i=++g.current;E(),w();const l=new Audio;l.preload="auto",e.startsWith("http")&&!e.includes(window.location.hostname)&&(l.crossOrigin="anonymous"),f.current=l;let u=null,d=0;const m=()=>i===g.current,h=()=>new Promise((e,t)=>{let n=!1;l.oncanplaythrough=()=>{m()&&(u&&clearTimeout(u),e())},l.oncanplay=()=>{m()},u=setTimeout(()=>{m()&&(n=!0,l.readyState>=HTMLMediaElement.HAVE_FUTURE_DATA?e():t(new Error(ns)))},fs)});l.onstalled=()=>{m()&&(d<gs?(d++,c(ss),l.load()):(c(Qr),a("idle"),E(),r&&r(Qr),n(new Error(Qr))))},l.onsuspend=l.onstalled,l.onplay=()=>{m()&&(a("speaking"),c(null))},l.onended=()=>{m()&&(a("idle"),E(),t())},l.onerror=()=>{if(!m())return;const e=l.error;let t=Xr;if(e)switch(e.code){case MediaError.MEDIA_ERR_NETWORK:t=Qr;break;case MediaError.MEDIA_ERR_DECODE:t=es;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:t=ts;break;case MediaError.MEDIA_ERR_ABORTED:return}c(t),a("idle"),E(),r&&r(t),n(new Error(t))},l.src=e,await h();try{await l.play()}catch(s){if(!m())return;if(s instanceof Error&&"NotAllowedError"===s.name){const e=rs;return c(e),a("idle"),o&&o(),r&&r(e),void n(new Error(e))}throw s}}catch(i){const e=i instanceof Error?i.message:Xr;c(e),a("idle"),E(),r&&r(e),n(i)}}),[r,E,w,o]),R=n.useCallback(async()=>{if(f.current)try{await f.current.play(),c(null),a("speaking")}catch(e){const t=Xr;c(t),r&&r(t)}},[r]),C=n.useCallback(()=>{E(),a("idle")},[E]),N=n.useCallback(()=>{m.current&&"listening"===i&&(m.current.stop(),m.current=null,h.current=[],p.current&&(p.current.getTracks().forEach(e=>e.stop()),p.current=null),a("idle"))},[i]);return n.useEffect(()=>()=>{p.current&&p.current.getTracks().forEach(e=>e.stop()),E()},[E]),{voiceState:i,error:l,responseText:u,startRecording:b,stopRecording:j,cancelRecording:N,stopAudio:C,retryPlayback:R,isListening:"listening"===i,isProcessing:"processing"===i,isSpeaking:"speaking"===i,isIdle:"idle"===i,audioElement:f.current}})({sessionId:r,onError:e=>a(e)}),{amplitude:k}=((e,t={})=>{const{fftSize:r=ps.fftSize,smoothingTimeConstant:s=ps.smoothingTimeConstant,minDecibels:o=ps.minDecibels,maxDecibels:i=ps.maxDecibels,enabled:a=!0}=t,[l,c]=n.useState({amplitude:0,frequency:0,frequencyData:new Uint8Array(0),waveformData:new Uint8Array(0)}),u=n.useRef(null),d=n.useRef(null),m=n.useRef(null),h=n.useRef(null),p=n.useRef(!1),f=n.useCallback(()=>{if(e&&a&&!p.current)try{const t=new(window.AudioContext||window.webkitAudioContext);u.current=t;const n=t.createAnalyser();n.fftSize=r,n.smoothingTimeConstant=s,n.minDecibels=o,n.maxDecibels=i,d.current=n;const a=t.createMediaElementSource(e);m.current=a,a.connect(n),n.connect(t.destination),p.current=!0,y()}catch(t){}},[e,a,r,s,o,i]),g=n.useCallback(()=>{if(!d.current||!a)return;const e=d.current,t=e.frequencyBinCount,n=new Uint8Array(t),r=new Uint8Array(t);e.getByteFrequencyData(n),e.getByteTimeDomainData(r);let s=n.reduce((e,t)=>e+t,0)/t/255;s<ps.noiseGate&&(s=0);let o=0,i=0;for(let a=0;a<t;a++)n[a]>o&&(o=n[a],i=a);const l=(u.current?.sampleRate||44100)/2;c({amplitude:s,frequency:i/t*l,frequencyData:n,waveformData:r}),h.current=requestAnimationFrame(g)},[a]),y=n.useCallback(()=>{h.current&&cancelAnimationFrame(h.current),h.current=requestAnimationFrame(g)},[g]),x=n.useCallback(()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)},[]);return n.useEffect(()=>{if(e&&a&&!p.current){const t=()=>{f()};if(!(e.readyState>=2))return e.addEventListener("canplay",t),()=>{e.removeEventListener("canplay",t)};f()}},[e,a,f]),n.useEffect(()=>()=>{x(),u.current&&(u.current.close(),u.current=null),p.current=!1},[x]),{amplitude:l.amplitude,frequency:l.frequency,frequencyData:l.frequencyData,waveformData:l.waveformData,startAnalysis:y,stopAnalysis:x,isAnalyzing:null!==h.current}})(S);return n.useEffect(()=>{},[w,()=>{},()=>{}]),n.useEffect(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)");t(e.matches);const n=e=>{t(e.matches)};return e.addEventListener("change",n),()=>e.removeEventListener("change",n)},[]),n.useEffect(()=>{v&&a(v.message)},[v]),n.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLButtonElement))switch(e.key){case" ":case"Enter":e.preventDefault(),"idle"!==w||i||b();break;case"Escape":e.preventDefault(),"listening"===w&&j()}},t=e=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLButtonElement||" "!==e.key&&"Enter"!==e.key||"listening"!==w||(e.preventDefault(),j())};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[w,b,j,i]),p||h||!f?s.jsx(vt,{enabled:!1,children:s.jsxs("div",{className:"app-container relative w-full h-screen overflow-hidden",children:[s.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-black",children:"Skip to main content"}),s.jsx(ft,{isLoading:y||p||m,progress:x.percentage,currentAsset:x.currentAsset,phase:x.phase}),(i||E)&&!y&&s.jsx("div",{className:"absolute top-24 left-1/2 -translate-x-1/2 z-20 max-w-md px-4",children:s.jsxs("div",{className:"bg-red-500/20 backdrop-blur-md border border-red-500/30 rounded-lg p-4 relative",children:[s.jsx("p",{className:"text-white text-sm text-center pr-8",children:i||E}),s.jsx("button",{type:"button",onClick:()=>{a(null)},className:"absolute top-2 right-2 text-white/70 hover:text-white transition-colors","aria-label":"Dismiss error",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),i&&ds(i)&&s.jsx("p",{className:"text-white/50 text-xs text-center mt-2",children:"Auto-dismissing in 5 seconds..."})]})}),!y&&r&&s.jsx(n.Suspense,{fallback:null,children:s.jsx(Ge,{voiceState:w,audioAmplitude:k,reducedMotion:e})}),!y&&s.jsxs("div",{id:"main-content",role:"main",children:[s.jsx(We,{}),s.jsx(pt,{voiceState:w,onStartRecording:b,onStopRecording:j,audioAmplitude:k,disabled:!r||!!i}),"idle"===w&&s.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-10 text-center animate-pulse",children:s.jsx("p",{className:"text-white/70 text-sm font-medium tracking-wide",children:"Press & Hold to Speak"})}),s.jsx(gt,{ambientVolume:0,onAmbientVolumeChange:()=>{},reducedMotion:e,onReducedMotionChange:t}),s.jsx(yt,{})]})]})}):s.jsx(xt,{capabilities:f,onRetry:g})}f.createRoot(document.getElementById("root")).render(s.jsx(r.StrictMode,{children:s.jsx(vt,{enabled:!1,children:s.jsx(Ts,{})})}));
